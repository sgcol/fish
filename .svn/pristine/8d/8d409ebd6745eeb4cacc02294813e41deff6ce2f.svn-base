webpackJsonp([6],Array(29).concat([function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),o=function f(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(void 0===n){var r=Object.getPrototypeOf(t);return null===r?void 0:f(r,e,i)}if("value"in n)return n.value;var a=n.get;return void 0===a?void 0:a.call(i)},h=i(50),l=i(17),c=laya.net.Loader,u=laya.utils.Handler,d=function(t){function e(){return n(this,e),r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this))}return a(e,t),s(e,[{key:"getUserMediaRect",value:function(t){}},{key:"getVoiceBtn",value:function(){return this._view.getChild("voicebtn")}},{key:"onVideoActived",value:function(){}},{key:"msg",value:function(t){switch(t.c){case"1":break;default:return o(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"msg",this).call(this,t)}}},{key:"active",value:function(){console.log("loadinginging"),loadingview.getChild("n16").value=0;var t=setInterval(function(){loadingview.getChild("n16").value+=20,100==loadingview.getChild("n16").value&&clearInterval(t)},1400)}},{key:"deactive",value:function(){o(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"deactive",this).call(this)}}],[{key:"create",value:function(t,n){console.log("loadinginging"),t=l(t,{seatNumber:4,easyrtcApp:"com.1357g.h5.xxx"}),Laya.loader.load([{url:i(61),type:c.IMAGE},{url:i(62),type:c.IMAGE},{url:i(32),type:c.BUFFER}],u.create(null,function(){console.log("loadinginging");var i=new e(t);fairygui.UIPackage.addPackage("loadiing");var r=i._view=fairygui.UIPackage.createObject("loadiing","loading页面").asCom;window.loadingview=r,window.roomview=r,i.afterCreateView(),n(null,i)}))}}]),e}(h);t.exports=d.create},,,,,,,,,,,,,,,,,,,,,function(t,e,i){"use strict";function n(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t){return t.charAt(0).toUpperCase()+t.slice(1)}function o(t,e,i){if(null!=t&&"object"==("undefined"==typeof t?"undefined":l(t)))for(var n in t){var r=n.replace(/\\/g,"\\u005c").replace(/\./g,"\\u002e"),a=e?e+"."+r:r;i(a,t[n]),o(t[n],a,i)}}function h(t,e){"function"==typeof t&&(e=t,t=null),t=t||"com.1357g.h5.niuniu",e=e||v,y.connect(t,function(i){console.log("easyrtc connected",t,i),e(null,i)},function(t){e(t)})}var l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},c=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),u=i(89),d=i(17),f=i(46),_=i(1),p=i(2),m=function(){function t(){a(this,t)}return c(t,[{key:"assignAllBtns",value:function(){for(var t=this,e=this._view._children,i=/[A-Za-z]\d+/,n=0;n<e.length;n++){var r=e[n].asButton;if(r instanceof fairygui.GButton){var a=function(){if(i.test(r.name))return"continue";var e=r.name.split("."),n=e[1]||1;e=e[0];var a=t._view.getController(e);a?(r.onClick(t,function(){a.selectedIndex=n}),a.setSelectedIndex(0)):r.onClick(t,function(){var t=s(e)+"Win";if(p[t])var i=new p[t];else var i=new p.Win(e);i.modal=!0,i.show()})}();if("continue"===a)continue}}}},{key:"active",value:function(){console.log("你可以自行实现.active函数")}},{key:"deactive",value:function(){console.log("你可以自行实现.deactive函数")}},{key:"msg",value:function(t){console.log("你可以自行实现.msg函数,这里可以处理服务器来的消息")}}],[{key:"create",value:function(t,e){u.fail("必须自己实现create")}}]),t}(),g=function(t){function e(){a(this,e);var t=n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this)),i=t._rangeEvents=[];return t.on("newListener",function(t,e){0==t.indexOf("/")&&i.push({reg:new RegExp(t.substr(1,-2)),k:t})}),t.on("removeListener",function(t,e){var n=i.findIndex(function(e){return e.k==t});n>=0&&i.splice(n,1)}),t}return r(e,t),c(e,[{key:"_enumAttr",value:function(t,e,i){if(null!=t&&"object"==("undefined"==typeof t?"undefined":l(t)))for(var n in t)if("$"!=n&&!(n.indexOf("_")>=0)){var r=n.replace(/\\/g,"\\u005c").replace(/\./g,"\\u002e"),a=e?e+"."+r:r;i(a,t[n]),"object"==l(t[n])&&this._enumAttr(t[n],a,i)}}},{key:"_chkRegEvent",value:function(t){for(var e=0;e<this._rangeEvents.length;e++){var i=this._rangeEvents[e].reg.exec(t);i&&(i.unshift(this._rangeEvents[e].k),this.emit.apply(this,i))}}},{key:"_update",value:function(t){var e=Object.keys(t);2==e.length&&null!=t.countdown||console.log(t);var i=this;if(t.$){if(t.$.init){for(var n in this)"function"!=typeof this[n]&&0!=n.indexOf("_")&&delete this[n];return d.recursive(this,t),this.emit("inited",this),void o(this,null,function(t,e){"function"!=typeof e&&0!=t.indexOf("_")&&(i.emit(""+t+"chgd",i),i._chkRegEvent(""+t+"chgd"))})}if(t.$["delete"])for(var r=t.$["delete"],a=0;a<r.length;a++){var s=r[a];this.ensuredelete(s),this.emit(s[0]+"chgd",this),this.emit(s+"chgd",this),this._chkRegEvent(s+"chgd")}if(t.$.set)for(var r=t.$.set,a=0;a<r.length;a++){var s=r[a];this.ensuredelete(s)}delete t.$}d.recursive(this,t),this._enumAttr(t,"",function(t,e){i.emit(t+"chgd",e),i._chkRegEvent(t+"chgd")})}},{key:"ensuredelete",value:function(t){for(var e=this,i=0;i<t.length-1;i++){if(!e[t[i]])return!1;e=e[t[i]]}e&&(Array.isArray(e)&&e.length-1==t[t.length-1]?e.length--:delete e[t[t.length-1]])}}]),e}(f),y=(window.io=i(92),i(86)),v=i(23)._noop,x=function(){function t(t){return Laya.Browser.onAndroid?void e.requestPermissions([e.RECORD_AUDIO,e.CAMERA,e.RECORD_AUDIO],function(e){return e.hasPermission?t():void t("user canceled")},function(){t("something wrong")}):t()}var e=!!window.cordova&&cordova.plugins.permissions||{checkPermission:function(t,e){e({hasPermission:!0})}};return t}();y.setSocketUrl("http://ws.1357g.com:19999/"),y.setVideoDims(100,100,15);var w=console.log.bind(console,"audioroute ret");document.addEventListener("audioroute-changed",function(t){"route-config-change"==t.reason&&cordova.plugins.audioroute.currentOutputs(function(t){console.log("audio chg to",t),"builtin-receiver"==t&&cordova.plugins.audioroute.overrideOutput("speaker",w,w)},w)});var b=document.getElementById("layaContainer"),C=document.getElementById("layaCanvas"),S=function(t){function e(t){a(this,e);var i=n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));t=t||{},i.gamedata=i.scene=new g,i._seatNumber=4,i._calls={};var r=i,s=i.gamedata;return s.on("inited",function(){t.disableRtc||null==t.easyrtcApp||x(function(e){y.initMediaSource(function(){if(!r.hasQuit){r.disableMicrophone(),r.onVideoActived&&r.onVideoActived(),r.chgVoiceBtnFunc();var e=r.icon2Video(0,!0);e&&(y.setVideoObjectSrc(e,y.getLocalStream()),h(t.easyrtcApp,function(t,e){return t?console.log(t):void(r.hasQuit||(r.afterRtcConnected(e),y.setDisconnectListener(function(){y.showError("LOST-CONNECTION","Lost connection to signaling server"),h(function(t,e){return t?console.log(t):void r.afterRtcConnected(e)})})))}))}},v)})}),i}return r(e,t),c(e,[{key:"afterCreateView",value:function(){function t(){n=!0,console.log("rec canceled"),window.stopRecord&&window.stopRecord(),i&&(i.hide(),i=null),Laya.SoundManager.setMusicVolume(1)}this.assignAllBtns();var e=this.getVoiceBtn();if(e){var i=null,n=!1;e.on("mousedown",null,function(){window.startRecord&&(n=!1,Laya.SoundManager.setMusicVolume(.6),setTimeout(function(){n||(window.startRecord(),Laya.SoundManager.setMusicVolume(.2),p.RecWin&&(i=p.RecWin.inst,i.show()))},200))}),e.on("mouseup",null,function(){i?(setTimeout(function(){window.stopRecord&&window.stopRecord(function(t,e){return Laya.SoundManager.setMusicVolume(1),t?console.log(t):void(e&&_socket.sendp({c:"table.voice",token:e}))})},300),i.hide(),i=null):t()}),e.on("mouseout",null,t)}}},{key:"getUserMediaRect",value:function(t){u.fail("要使用视屏，必须自己实现这个函数。该函数返回对应seat(id)的视频区域，一般而言是用户的头像区")}},{key:"getVoiceBtn",value:function(){u.fail("自行实现这个函数，返回语音按钮")}},{key:"onVideoActived",value:function(){}},{key:"msg",value:function(t){return(t.gamedata||t.scene)&&this.gamedata._update(t.gamedata||t.scene),!0}},{key:"active",value:function(){var t=this;_socket.sendp({c:"createInviteCode"}),netmsg.once("inviteCode",null,function(e){t.inviteCode=e.v,window.preInvite&&window.preInvite(e.v,t.opt)}),this.mySeat=null,this.video2Icon(0),this._calls={}}},{key:"deactive",value:function(){this.gamedata.removeAllListeners(),this.hasQuit=!0,y.setDisconnectListener(null),y.disconnect();for(var t=b.getElementsByTagName("video"),e=0;e<t.length;e++)b.removeChild(t[e]);this._calls={}}},{key:"locateMe",value:function(t){if(!t)return-1;if(Array.isArray(t)){for(var e=0;e<t.length;e++){var i=t[e];if(i&&i.user&&i.user.id==_.id)return e}return-1}if("object"==("undefined"==typeof t?"undefined":l(t))){for(var e in t){var i=t[e];if(i&&i.user&&i.user.id==_.id)return e}return-1}return-1}},{key:"createHTMLDiv",value:function(t){var e={x:t.x,y:t.y,w:t.width,h:t.height},i=$("#layaCanvas"),n=Laya.stage.clientScaleX,r=Laya.stage.clientScaleY;e.x=e.x*n,e.y=e.y*r,e.w=e.w*n,e.h=e.h*r;var a=$('<div class="card" style="position:absolute;left:'+e.x+"px; top:"+e.y+"px; width:"+e.w+"px; height:"+e.h+'px"/>');return a.css("transform",i.css("transform")),a.css("transform-origin",""+-e.x+"px "+-e.y+"px"),$("#layaContainer").append(a),a}},{key:"createHTMLVideo",value:function(t){var e=document.createElement("video"),i=e.style,n=C.width/(960*(Laya.Browser.onIOS?devicePixelRatio:1)),r=C.width/(960*devicePixelRatio),a=-1==Number(C.style.transform.split(",")[2]);return i.left=(a?-t.y:t.x)*r+"px",i.top=(a?t.x:t.y)*r+"px",i.width=t.width*n+"px",i.height=t.height*n+"px",i.transform=C.style.transform,i.transformOrigin=C.style.transformOrigin,i.position="absolute",i["z-index"]=9999999,b.appendChild(e),e}},{key:"findUserLocalSeat",value:function(t){for(var e=this.gamedata,i=0;i<e.seats.length;i++){var n=e.seats[i];if(n&&n.user.id==t)return this.serverSeatToLocal(i)}return null}},{key:"serverSeatToLocal",value:function(t){return null==this.mySeat&&(this.mySeat=locateMe(this.gamedata.seats)),(this._seatNumber+t-this.mySeat)%this._seatNumber}},{key:"pausemsg",value:function(t){window.msgloop.pause(),t(function(){window.msgloop.resume()})}},{key:"chgVoiceBtnFunc",value:function(){var t=this;window.startRecord=function(){t.enableMicrophone()},window.stopRecord=function(e){t.enableMicrophone(!1),e&&e(null)}}},{key:"afterRtcConnected",value:function(t){if(!this.hasQuit){_socket.sendp({c:"table.extenddata",rtcid:t});var e=this.gamedata;e.once("extenddatachgd",function(){for(var t in e.extenddata)t!=_.id&&y.call(e.extenddata[t],v,v,v)})}}},{key:"icon2Video",value:function(t,e){var i=this.getUserMediaRect(t);if(!i)return null;console.log("chg",t,"to video");var n=createHTMLVideo(i,e);return this._calls[t]=n,i.visible=!1,n}},{key:"video2Icon",value:function(t){var e=this.getUserMediaRect(t);return e?(console.log("chg",t,"back to icon",e.url),e.visible=!0,void(this._calls[t]&&(b.removeChild(this._calls[t]),delete this._calls[t]))):null}},{key:"enableMicrophone",value:function(t){y.enableMicrophone(null==t?!0:t)}},{key:"disableMicrophone",value:function(){y.enableMicrophone(!1)}},{key:"enableCamera",value:function(t){y.enableCamera(null==t?!0:t)}},{key:"disableCamera",value:function(){y.enableCamera(!1)}}],[{key:"create",value:function(t,e){u.fail("必须自己实现create")}}]),e}(m);t.exports=S},,,,,,,,,,,function(t,e,i){t.exports=i.p+"loadiing@atlas_oy351.jpg?95ef9a08bd083a15838d7c2f84e8efbe"},function(t,e,i){t.exports=i.p+"loadiing@atlas0.png?07c4567fb430d0d360e726b6ef2b0d3f"},,,,,,,,,,,,,,,,,,,,,,,,function(t,e,i){var n,r,a,s,r,n,o,s,n,h,r,n,l,c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};/*!
	  Script: easyrtc_lang.js
	
	    Provides lang file.
	
	  About: License
	
	    Copyright (c) 2016, Priologic Software Inc.
	    All rights reserved.
	
	    Redistribution and use in source and binary forms, with or without
	    modification, are permitted provided that the following conditions are met:
	
	        * Redistributions of source code must retain the above copyright notice,
	          this list of conditions and the following disclaimer.
	        * Redistributions in binary form must reproduce the above copyright
	          notice, this list of conditions and the following disclaimer in the
	          documentation and/or other materials provided with the distribution.
	
	    THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
	    AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
	    IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
	    ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE
	    LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
	    CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
	    SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
	    INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
	    CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
	    ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
	    POSSIBILITY OF SUCH DAMAGE.
	*/
!function(r,a){n=a,!(h="function"==typeof n?n.call(e,i,e,t):n)}(void 0,function(t){"use strict";return{unableToEnterRoom:"Unable to enter room {0} because {1}",resolutionWarning:"Requested video size of {0}x{1} but got size of {2}x{3}",badUserName:"Illegal username {0}",localMediaError:"Error getting local media stream: {0}",miscSignalError:"Miscellaneous error from signalling server. It may be ignorable.",noServer:"Unable to reach the EasyRTC signalling server.",badsocket:"Socket.io connect event fired with bad websocket.",icf:"Internal communications failure",statsNotSupported:"call statistics not supported by this browser, try Chrome.",noWebrtcSupport:"Your browser doesn't appear to support WebRTC.",gumFailed:"Failed to get access to local media. Error code was {0}.",requireAudioOrVideo:"At least one of audio and video must be provided"}}),function(i){if("object"===c(e)&&"undefined"!=typeof t)t.exports=i();else{r=[],n=i,!(o="function"==typeof n?n.apply(e,r):n)}}(function(){return function t(e,i,n){function r(o,h){if(!i[o]){if(!e[o]){var l="function"==typeof s&&s;if(!h&&l)return s(o,!0);if(a)return a(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var u=i[o]={exports:{}};e[o][0].call(u.exports,function(t){var i=e[o][1][t];return r(i?i:t)},u,u.exports,t,e,i,n)}return i[o].exports}for(var a="function"==typeof s&&s,o=0;o<n.length;o++)r(n[o]);return r}({1:[function(t,e,i){var n={};n.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)},n.localCName=n.generateIdentifier(),n.splitLines=function(t){return t.trim().split("\n").map(function(t){return t.trim()})},n.splitSections=function(t){var e=t.split("\nm=");return e.map(function(t,e){return(e>0?"m="+t:t).trim()+"\r\n"})},n.matchPrefix=function(t,e){return n.splitLines(t).filter(function(t){return 0===t.indexOf(e)})},n.parseCandidate=function(t){var e;e=0===t.indexOf("a=candidate:")?t.substring(12).split(" "):t.substring(10).split(" ");for(var i={foundation:e[0],component:e[1],protocol:e[2].toLowerCase(),priority:parseInt(e[3],10),ip:e[4],port:parseInt(e[5],10),type:e[7]},n=8;n<e.length;n+=2)switch(e[n]){case"raddr":i.relatedAddress=e[n+1];break;case"rport":i.relatedPort=parseInt(e[n+1],10);break;case"tcptype":i.tcpType=e[n+1]}return i},n.writeCandidate=function(t){var e=[];e.push(t.foundation),e.push(t.component),e.push(t.protocol.toUpperCase()),e.push(t.priority),e.push(t.ip),e.push(t.port);var i=t.type;return e.push("typ"),e.push(i),"host"!==i&&t.relatedAddress&&t.relatedPort&&(e.push("raddr"),e.push(t.relatedAddress),e.push("rport"),e.push(t.relatedPort)),t.tcpType&&"tcp"===t.protocol.toLowerCase()&&(e.push("tcptype"),e.push(t.tcpType)),"candidate:"+e.join(" ")},n.parseRtpMap=function(t){var e=t.substr(9).split(" "),i={payloadType:parseInt(e.shift(),10)};return e=e[0].split("/"),i.name=e[0],i.clockRate=parseInt(e[1],10),i.numChannels=3===e.length?parseInt(e[2],10):1,i},n.writeRtpMap=function(t){var e=t.payloadType;return void 0!==t.preferredPayloadType&&(e=t.preferredPayloadType),"a=rtpmap:"+e+" "+t.name+"/"+t.clockRate+(1!==t.numChannels?"/"+t.numChannels:"")+"\r\n"},n.parseExtmap=function(t){var e=t.substr(9).split(" ");return{id:parseInt(e[0],10),uri:e[1]}},n.writeExtmap=function(t){return"a=extmap:"+(t.id||t.preferredId)+" "+t.uri+"\r\n"},n.parseFmtp=function(t){for(var e,i={},n=t.substr(t.indexOf(" ")+1).split(";"),r=0;r<n.length;r++)e=n[r].trim().split("="),i[e[0].trim()]=e[1];return i},n.writeFmtp=function(t){var e="",i=t.payloadType;if(void 0!==t.preferredPayloadType&&(i=t.preferredPayloadType),t.parameters&&Object.keys(t.parameters).length){var n=[];Object.keys(t.parameters).forEach(function(e){n.push(e+"="+t.parameters[e])}),e+="a=fmtp:"+i+" "+n.join(";")+"\r\n"}return e},n.parseRtcpFb=function(t){var e=t.substr(t.indexOf(" ")+1).split(" ");return{type:e.shift(),parameter:e.join(" ")}},n.writeRtcpFb=function(t){var e="",i=t.payloadType;return void 0!==t.preferredPayloadType&&(i=t.preferredPayloadType),t.rtcpFeedback&&t.rtcpFeedback.length&&t.rtcpFeedback.forEach(function(t){e+="a=rtcp-fb:"+i+" "+t.type+(t.parameter&&t.parameter.length?" "+t.parameter:"")+"\r\n"}),e},n.parseSsrcMedia=function(t){var e=t.indexOf(" "),i={ssrc:parseInt(t.substr(7,e-7),10)},n=t.indexOf(":",e);return n>-1?(i.attribute=t.substr(e+1,n-e-1),i.value=t.substr(n+1)):i.attribute=t.substr(e+1),i},n.getDtlsParameters=function(t,e){var i=n.splitLines(t);i=i.concat(n.splitLines(e));var r=i.filter(function(t){return 0===t.indexOf("a=fingerprint:")})[0].substr(14),a={role:"auto",fingerprints:[{algorithm:r.split(" ")[0],value:r.split(" ")[1]}]};return a},n.writeDtlsParameters=function(t,e){var i="a=setup:"+e+"\r\n";return t.fingerprints.forEach(function(t){i+="a=fingerprint:"+t.algorithm+" "+t.value+"\r\n"}),i},n.getIceParameters=function(t,e){var i=n.splitLines(t);i=i.concat(n.splitLines(e));var r={usernameFragment:i.filter(function(t){return 0===t.indexOf("a=ice-ufrag:")})[0].substr(12),password:i.filter(function(t){return 0===t.indexOf("a=ice-pwd:")})[0].substr(10)};return r},n.writeIceParameters=function(t){return"a=ice-ufrag:"+t.usernameFragment+"\r\na=ice-pwd:"+t.password+"\r\n"},n.parseRtpParameters=function(t){for(var e={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=n.splitLines(t),r=i[0].split(" "),a=3;a<r.length;a++){var s=r[a],o=n.matchPrefix(t,"a=rtpmap:"+s+" ")[0];if(o){var h=n.parseRtpMap(o),l=n.matchPrefix(t,"a=fmtp:"+s+" ");switch(h.parameters=l.length?n.parseFmtp(l[0]):{},h.rtcpFeedback=n.matchPrefix(t,"a=rtcp-fb:"+s+" ").map(n.parseRtcpFb),e.codecs.push(h),h.name.toUpperCase()){case"RED":case"ULPFEC":e.fecMechanisms.push(h.name.toUpperCase())}}}return n.matchPrefix(t,"a=extmap:").forEach(function(t){e.headerExtensions.push(n.parseExtmap(t))}),e},n.writeRtpDescription=function(t,e){var i="";return i+="m="+t+" ",i+=e.codecs.length>0?"9":"0",i+=" UDP/TLS/RTP/SAVPF ",i+=e.codecs.map(function(t){return void 0!==t.preferredPayloadType?t.preferredPayloadType:t.payloadType}).join(" ")+"\r\n",i+="c=IN IP4 0.0.0.0\r\n",i+="a=rtcp:9 IN IP4 0.0.0.0\r\n",e.codecs.forEach(function(t){i+=n.writeRtpMap(t),i+=n.writeFmtp(t),i+=n.writeRtcpFb(t)}),i+="a=rtcp-mux\r\n"},n.parseRtpEncodingParameters=function(t){var e,i=[],r=n.parseRtpParameters(t),a=-1!==r.fecMechanisms.indexOf("RED"),s=-1!==r.fecMechanisms.indexOf("ULPFEC"),o=n.matchPrefix(t,"a=ssrc:").map(function(t){return n.parseSsrcMedia(t)}).filter(function(t){return"cname"===t.attribute}),h=o.length>0&&o[0].ssrc,l=n.matchPrefix(t,"a=ssrc-group:FID").map(function(t){var e=t.split(" ");return e.shift(),e.map(function(t){return parseInt(t,10)})});l.length>0&&l[0].length>1&&l[0][0]===h&&(e=l[0][1]),r.codecs.forEach(function(t){if("RTX"===t.name.toUpperCase()&&t.parameters.apt){var n={ssrc:h,codecPayloadType:parseInt(t.parameters.apt,10),rtx:{payloadType:t.payloadType,ssrc:e}};i.push(n),a&&(n=JSON.parse(JSON.stringify(n)),n.fec={ssrc:e,mechanism:s?"red+ulpfec":"red"},i.push(n))}}),0===i.length&&h&&i.push({ssrc:h});var c=n.matchPrefix(t,"b=");return c.length&&(0===c[0].indexOf("b=TIAS:")?c=parseInt(c[0].substr(7),10):0===c[0].indexOf("b=AS:")&&(c=parseInt(c[0].substr(5),10)),i.forEach(function(t){t.maxBitrate=c})),i},n.writeSessionBoilerplate=function(){return"v=0\r\no=thisisadapterortc 8169639915646943137 2 IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},n.writeMediaSection=function(t,e,i,r){var a=n.writeRtpDescription(t.kind,e);if(a+=n.writeIceParameters(t.iceGatherer.getLocalParameters()),a+=n.writeDtlsParameters(t.dtlsTransport.getLocalParameters(),"offer"===i?"actpass":"active"),a+="a=mid:"+t.mid+"\r\n",a+=t.rtpSender&&t.rtpReceiver?"a=sendrecv\r\n":t.rtpSender?"a=sendonly\r\n":t.rtpReceiver?"a=recvonly\r\n":"a=inactive\r\n",t.rtpSender){var s="msid:"+r.id+" "+t.rtpSender.track.id+"\r\n";a+="a="+s,a+="a=ssrc:"+t.sendEncodingParameters[0].ssrc+" "+s}return a+="a=ssrc:"+t.sendEncodingParameters[0].ssrc+" cname:"+n.localCName+"\r\n"},n.getDirection=function(t,e){for(var i=n.splitLines(t),r=0;r<i.length;r++)switch(i[r]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[r].substr(2)}return e?n.getDirection(e):"sendrecv"},e.exports=n},{}],2:[function(t,e,i){!function(){var i=t("./utils").log,n=t("./utils").browserDetails;e.exports.browserDetails=n,e.exports.extractVersion=t("./utils").extractVersion,e.exports.disableLog=t("./utils").disableLog;var r=t("./chrome/chrome_shim")||null,a=t("./edge/edge_shim")||null,s=t("./firefox/firefox_shim")||null,o=t("./safari/safari_shim")||null;switch(n.browser){case"opera":case"chrome":if(!r||!r.shimPeerConnection)return void i("Chrome shim is not included in this adapter release.");i("adapter.js shimming chrome."),e.exports.browserShim=r,r.shimGetUserMedia(),r.shimMediaStream(),r.shimSourceObject(),r.shimPeerConnection(),r.shimOnTrack();break;case"firefox":if(!s||!s.shimPeerConnection)return void i("Firefox shim is not included in this adapter release.");i("adapter.js shimming firefox."),e.exports.browserShim=s,s.shimGetUserMedia(),s.shimSourceObject(),s.shimPeerConnection(),s.shimOnTrack();break;case"edge":if(!a||!a.shimPeerConnection)return void i("MS edge shim is not included in this adapter release.");i("adapter.js shimming edge."),e.exports.browserShim=a,a.shimGetUserMedia(),a.shimPeerConnection();break;case"safari":if(!o)return void i("Safari shim is not included in this adapter release.");i("adapter.js shimming safari."),e.exports.browserShim=o,o.shimGetUserMedia();break;default:i("Unsupported browser!")}}()},{"./chrome/chrome_shim":3,"./edge/edge_shim":5,"./firefox/firefox_shim":7,"./safari/safari_shim":9,"./utils":10}],3:[function(t,e,i){var n=t("../utils.js").log,r=t("../utils.js").browserDetails,a={shimMediaStream:function(){window.MediaStream=window.MediaStream||window.webkitMediaStream},shimOnTrack:function(){"object"!==("undefined"==typeof window?"undefined":c(window))||!window.RTCPeerConnection||"ontrack"in window.RTCPeerConnection.prototype||Object.defineProperty(window.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(t){var e=this;this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=t),this.addEventListener("addstream",this._ontrackpoly=function(t){t.stream.addEventListener("addtrack",function(i){var n=new Event("track");n.track=i.track,n.receiver={track:i.track},n.streams=[t.stream],e.dispatchEvent(n)}),t.stream.getTracks().forEach(function(e){var i=new Event("track");i.track=e,i.receiver={track:e},i.streams=[t.stream],this.dispatchEvent(i)}.bind(this))}.bind(this))}})},shimSourceObject:function(){"object"===("undefined"==typeof window?"undefined":c(window))&&(!window.HTMLMediaElement||"srcObject"in window.HTMLMediaElement.prototype||Object.defineProperty(window.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(t){var e=this;return this._srcObject=t,this.src&&URL.revokeObjectURL(this.src),t?(this.src=URL.createObjectURL(t),t.addEventListener("addtrack",function(){e.src&&URL.revokeObjectURL(e.src),e.src=URL.createObjectURL(t)}),void t.addEventListener("removetrack",function(){e.src&&URL.revokeObjectURL(e.src),e.src=URL.createObjectURL(t)})):void(this.src="")}}))},shimPeerConnection:function(){window.RTCPeerConnection=function(t,e){n("PeerConnection"),t&&t.iceTransportPolicy&&(t.iceTransports=t.iceTransportPolicy);var i=new webkitRTCPeerConnection(t,e),r=i.getStats.bind(i);return i.getStats=function(t,e,i){var n=this,a=arguments;if(arguments.length>0&&"function"==typeof t)return r(t,e);var s=function(t){var e={},i=t.result();return i.forEach(function(t){var i={id:t.id,timestamp:t.timestamp,type:t.type};t.names().forEach(function(e){i[e]=t.stat(e)}),e[i.id]=i}),e},o=function(t,e){var i=new Map(Object.keys(t).map(function(e){return[e,t[e]]}));return e=e||t,Object.keys(e).forEach(function(t){i[t]=e[t]}),i};if(arguments.length>=2){var h=function(t){a[1](o(s(t)))};return r.apply(this,[h,arguments[0]])}return new Promise(function(e,i){1===a.length&&"object"===("undefined"==typeof t?"undefined":c(t))?r.apply(n,[function(t){e(o(s(t)))},i]):r.apply(n,[function(t){e(o(s(t),t.result()))},i])}).then(e,i)},i},window.RTCPeerConnection.prototype=webkitRTCPeerConnection.prototype,webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:function(){return webkitRTCPeerConnection.generateCertificate}}),["createOffer","createAnswer"].forEach(function(t){var e=webkitRTCPeerConnection.prototype[t];webkitRTCPeerConnection.prototype[t]=function(){var t=this;if(arguments.length<1||1===arguments.length&&"object"===c(arguments[0])){var i=1===arguments.length?arguments[0]:void 0;return new Promise(function(n,r){e.apply(t,[n,r,i])})}return e.apply(this,arguments)}}),r.version<51&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var e=webkitRTCPeerConnection.prototype[t];webkitRTCPeerConnection.prototype[t]=function(){var t=arguments,i=this,n=new Promise(function(n,r){e.apply(i,[t[0],n,r])});return t.length<2?n:n.then(function(){t[1].apply(null,[])},function(e){t.length>=3&&t[2].apply(null,[e])})}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var e=webkitRTCPeerConnection.prototype[t];webkitRTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?RTCIceCandidate:RTCSessionDescription)(arguments[0]),e.apply(this,arguments)}});var t=RTCPeerConnection.prototype.addIceCandidate;RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?t.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}};e.exports={shimMediaStream:a.shimMediaStream,shimOnTrack:a.shimOnTrack,shimSourceObject:a.shimSourceObject,shimPeerConnection:a.shimPeerConnection,shimGetUserMedia:t("./getusermedia")}},{"../utils.js":10,"./getusermedia":4}],4:[function(t,e,i){var n=t("../utils.js").log;e.exports=function(){var t=function(t){if("object"!==("undefined"==typeof t?"undefined":c(t))||t.mandatory||t.optional)return t;var e={};return Object.keys(t).forEach(function(i){if("require"!==i&&"advanced"!==i&&"mediaSource"!==i){var n="object"===c(t[i])?t[i]:{ideal:t[i]};void 0!==n.exact&&"number"==typeof n.exact&&(n.min=n.max=n.exact);var r=function(t,e){return t?t+e.charAt(0).toUpperCase()+e.slice(1):"deviceId"===e?"sourceId":e};if(void 0!==n.ideal){e.optional=e.optional||[];var a={};"number"==typeof n.ideal?(a[r("min",i)]=n.ideal,e.optional.push(a),a={},a[r("max",i)]=n.ideal,e.optional.push(a)):(a[r("",i)]=n.ideal,e.optional.push(a))}void 0!==n.exact&&"number"!=typeof n.exact?(e.mandatory=e.mandatory||{},e.mandatory[r("",i)]=n.exact):["min","max"].forEach(function(t){void 0!==n[t]&&(e.mandatory=e.mandatory||{},e.mandatory[r(t,i)]=n[t])})}}),t.advanced&&(e.optional=(e.optional||[]).concat(t.advanced)),e},e=function(e,i){if(e=JSON.parse(JSON.stringify(e)),e&&e.audio&&(e.audio=t(e.audio)),e&&"object"===c(e.video)){var r=e.video.facingMode;if(r=r&&("object"===("undefined"==typeof r?"undefined":c(r))?r:{ideal:r}),r&&("user"===r.exact||"environment"===r.exact||"user"===r.ideal||"environment"===r.ideal)&&(!navigator.mediaDevices.getSupportedConstraints||!navigator.mediaDevices.getSupportedConstraints().facingMode)&&(delete e.video.facingMode,"environment"===r.exact||"environment"===r.ideal))return navigator.mediaDevices.enumerateDevices().then(function(a){a=a.filter(function(t){return"videoinput"===t.kind});var s=a.find(function(t){return-1!==t.label.toLowerCase().indexOf("back")})||a.length&&a[a.length-1];return s&&(e.video.deviceId=r.exact?{exact:s.deviceId}:{ideal:s.deviceId}),e.video=t(e.video),n("chrome: "+JSON.stringify(e)),i(e)});e.video=t(e.video)}return n("chrome: "+JSON.stringify(e)),i(e)},i=function(t){return{name:{PermissionDeniedError:"NotAllowedError",ConstraintNotSatisfiedError:"OverconstrainedError"}[t.name]||t.name,message:t.message,constraint:t.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}},r=function(t,n,r){e(t,function(t){navigator.webkitGetUserMedia(t,n,function(t){r(i(t))})})};navigator.getUserMedia=r;var a=function(t){return new Promise(function(e,i){navigator.getUserMedia(t,e,i)})};if(navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:a,enumerateDevices:function(){return new Promise(function(t){var e={audio:"audioinput",video:"videoinput"};return MediaStreamTrack.getSources(function(i){t(i.map(function(t){return{label:t.label,kind:e[t.kind],deviceId:t.id,groupId:""}}))})})}}),navigator.mediaDevices.getUserMedia){var s=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(t){return e(t,function(t){return s(t).then(function(e){if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach(function(t){t.stop()}),new DOMException("","NotFoundError");return e},function(t){return Promise.reject(i(t))})})}}else navigator.mediaDevices.getUserMedia=function(t){return a(t)};"undefined"==typeof navigator.mediaDevices.addEventListener&&(navigator.mediaDevices.addEventListener=function(){n("Dummy mediaDevices.addEventListener called.")}),"undefined"==typeof navigator.mediaDevices.removeEventListener&&(navigator.mediaDevices.removeEventListener=function(){n("Dummy mediaDevices.removeEventListener called.")})}},{"../utils.js":10}],5:[function(t,e,i){var n=t("sdp"),r=t("../utils").browserDetails,a={shimPeerConnection:function(){if(window.RTCIceGatherer){window.RTCIceCandidate||(window.RTCIceCandidate=function(t){return t}),window.RTCSessionDescription||(window.RTCSessionDescription=function(t){return t});var t=Object.getOwnPropertyDescriptor(MediaStreamTrack.prototype,"enabled");Object.defineProperty(MediaStreamTrack.prototype,"enabled",{set:function(e){t.set.call(this,e);var i=new Event("enabled");i.enabled=e,this.dispatchEvent(i)}})}window.RTCPeerConnection=function(t){var e=this,i=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(t){e[t]=i[t].bind(i)}),this.onicecandidate=null,this.onaddstream=null,this.ontrack=null,this.onremovestream=null,this.onsignalingstatechange=null,this.oniceconnectionstatechange=null,this.onnegotiationneeded=null,this.ondatachannel=null,this.localStreams=[],this.remoteStreams=[],this.getLocalStreams=function(){return e.localStreams},this.getRemoteStreams=function(){return e.remoteStreams},this.localDescription=new RTCSessionDescription({type:"",sdp:""}),this.remoteDescription=new RTCSessionDescription({type:"",sdp:""}),this.signalingState="stable",this.iceConnectionState="new",this.iceGatheringState="new",this.iceOptions={gatherPolicy:"all",iceServers:[]},t&&t.iceTransportPolicy)switch(t.iceTransportPolicy){case"all":case"relay":this.iceOptions.gatherPolicy=t.iceTransportPolicy;break;case"none":throw new TypeError('iceTransportPolicy "none" not supported')}if(this.usingBundle=t&&"max-bundle"===t.bundlePolicy,t&&t.iceServers){var n=JSON.parse(JSON.stringify(t.iceServers));this.iceOptions.iceServers=n.filter(function(t){if(t&&t.urls){var e=t.urls;return"string"==typeof e&&(e=[e]),e=e.filter(function(t){return 0===t.indexOf("turn:")&&-1!==t.indexOf("transport=udp")&&-1===t.indexOf("turn:[")||0===t.indexOf("stun:")&&r.version>=14393})[0],!!e}return!1})}this._config=t,this.transceivers=[],this._localIceCandidatesBuffer=[]},window.RTCPeerConnection.prototype._emitBufferedCandidates=function(){var t=this,e=n.splitSections(t.localDescription.sdp);this._localIceCandidatesBuffer.forEach(function(i){var n=!i.candidate||0===Object.keys(i.candidate).length;if(n)for(var r=1;r<e.length;r++)-1===e[r].indexOf("\r\na=end-of-candidates\r\n")&&(e[r]+="a=end-of-candidates\r\n");else-1===i.candidate.candidate.indexOf("typ endOfCandidates")&&(e[i.candidate.sdpMLineIndex+1]+="a="+i.candidate.candidate+"\r\n");if(t.localDescription.sdp=e.join(""),t.dispatchEvent(i),null!==t.onicecandidate&&t.onicecandidate(i),!i.candidate&&"complete"!==t.iceGatheringState){var a=t.transceivers.every(function(t){return t.iceGatherer&&"completed"===t.iceGatherer.state});a&&(t.iceGatheringState="complete")}}),this._localIceCandidatesBuffer=[]},window.RTCPeerConnection.prototype.getConfiguration=function(){return this._config},window.RTCPeerConnection.prototype.addStream=function(t){var e=t.clone();t.getTracks().forEach(function(t,i){var n=e.getTracks()[i];t.addEventListener("enabled",function(t){n.enabled=t.enabled})}),this.localStreams.push(e),this._maybeFireNegotiationNeeded()},window.RTCPeerConnection.prototype.removeStream=function(t){var e=this.localStreams.indexOf(t);e>-1&&(this.localStreams.splice(e,1),this._maybeFireNegotiationNeeded())},window.RTCPeerConnection.prototype.getSenders=function(){return this.transceivers.filter(function(t){return!!t.rtpSender}).map(function(t){return t.rtpSender})},window.RTCPeerConnection.prototype.getReceivers=function(){return this.transceivers.filter(function(t){return!!t.rtpReceiver}).map(function(t){return t.rtpReceiver})},window.RTCPeerConnection.prototype._getCommonCapabilities=function(t,e){var i={codecs:[],headerExtensions:[],fecMechanisms:[]};return t.codecs.forEach(function(t){for(var n=0;n<e.codecs.length;n++){var r=e.codecs[n];if(t.name.toLowerCase()===r.name.toLowerCase()&&t.clockRate===r.clockRate){r.numChannels=Math.min(t.numChannels,r.numChannels),i.codecs.push(r),r.rtcpFeedback=r.rtcpFeedback.filter(function(e){for(var i=0;i<t.rtcpFeedback.length;i++)if(t.rtcpFeedback[i].type===e.type&&t.rtcpFeedback[i].parameter===e.parameter)return!0;return!1});break}}}),t.headerExtensions.forEach(function(t){for(var n=0;n<e.headerExtensions.length;n++){var r=e.headerExtensions[n];if(t.uri===r.uri){i.headerExtensions.push(r);break}}}),i},window.RTCPeerConnection.prototype._createIceAndDtlsTransports=function(t,e){var i=this,r=new RTCIceGatherer(i.iceOptions),a=new RTCIceTransport(r);r.onlocalcandidate=function(s){var o=new Event("icecandidate");o.candidate={sdpMid:t,sdpMLineIndex:e};var h=s.candidate,l=!h||0===Object.keys(h).length;l?(void 0===r.state&&(r.state="completed"),o.candidate.candidate="candidate:1 1 udp 1 0.0.0.0 9 typ endOfCandidates"):(h.component="RTCP"===a.component?2:1,o.candidate.candidate=n.writeCandidate(h));var c=n.splitSections(i.localDescription.sdp);-1===o.candidate.candidate.indexOf("typ endOfCandidates")?c[o.candidate.sdpMLineIndex+1]+="a="+o.candidate.candidate+"\r\n":c[o.candidate.sdpMLineIndex+1]+="a=end-of-candidates\r\n",i.localDescription.sdp=c.join("");var u=i.transceivers.every(function(t){return t.iceGatherer&&"completed"===t.iceGatherer.state});switch(i.iceGatheringState){case"new":i._localIceCandidatesBuffer.push(o),l&&u&&i._localIceCandidatesBuffer.push(new Event("icecandidate"));break;case"gathering":i._emitBufferedCandidates(),i.dispatchEvent(o),null!==i.onicecandidate&&i.onicecandidate(o),u&&(i.dispatchEvent(new Event("icecandidate")),null!==i.onicecandidate&&i.onicecandidate(new Event("icecandidate")),i.iceGatheringState="complete");break;case"complete":}},a.onicestatechange=function(){i._updateConnectionState()};var s=new RTCDtlsTransport(a);return s.ondtlsstatechange=function(){i._updateConnectionState()},s.onerror=function(){s.state="failed",i._updateConnectionState()},{iceGatherer:r,iceTransport:a,dtlsTransport:s}},window.RTCPeerConnection.prototype._transceive=function(t,e,i){var r=this._getCommonCapabilities(t.localCapabilities,t.remoteCapabilities);e&&t.rtpSender&&(r.encodings=t.sendEncodingParameters,r.rtcp={cname:n.localCName},t.recvEncodingParameters.length&&(r.rtcp.ssrc=t.recvEncodingParameters[0].ssrc),t.rtpSender.send(r)),i&&t.rtpReceiver&&("video"===t.kind&&t.recvEncodingParameters&&t.recvEncodingParameters.forEach(function(t){delete t.rtx}),r.encodings=t.recvEncodingParameters,r.rtcp={cname:t.cname},t.sendEncodingParameters.length&&(r.rtcp.ssrc=t.sendEncodingParameters[0].ssrc),t.rtpReceiver.receive(r))},window.RTCPeerConnection.prototype.setLocalDescription=function(t){var e,i,r=this;if("offer"===t.type)this._pendingOffer&&(e=n.splitSections(t.sdp),i=e.shift(),e.forEach(function(t,e){var i=n.parseRtpParameters(t);r._pendingOffer[e].localCapabilities=i}),this.transceivers=this._pendingOffer,delete this._pendingOffer);else if("answer"===t.type){e=n.splitSections(r.remoteDescription.sdp),i=e.shift();var a=n.matchPrefix(i,"a=ice-lite").length>0;e.forEach(function(t,e){var s=r.transceivers[e],o=s.iceGatherer,h=s.iceTransport,l=s.dtlsTransport,c=s.localCapabilities,u=s.remoteCapabilities,d="0"===t.split("\n",1)[0].split(" ",2)[1];if(!d&&!s.isDatachannel){var f=n.getIceParameters(t,i);if(a){var _=n.matchPrefix(t,"a=candidate:").map(function(t){return n.parseCandidate(t)}).filter(function(t){return"1"===t.component});_.length&&h.setRemoteCandidates(_)}var p=n.getDtlsParameters(t,i);a&&(p.role="server"),r.usingBundle&&0!==e||(h.start(o,f,a?"controlling":"controlled"),l.start(p));var m=r._getCommonCapabilities(c,u);r._transceive(s,m.codecs.length>0,!1)}})}switch(this.localDescription={type:t.type,sdp:t.sdp},t.type){case"offer":this._updateSignalingState("have-local-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+t.type+'"')}var s=arguments.length>1&&"function"==typeof arguments[1];if(s){var o=arguments[1];window.setTimeout(function(){o(),"new"===r.iceGatheringState&&(r.iceGatheringState="gathering"),r._emitBufferedCandidates()},0)}var h=Promise.resolve();return h.then(function(){s||("new"===r.iceGatheringState&&(r.iceGatheringState="gathering"),window.setTimeout(r._emitBufferedCandidates.bind(r),500))}),h},window.RTCPeerConnection.prototype.setRemoteDescription=function(t){var e=this,i=new MediaStream,r=[],a=n.splitSections(t.sdp),s=a.shift(),o=n.matchPrefix(s,"a=ice-lite").length>0;switch(this.usingBundle=n.matchPrefix(s,"a=group:BUNDLE ").length>0,a.forEach(function(a,h){var l=n.splitLines(a),c=l[0].substr(2).split(" "),u=c[0],d="0"===c[1],f=n.getDirection(a,s),_=n.matchPrefix(a,"a=mid:");if(_=_.length?_[0].substr(6):n.generateIdentifier(),"application"===u&&"DTLS/SCTP"===c[2])return void(e.transceivers[h]={mid:_,isDatachannel:!0});var p,m,g,y,v,x,w,b,C,S,E,T,M=n.parseRtpParameters(a);d||(E=n.getIceParameters(a,s),T=n.getDtlsParameters(a,s),T.role="client"),b=n.parseRtpEncodingParameters(a);var R,A=n.matchPrefix(a,"a=ssrc:").map(function(t){return n.parseSsrcMedia(t)}).filter(function(t){return"cname"===t.attribute})[0];A&&(R=A.value);var D=n.matchPrefix(a,"a=end-of-candidates",s).length>0,I=n.matchPrefix(a,"a=candidate:").map(function(t){return n.parseCandidate(t)}).filter(function(t){return"1"===t.component});if("offer"!==t.type||d)"answer"!==t.type||d||(p=e.transceivers[h],m=p.iceGatherer,g=p.iceTransport,y=p.dtlsTransport,v=p.rtpSender,x=p.rtpReceiver,w=p.sendEncodingParameters,C=p.localCapabilities,e.transceivers[h].recvEncodingParameters=b,e.transceivers[h].remoteCapabilities=M,e.transceivers[h].cname=R,(o||D)&&I.length&&g.setRemoteCandidates(I),e.usingBundle&&0!==h||(g.start(m,E,"controlling"),y.start(T)),e._transceive(p,"sendrecv"===f||"recvonly"===f,"sendrecv"===f||"sendonly"===f),!x||"sendrecv"!==f&&"sendonly"!==f?delete p.rtpReceiver:(S=x.track,r.push([S,x]),i.addTrack(S)));else{var P=e.usingBundle&&h>0?{iceGatherer:e.transceivers[0].iceGatherer,iceTransport:e.transceivers[0].iceTransport,dtlsTransport:e.transceivers[0].dtlsTransport}:e._createIceAndDtlsTransports(_,h);if(D&&P.iceTransport.setRemoteCandidates(I),C=RTCRtpReceiver.getCapabilities(u),C.codecs=C.codecs.filter(function(t){return"rtx"!==t.name}),w=[{ssrc:1001*(2*h+2)}],x=new RTCRtpReceiver(P.dtlsTransport,u),S=x.track,r.push([S,x]),i.addTrack(S),e.localStreams.length>0&&e.localStreams[0].getTracks().length>=h){var O;"audio"===u?O=e.localStreams[0].getAudioTracks()[0]:"video"===u&&(O=e.localStreams[0].getVideoTracks()[0]),O&&(v=new RTCRtpSender(O,P.dtlsTransport))}e.transceivers[h]={iceGatherer:P.iceGatherer,iceTransport:P.iceTransport,dtlsTransport:P.dtlsTransport,localCapabilities:C,remoteCapabilities:M,rtpSender:v,rtpReceiver:x,kind:u,mid:_,cname:R,sendEncodingParameters:w,recvEncodingParameters:b},e._transceive(e.transceivers[h],!1,"sendrecv"===f||"sendonly"===f)}}),this.remoteDescription={type:t.type,sdp:t.sdp},t.type){case"offer":this._updateSignalingState("have-remote-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+t.type+'"')}return i.getTracks().length&&(e.remoteStreams.push(i),window.setTimeout(function(){var t=new Event("addstream");t.stream=i,e.dispatchEvent(t),null!==e.onaddstream&&window.setTimeout(function(){e.onaddstream(t)},0),r.forEach(function(n){var r=n[0],a=n[1],s=new Event("track");s.track=r,s.receiver=a,s.streams=[i],e.dispatchEvent(t),null!==e.ontrack&&window.setTimeout(function(){e.ontrack(s)},0)})},0)),arguments.length>1&&"function"==typeof arguments[1]&&window.setTimeout(arguments[1],0),Promise.resolve()},window.RTCPeerConnection.prototype.close=function(){this.transceivers.forEach(function(t){t.iceTransport&&t.iceTransport.stop(),t.dtlsTransport&&t.dtlsTransport.stop(),t.rtpSender&&t.rtpSender.stop(),t.rtpReceiver&&t.rtpReceiver.stop()}),this._updateSignalingState("closed")},window.RTCPeerConnection.prototype._updateSignalingState=function(t){this.signalingState=t;var e=new Event("signalingstatechange");this.dispatchEvent(e),null!==this.onsignalingstatechange&&this.onsignalingstatechange(e)},window.RTCPeerConnection.prototype._maybeFireNegotiationNeeded=function(){var t=new Event("negotiationneeded");this.dispatchEvent(t),null!==this.onnegotiationneeded&&this.onnegotiationneeded(t)},window.RTCPeerConnection.prototype._updateConnectionState=function(){var t,e=this,i={"new":0,closed:0,connecting:0,checking:0,connected:0,completed:0,failed:0};if(this.transceivers.forEach(function(t){i[t.iceTransport.state]++,i[t.dtlsTransport.state]++}),i.connected+=i.completed,t="new",i.failed>0?t="failed":i.connecting>0||i.checking>0?t="connecting":i.disconnected>0?t="disconnected":i["new"]>0?t="new":(i.connected>0||i.completed>0)&&(t="connected"),t!==e.iceConnectionState){e.iceConnectionState=t;var n=new Event("iceconnectionstatechange");this.dispatchEvent(n),null!==this.oniceconnectionstatechange&&this.oniceconnectionstatechange(n)}},window.RTCPeerConnection.prototype.createOffer=function(){var t=this;if(this._pendingOffer)throw new Error("createOffer called while there is a pending offer.");var e;1===arguments.length&&"function"!=typeof arguments[0]?e=arguments[0]:3===arguments.length&&(e=arguments[2]);var i=[],r=0,a=0;if(this.localStreams.length&&(r=this.localStreams[0].getAudioTracks().length,a=this.localStreams[0].getVideoTracks().length),e){if(e.mandatory||e.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==e.offerToReceiveAudio&&(r=e.offerToReceiveAudio),void 0!==e.offerToReceiveVideo&&(a=e.offerToReceiveVideo)}for(this.localStreams.length&&this.localStreams[0].getTracks().forEach(function(t){i.push({kind:t.kind,track:t,wantReceive:"audio"===t.kind?r>0:a>0}),"audio"===t.kind?r--:"video"===t.kind&&a--});r>0||a>0;)r>0&&(i.push({kind:"audio",wantReceive:!0}),r--),a>0&&(i.push({kind:"video",wantReceive:!0}),a--);var s=n.writeSessionBoilerplate(),o=[];i.forEach(function(e,i){var r=e.track,a=e.kind,s=n.generateIdentifier(),h=t.usingBundle&&i>0?{iceGatherer:o[0].iceGatherer,iceTransport:o[0].iceTransport,dtlsTransport:o[0].dtlsTransport}:t._createIceAndDtlsTransports(s,i),l=RTCRtpSender.getCapabilities(a);l.codecs=l.codecs.filter(function(t){return"rtx"!==t.name}),l.codecs.forEach(function(t){"H264"===t.name&&void 0===t.parameters["level-asymmetry-allowed"]&&(t.parameters["level-asymmetry-allowed"]="1")});var c,u,d=[{ssrc:1001*(2*i+1)}];r&&(c=new RTCRtpSender(r,h.dtlsTransport)),e.wantReceive&&(u=new RTCRtpReceiver(h.dtlsTransport,a)),o[i]={iceGatherer:h.iceGatherer,iceTransport:h.iceTransport,
dtlsTransport:h.dtlsTransport,localCapabilities:l,remoteCapabilities:null,rtpSender:c,rtpReceiver:u,kind:a,mid:s,sendEncodingParameters:d,recvEncodingParameters:null}}),this.usingBundle&&(s+="a=group:BUNDLE "+o.map(function(t){return t.mid}).join(" ")+"\r\n"),i.forEach(function(e,i){var r=o[i];s+=n.writeMediaSection(r,r.localCapabilities,"offer",t.localStreams[0])}),this._pendingOffer=o;var h=new RTCSessionDescription({type:"offer",sdp:s});return arguments.length&&"function"==typeof arguments[0]&&window.setTimeout(arguments[0],0,h),Promise.resolve(h)},window.RTCPeerConnection.prototype.createAnswer=function(){var t=this,e=n.writeSessionBoilerplate();this.usingBundle&&(e+="a=group:BUNDLE "+this.transceivers.map(function(t){return t.mid}).join(" ")+"\r\n"),this.transceivers.forEach(function(i){if(i.isDatachannel)return void(e+="m=application 0 DTLS/SCTP 5000\r\nc=IN IP4 0.0.0.0\r\na=mid:"+i.mid+"\r\n");var r=t._getCommonCapabilities(i.localCapabilities,i.remoteCapabilities);e+=n.writeMediaSection(i,r,"answer",t.localStreams[0])});var i=new RTCSessionDescription({type:"answer",sdp:e});return arguments.length&&"function"==typeof arguments[0]&&window.setTimeout(arguments[0],0,i),Promise.resolve(i)},window.RTCPeerConnection.prototype.addIceCandidate=function(t){if(t){var e=t.sdpMLineIndex;if(t.sdpMid)for(var i=0;i<this.transceivers.length;i++)if(this.transceivers[i].mid===t.sdpMid){e=i;break}var r=this.transceivers[e];if(r){var a=Object.keys(t.candidate).length>0?n.parseCandidate(t.candidate):{};if("tcp"===a.protocol&&(0===a.port||9===a.port))return;if("1"!==a.component)return;"endOfCandidates"===a.type&&(a={}),r.iceTransport.addRemoteCandidate(a);var s=n.splitSections(this.remoteDescription.sdp);s[e+1]+=(a.type?t.candidate.trim():"a=end-of-candidates")+"\r\n",this.remoteDescription.sdp=s.join("")}}else this.transceivers.forEach(function(t){t.iceTransport.addRemoteCandidate({})});return arguments.length>1&&"function"==typeof arguments[1]&&window.setTimeout(arguments[1],0),Promise.resolve()},window.RTCPeerConnection.prototype.getStats=function(){var t=[];this.transceivers.forEach(function(e){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(i){e[i]&&t.push(e[i].getStats())})});var e=arguments.length>1&&"function"==typeof arguments[1]&&arguments[1];return new Promise(function(i){var n=new Map;Promise.all(t).then(function(t){t.forEach(function(t){Object.keys(t).forEach(function(e){n.set(e,t[e]),n[e]=t[e]})}),e&&window.setTimeout(e,0,n),i(n)})})}}};e.exports={shimPeerConnection:a.shimPeerConnection,shimGetUserMedia:t("./getusermedia")}},{"../utils":10,"./getusermedia":6,sdp:1}],6:[function(t,e,i){e.exports=function(){var t=function(t){return{name:{PermissionDeniedError:"NotAllowedError"}[t.name]||t.name,message:t.message,constraint:t.constraint,toString:function(){return this.name}}},e=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(i){return e(i)["catch"](function(e){return Promise.reject(t(e))})}}},{}],7:[function(t,e,i){var n=t("../utils").browserDetails,r={shimOnTrack:function(){"object"!==("undefined"==typeof window?"undefined":c(window))||!window.RTCPeerConnection||"ontrack"in window.RTCPeerConnection.prototype||Object.defineProperty(window.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(t){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=t),this.addEventListener("addstream",this._ontrackpoly=function(t){t.stream.getTracks().forEach(function(e){var i=new Event("track");i.track=e,i.receiver={track:e},i.streams=[t.stream],this.dispatchEvent(i)}.bind(this))}.bind(this))}})},shimSourceObject:function(){"object"===("undefined"==typeof window?"undefined":c(window))&&(!window.HTMLMediaElement||"srcObject"in window.HTMLMediaElement.prototype||Object.defineProperty(window.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(t){this.mozSrcObject=t}}))},shimPeerConnection:function(){if("object"===("undefined"==typeof window?"undefined":c(window))&&(window.RTCPeerConnection||window.mozRTCPeerConnection)){window.RTCPeerConnection||(window.RTCPeerConnection=function(t,e){if(n.version<38&&t&&t.iceServers){for(var i=[],r=0;r<t.iceServers.length;r++){var a=t.iceServers[r];if(a.hasOwnProperty("urls"))for(var s=0;s<a.urls.length;s++){var o={url:a.urls[s]};0===a.urls[s].indexOf("turn")&&(o.username=a.username,o.credential=a.credential),i.push(o)}else i.push(t.iceServers[r])}t.iceServers=i}return new mozRTCPeerConnection(t,e)},window.RTCPeerConnection.prototype=mozRTCPeerConnection.prototype,mozRTCPeerConnection.generateCertificate&&Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:function(){return mozRTCPeerConnection.generateCertificate}}),window.RTCSessionDescription=mozRTCSessionDescription,window.RTCIceCandidate=mozRTCIceCandidate),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var e=RTCPeerConnection.prototype[t];RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?RTCIceCandidate:RTCSessionDescription)(arguments[0]),e.apply(this,arguments)}});var t=RTCPeerConnection.prototype.addIceCandidate;if(RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?t.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())},n.version<48){var e=function(t){var e=new Map;return Object.keys(t).forEach(function(i){e.set(i,t[i]),e[i]=t[i]}),e},i=RTCPeerConnection.prototype.getStats;RTCPeerConnection.prototype.getStats=function(t,n,r){return i.apply(this,[t||null]).then(function(t){return e(t)}).then(n,r)}}}}};e.exports={shimOnTrack:r.shimOnTrack,shimSourceObject:r.shimSourceObject,shimPeerConnection:r.shimPeerConnection,shimGetUserMedia:t("./getusermedia")}},{"../utils":10,"./getusermedia":8}],8:[function(t,e,i){var n=t("../utils").log,r=t("../utils").browserDetails;e.exports=function(){var t=function(t){return{name:{SecurityError:"NotAllowedError",PermissionDeniedError:"NotAllowedError"}[t.name]||t.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[t.message]||t.message,constraint:t.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}},e=function(e,i,a){var s=function(t){if("object"!==("undefined"==typeof t?"undefined":c(t))||t.require)return t;var e=[];return Object.keys(t).forEach(function(i){if("require"!==i&&"advanced"!==i&&"mediaSource"!==i){var n=t[i]="object"===c(t[i])?t[i]:{ideal:t[i]};if((void 0!==n.min||void 0!==n.max||void 0!==n.exact)&&e.push(i),void 0!==n.exact&&("number"==typeof n.exact?n.min=n.max=n.exact:t[i]=n.exact,delete n.exact),void 0!==n.ideal){t.advanced=t.advanced||[];var r={};"number"==typeof n.ideal?r[i]={min:n.ideal,max:n.ideal}:r[i]=n.ideal,t.advanced.push(r),delete n.ideal,Object.keys(n).length||delete t[i]}}}),e.length&&(t.require=e),t};return e=JSON.parse(JSON.stringify(e)),r.version<38&&(n("spec: "+JSON.stringify(e)),e.audio&&(e.audio=s(e.audio)),e.video&&(e.video=s(e.video)),n("ff37: "+JSON.stringify(e))),navigator.mozGetUserMedia(e,i,function(e){a(t(e))})},i=function(t){return new Promise(function(i,n){e(t,i,n)})};if(navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:i,addEventListener:function(){},removeEventListener:function(){}}),navigator.mediaDevices.enumerateDevices=navigator.mediaDevices.enumerateDevices||function(){return new Promise(function(t){var e=[{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}];t(e)})},r.version<41){var a=navigator.mediaDevices.enumerateDevices.bind(navigator.mediaDevices);navigator.mediaDevices.enumerateDevices=function(){return a().then(void 0,function(t){if("NotFoundError"===t.name)return[];throw t})}}if(r.version<49){var s=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(e){return s(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(t){t.stop()}),new DOMException("The object can not be found here.","NotFoundError");return t},function(e){return Promise.reject(t(e))})}}navigator.getUserMedia=function(t,i,n){return r.version<44?e(t,i,n):(console.warn("navigator.getUserMedia has been replaced by navigator.mediaDevices.getUserMedia"),void navigator.mediaDevices.getUserMedia(t).then(i,n))}}},{"../utils":10}],9:[function(t,e,i){var n={shimGetUserMedia:function(){navigator.getUserMedia=navigator.webkitGetUserMedia}};e.exports={shimGetUserMedia:n.shimGetUserMedia}},{}],10:[function(t,e,i){var n=!0,r={disableLog:function(t){return"boolean"!=typeof t?new Error("Argument type: "+("undefined"==typeof t?"undefined":c(t))+". Please use a boolean."):(n=t,t?"adapter.js logging disabled":"adapter.js logging enabled")},log:function(){if("object"===("undefined"==typeof window?"undefined":c(window))){if(n)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},extractVersion:function(t,e,i){var n=t.match(e);return n&&n.length>=i&&parseInt(n[i],10)},detectBrowser:function(){var t={};if(t.browser=null,t.version=null,"undefined"==typeof window||!window.navigator)return t.browser="Not a browser.",t;if(navigator.mozGetUserMedia)t.browser="firefox",t.version=this.extractVersion(navigator.userAgent,/Firefox\/([0-9]+)\./,1);else if(navigator.webkitGetUserMedia)if(window.webkitRTCPeerConnection)t.browser="chrome",t.version=this.extractVersion(navigator.userAgent,/Chrom(e|ium)\/([0-9]+)\./,2);else{if(!navigator.userAgent.match(/Version\/(\d+).(\d+)/))return t.browser="Unsupported webkit-based browser with GUM support but no WebRTC support.",t;t.browser="safari",t.version=this.extractVersion(navigator.userAgent,/AppleWebKit\/([0-9]+)\./,1)}else{if(!navigator.mediaDevices||!navigator.userAgent.match(/Edge\/(\d+).(\d+)$/))return t.browser="Not a supported browser.",t;t.browser="edge",t.version=this.extractVersion(navigator.userAgent,/Edge\/(\d+).(\d+)$/,2)}return t}};e.exports={log:r.log,disableLog:r.disableLog,browserDetails:r.detectBrowser(),extractVersion:r.extractVersion}},{}]},{},[2])(2)}),/*!
	  Script: easyrtc.js
	
	    Provides client side support for the EasyRTC framework.
	    See the easyrtc_client_api.md and easyrtc_client_tutorial.md
	    for more details.
	
	  About: License
	
	    Copyright (c) 2016, Priologic Software Inc.
	    All rights reserved.
	
	    Redistribution and use in source and binary forms, with or without
	    modification, are permitted provided that the following conditions are met:
	
	        * Redistributions of source code must retain the above copyright notice,
	          this list of conditions and the following disclaimer.
	        * Redistributions in binary form must reproduce the above copyright
	          notice, this list of conditions and the following disclaimer in the
	          documentation and/or other materials provided with the distribution.
	
	    THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
	    AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
	    IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
	    ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE
	    LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
	    CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
	    SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
	    INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
	    CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
	    ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
	    POSSIBILITY OF SUCH DAMAGE.
	*/
function(t,a){r=[h,o,i(92)],n=a,!(l="function"==typeof n?n.apply(e,r):n)}(void 0,function(t,e,i,n){var r=function(){function r(t,e){ot.debugPrinter&&ot.debugPrinter(t,e)}function a(t){if(null===t||t===n)return!0;var e;for(e in t)if(t.hasOwnProperty(e))return!1;return!0}function s(t){var e,i;for(i=t.getAudioTracks(),e=0;e<i.length;e++)try{i[e].stop()}catch(n){}for(i=t.getVideoTracks(),e=0;e<i.length;e++)try{i[e].stop()}catch(n){}if("function"==typeof t.stop)try{t.stop()}catch(n){}}function o(t){return t&&(t.socket&&t.socket.connected||t.connected)}function h(t,e){if("string"!=typeof t)throw ot.showError(ot.errCodes.DEVELOPER_ERR,e+" called without a string as the first argument"),"developer error";if(!mt[t])throw ot.showError(ot.errCodes.DEVELOPER_ERR,e+" called with a bad event name = "+t),"developer error"}function l(t,e){navigator.mediaDevices.enumerateDevices().then(function(i){for(var n=[],r=0;r<i.length;r++){var a=i[r];a.kind===e&&(a.id=a.deviceId,n.push(a))}t(n)})["catch"](function(t){r("Unable to enumerate devices ("+t+")")})}function u(t,e,i){Lt[t]?Lt[t].pc.getStats?Lt[t].pc.getStats(null,function(n){var r,a={},s={},o=null;if(n&&n.forEach(function(t){var e,i;if(t.type.match(/boundrtp/)){if(t.id.match(/audio/))e=t.type+"_audio";else{if(!t.id.match(/video/))return;e=t.type+"_video"}for(i in t)t.hasOwnProperty(i)&&(a[e+"."+i]=t[i])}else t.hasOwnProperty("ipAddress")&&t.id?s[t.id]=t.ipAddress+":"+t.portNumber:t.hasOwnProperty("selected")&&t.hasOwnProperty("remoteCandidateId")&&t.selected&&(o=t.remoteCandidateId)}),o&&(a.firefoxRemoteAddress=s[o]),i){var h={};for(r in i)i.hasOwnProperty(r)&&a.hasOwnProperty(r)&&(h[i[r]]=a[r]);e(t,h)}else e(t,a)},function(t){r("unable to get statistics")}):e(t,{statistics:ot.getConstantString("statsNotSupported")}):e(t,{connected:!1})}function d(t,e,i){Lt[t]?Lt[t].pc.getStats?Lt[t].pc.getStats(function(n){var r,a,s,o,h,l,c,u,d,f,_,p,m,g={},y=n.result(),v=[],x=0,w=null;if(i){for(a=0;a<y.length;a++){for(v[a]={},l=y[a].names(),s=0;s<l.length;s++)v[a][l[s]]=!0;v[a].googRemoteAddress&&v[a].googActiveConnection&&(f=y[a].stat("googActiveConnection"),(f===!0||"true"===f)&&(_=parseInt(y[a].stat("bytesReceived"))+parseInt(y[a].stat("bytesSent")),_>x&&(d=a,x=_)))}for(a=0;a<y.length;a++)v[a].googActiveConnection&&(a!==d?v[a]={}:(p=y[a].stat("googLocalAddress").split(":")[0],m=y[a].stat("googRemoteAddress").split(":")[0],ot.isTurnServer(p)?w=p:ot.isTurnServer(m)&&(w=m)));for(a=0;a<i.length;a++){for(o=i[a],u=[],r=null,s=0;s<y.length;s++){var b=!0;for(h in o)if(o.hasOwnProperty(h)&&!v[s][h]){b=!1;break}b&&y[s]&&u.push(y[s])}if(1===u.length){for(s=0;s<u.length;s++)if(r=u[s])for(h in o)o.hasOwnProperty(h)&&(c=o[h],g[c]=r.stat(h))}else if(u.length>1){for(h in o)o.hasOwnProperty(h)&&(g[o[h]]=[]);for(s=0;s<u.length;s++){r=u[s];for(h in o)o.hasOwnProperty(h)&&(c=o[h],g[c].push(r.stat(h)))}}}}else for(a=0;a<y.length;a++)for(l=y[a].names(),s=0;s<l.length;s++)h=l[s],g[y[a].id+"."+h]=y[a].stat(h);g.remoteAddress&&w&&(g.remoteAddress=w),e(t,g)}):e(t,{statistics:ot.getConstantString("statsNotSupported")}):e(t,{connected:!1})}function f(t,e){var i=JSON.stringify(e);JSON.parse(i);var n={msgType:"setRoomApiField",msgData:{setRoomApiField:{roomName:t,field:e}}};ot.webSocket.json.emit("easyrtcCmd",n,function(t){"error"===t.msgType&&ot.showError(t.msgData.errorCode,t.msgData.errorText)})}function _(t){Vt&&clearTimeout(Vt),Vt=setTimeout(function(){f(t,ot._roomApiFields[t]),Vt=null},10)}function p(t,e){var i;if(e)for(i=0;i<e.length;i++){var n=e[i];n.enabled=t}}function m(t){return t||(t="default"),yt.hasOwnProperty(t)?yt[t]:null}function g(){var t,e={};for(t in yt)yt.hasOwnProperty(t)&&(e[t]=yt[t].id||"default");return e}function y(t,e){var i;if(e||(e="default"),t.streamName=e,yt[e]=t,"default"!==e){var n=g(),r=ot.roomData;for(i in r)r.hasOwnProperty(i)&&ot.setRoomApiField(i,"mediaIds",n)}}function v(t,i){var r,a,s;if(i||(i="default"),Lt[t]&&(s=Lt[t].remoteStreamIdToName[i]))return s;for(r in ot.roomData)if(ot.roomData.hasOwnProperty(r)){if(a=ot.getRoomApiField(r,t,"mediaIds"),!a)continue;for(s in a)if(a.hasOwnProperty(s)&&a[s]===i)return s;if(e&&e.browserDetails&&"firefox"===e.browserDetails.browser){if(a["default"])return"default";for(var o in a)if(a.hasOwnProperty(o))return o}}return n}function x(t){t||(t="default");var e=ot.getLocalStream(t);if(e){var i,n,r=e.id||"default";if(yt[t]){for(i in Lt)if(Lt.hasOwnProperty(i)){try{Lt[i].pc.removeStream(e)}catch(a){}ot.sendPeerMessage(i,"__closingMediaStream",{streamId:r,streamName:t})}if(s(yt[t]),delete yt[t],"default"!==t){var o=g();for(n in ot.roomData)ot.roomData.hasOwnProperty(n)&&ot.setRoomApiField(n,"mediaIds",o)}}}}function w(t,e,i){var n=null,r=t.pc.getRemoteStreams();if(i||(i="default"),"default"===i)return r.length>0?r[0]:null;for(var a in ot.roomData)if(ot.roomData.hasOwnProperty(a)){var s=ot.getRoomApiField(a,e,"mediaIds");if(n=s?s[i]:null)break}n||ot.showError(ot.errCodes.DEVELOPER_ERR,"remote peer does not have media stream called "+i);for(var o=0;o<r.length;o++){var h;if(h=r[o].id?r[o].id:"default",!n||h===n||0===h.indexOf(n))return r[o]}return null}function b(t,e,i){var n,r;if(t){if(r=Lt[t],!r)return ot.showError(ot.errCodes.DEVELOPER_ERR,"haveTracks called about a peer you don't have a connection to"),!1;n=w(Lt[t],t,i)}else n=m(i);if(!n)return!1;var a;try{a=e?n.getAudioTracks():n.getVideoTracks()}catch(s){return!0}return a?a.length>0:!1}function C(){var t;if(ot.loggingOut=!0,Ct={},Nt={},ot.disconnecting=!0,Gt=ot.webSocket,ot.webSocketConnected&&(jt||ot.webSocket.close(),ot.webSocketConnected=!1),ot.hangupAll(),Mt)for(t in Dt)Dt.hasOwnProperty(t)&&Mt(t,{},!1);Dt={},ot.emitEvent("roomOccupant",{}),ot.roomData={},ot.roomJoin={},ot._roomApiFields={},ot.loggingOut=!1,ot.myEasyrtcid=null,ot.disconnecting=!1,bt={}}function S(t,e,i,n,a){if(!ot.webSocket)throw"Attempt to send message without a valid connection to the server.";var s={msgType:e};t&&(s.targetEasyrtcid=t),i&&(s.msgData=i),r("sending socket message "+JSON.stringify(s)),ot.webSocket.json.emit("easyrtcCmd",s,function(t){"error"!==t.msgType?(t.hasOwnProperty("msgData")||(t.msgData=null),n&&n(t.msgType,t.msgData)):a?a(t.msgData.errorCode,t.msgData.errorText):ot.showError(t.msgData.errorCode,t.msgData.errorText)})}function E(t,e){var i,n,r,a,s,o=t+"-"+Wt++,h=Math.ceil(e.length/ot.maxP2PMessageLength);for(r={transfer:"start",transferId:o,parts:h},s={transfer:"end",transferId:o},Lt[t].dataChannelS.send(JSON.stringify(r)),i=0,n=e.length;n>i;i+=ot.maxP2PMessageLength)a={transferId:o,data:e.substr(i,ot.maxP2PMessageLength),transfer:"chunk"},Lt[t].dataChannelS.send(JSON.stringify(a));Lt[t].dataChannelS.send(JSON.stringify(s))}function T(){var t=[];return t.push({DtlsSrtpKeyAgreement:"true"}),{optional:t}}function M(t,e,i){var n;for(n=0;n<Lt[t].candidatesToSend.length;n++)S(t,"candidate",Lt[t].candidatesToSend[n],e,i)}function R(t,e){if(Lt[t]){var i,n;n=e.id?e.id:"default",i=Lt[t].remoteStreamIdToName[n]||"default",Lt[t].liveRemoteStreams[i]&&ot.onStreamClosed&&(delete Lt[t].liveRemoteStreams[i],ot.onStreamClosed(t,e,i)),delete Lt[t].remoteStreamIdToName[n]}}function A(t,e){if(Lt[t]&&(R(t,e),Ot(),Lt[t].pc))try{Lt[t].pc.removeStream(e)}catch(i){}}function D(t,e){function i(t){var e;for(e in t)if(t.hasOwnProperty(e))return!0;return!1}var n={};return i(t)&&(n.added=t),i(e)&&(n.deleted=e),i(n)?n:null}function I(t,e){var i,n,r={},a={};for(i in e)e.hasOwnProperty(i)&&(null===t||"undefined"==typeof t[i]?r[i]=e[i]:"object"===c(e[i])?(n=I(t[i],e[i]),null!==n&&(r[i]=e[i])):e[i]!==t[i]&&(r[i]=e[i]));for(i in t)e.hasOwnProperty(i)&&"undefined"==typeof e[i]&&(a[i]=t[i]);return D(r,a)}function P(){var t,e={};for(t in Lt)Lt.hasOwnProperty(t)&&(e[t]={connectTime:Lt[t].connectTime,isInitiator:!!Lt[t].isInitiator});var i={userSettings:{sharingAudio:!!pt.audio,sharingVideo:!!pt.video,sharingData:!!Et,nativeVideoWidth:ot.nativeVideoWidth,nativeVideoHeight:ot.nativeVideoHeight,windowWidth:window.innerWidth,windowHeight:window.innerHeight,screenWidth:window.screen.width,screenHeight:window.screen.height,cookieEnabled:navigator.cookieEnabled,os:navigator.oscpu,language:navigator.language}};return a(e)||(i.p2pList=e),i}function O(){var t=P(!1),e=function(){var e=I(bt,t);e&&(r("cfg="+JSON.stringify(e.added)),ot.webSocket&&S(null,"setUserCfg",{setUserCfg:e.added},null,null)),bt=t};bt==={}?e():setTimeout(e,100)}function L(t){var e="";return e+=t>>24,e+=" | ",e+=t>>8&65535,e+=" | ",e+=255&t}function N(t){var e="candidate:",i=t.indexOf(e)+e.length,n=t.substr(i).split(" ");return{component:n[1],type:n[7],foundation:n[0],protocol:n[2],address:n[4],port:n[5],priority:L(n[3])}}function k(t){ot._candicates=ot._candicates||[],ot._candicates.push(N(t))}function B(t,e){if(Lt[t]&&!Lt[t].cancelled){var i=Lt[t];i.startedAV||(i.startedAV=!0,i.sharingAudio=pt.audio,i.sharingVideo=pt.video,i.connectTime=(new Date).getTime(),i.callSuccessCB&&(i.sharingAudio||i.sharingVideo)&&i.callSuccessCB(t,"audiovideo"),(ot.audioEnabled||ot.videoEnabled)&&O());var n=v(t,e.id||"default");n||(n="default"),i.remoteStreamIdToName[e.id||"default"]=n,i.liveRemoteStreams[n]=!0,e.streamName=n,ot.streamAcceptor&&(ot.streamAcceptor(t,e,n),ot.sendDataWS(t,"easyrtc_streamReceived",{streamName:n},function(){}))}}function V(t,e){if(Lt[t]&&!Lt[t].cancelled){var i=Lt[t];i.trackTimers=i.trackTimers||{};for(var n=0,r=e.length;r>n;n++){var a=e[n],s=a.id||"default";clearTimeout(i.trackTimers[s]),i.trackTimers[s]=setTimeout(function(e){B(i,t,e)}.bind(a),100)}}}function F(t,e,i,n){function a(e){if(r("saw dataChannel.onmessage event: ",e.data),"dataChannelPrimed"===e.data)ot.sendDataWS(t,"dataChannelPrimed","");else{var i;try{i=JSON.parse(e.data)}catch(n){r("Developer error, unable to parse event data")}if(i)if(i.transfer&&i.transferId)if("start"===i.transfer){r("start transfer #"+i.transferId);var a=parseInt(i.parts);g={chunks:[],parts:a,transferId:i.transferId}}else if("chunk"===i.transfer)r("got chunk for transfer #"+i.transferId),"string"==typeof i.data&&i.data.length<=ot.maxP2PMessageLength?g?i.transferId!==g.transferId?r("Developer error, invalid transfer id"):g.chunks.length+1>g.parts?r("Developer error, received too many chunks"):g.chunks.push(i.data):r("Developer error, unexpected chunk"):r("Developer error, invalid data");else if("end"===i.transfer){if(r("end of transfer #"+i.transferId),g)if(i.transferId!==g.transferId)r("Developer error, invalid transfer id");else if(g.chunks.length!==g.parts)r("Developer error, received wrong number of chunks");else{var s;try{s=JSON.parse(g.chunks.join(""))}catch(n){r("Developer error, unable to parse message")}s&&ot.receivePeerDistribute(t,s,null)}else r("Developer error, unexpected end of transfer");g={}}else r("Developer error, got an unknown transfer message"+i.transfer);else ot.receivePeerDistribute(t,i,null)}}function s(t){r("saw initOutgoingChannel call");var e=l.createDataChannel(wt,ot.getDatachannelConstraints());Lt[t].dataChannelS=e,Lt[t].dataChannelR=e,e.onmessage=a,e.onopen=function(i){r("saw dataChannel.onopen event"),Lt[t]&&e.send("dataChannelPrimed")},e.onclose=function(e){r("saw dataChannelS.onclose event"),Lt[t]&&(Lt[t].dataChannelReady=!1,delete Lt[t].dataChannelS),At&&At(t),Ot()}}function o(t){r("initializing incoming channel handler for "+t),Lt[t].pc.ondatachannel=function(e){r("saw incoming data channel");var i=e.channel;Lt[t].dataChannelR=i,Lt[t].dataChannelS=i,Lt[t].dataChannelReady=!0,i.onmessage=a,i.onclose=function(e){r("saw dataChannelR.onclose event"),Lt[t]&&(Lt[t].dataChannelReady=!1,delete Lt[t].dataChannelR),At&&At(t),Ot()},i.onopen=function(e){r("saw dataChannel.onopen event"),Lt[t]&&i.send("dataChannelPrimed")}}}var l,c,u,d=Ut?Ut:Ft;r("building peer connection to "+t);try{if(l=ot.createRTCPeerConnection(d,T()),!l)throw c="Unable to create PeerConnection object, check your ice configuration("+JSON.stringify(d)+")",r(c),Error(c);Et&&"undefined"==typeof l.createDataChannel&&(Et=!1),l.onnegotiationneeded=function(e){Lt[t]&&Lt[t].enableNegotiateListener&&l.createOffer(function(e){lt&&(e.sdp=lt(e.sdp)),l.setLocalDescription(e,function(){ot.sendPeerMessage(t,"__addedMediaStream",{sdp:e})},function(){})},function(t){r("unexpected error in creating offer")})},l.onsignalingstatechange=function(){var e=h.currentTarget||h.target||l,i=e.signalingState||"unknown";ft&&ft(t,e,i)},l.oniceconnectionstatechange=function(e){var n=e.currentTarget||e.target||l,r=n.iceConnectionState||"unknown";switch(dt&&dt(t,n,r),r){case"connected":ot.onPeerOpen&&ot.onPeerOpen(t),Lt[t]&&Lt[t].callSuccessCB&&Lt[t].callSuccessCB(t,"connection");break;case"failed":i&&i(ot.errCodes.NOVIABLEICE,"No usable STUN/TURN path"),delete Lt[t];break;case"disconnected":ot.onPeerFailing&&ot.onPeerFailing(t),Lt[t]&&(Lt[t].failing=Date.now());break;case"closed":ot.onPeerClosed&&ot.onPeerClosed(t);break;case"completed":Lt[t]&&(Lt[t].failing&&ot.onPeerRecovered&&ot.onPeerRecovered(t,Lt[t].failing,Date.now()),delete Lt[t].failing)}},l.onconnection=function(){r("onconnection called prematurely")},u={pc:l,candidatesToSend:[],startedAV:!1,connectionAccepted:!1,isInitiator:e,remoteStreamIdToName:{},streamsAddedAcks:{},liveRemoteStreams:{}},l.onicecandidate=function(e){if(!Lt[t]||!Lt[t].cancelled){var n;if(e.candidate&&Lt[t]){if(n={type:"candidate",label:e.candidate.sdpMLineIndex,id:e.candidate.sdpMid,candidate:e.candidate.candidate},ut&&(n=ut(n,!1),!n))return;k(e.candidate.candidate),Lt[t].connectionAccepted?S(t,"candidate",n,null,function(){i(ot.errCodes.PEER_GONE,"Candidate disappeared")}):Lt[t].candidatesToSend.push(n)}}},l.ontrack=function(e){r("empty ontrack method invoked, which is expected"),V(t,e.streams)},l.onaddstream=function(e){r("empty onaddstream method invoked, which is expected"),B(t,e.stream)},l.onremovestream=function(e){r("saw remove on remote media stream"),A(t,e.stream)},Lt[t]=u}catch(f){return r("buildPeerConnection error",f),i(ot.errCodes.SYSTEM_ERR,f.message),null}var _,p;if(n)for(_=0;_<n.length;_++)p=m(n[_]),p?l.addStream(p):r("Developer error, attempt to access unknown local media stream "+n[_]);else ht&&(ot.videoEnabled||ot.audioEnabled)&&(p=ot.getLocalStream(),l.addStream(p));var g={};if(Et){if(ot.setPeerListener(function(){Lt[t]?(Lt[t].dataChannelReady=!0,Lt[t].callSuccessCB&&Lt[t].callSuccessCB(t,"datachannel"),Rt&&Rt(t,!0),Ot()):r("failed to setup outgoing channel listener")},"dataChannelPrimed",t),e)try{s(t)}catch(y){r("failed to init outgoing channel"),i(ot.errCodes.SYSTEM_ERR,ot.formatError(y))}e||o(t)}return l.onconnection=function(){r("setup pc.onconnection ")},ot.setPeerListener(function(t,e,i,n){u.streamsAddedAcks[i.streamName]&&(u.streamsAddedAcks[i.streamName](t,i.streamName),delete u.streamsAddedAcks[i.streamName])},"easyrtc_streamReceived",t),l}function U(t,e,i){var n=F(t,!1,function(t){ot.showError(ot.errCodes.SYSTEM_ERR,t)},i),a=Lt[t];if(!n)return void r("buildPeerConnection failed. Call not answered");var s=function(e){if(!a.cancelled){var i=function(){function i(){r("sending success")}function a(e,i){r("sending error"),delete Lt[t],ot.showError(e,i)}r("sending answer"),S(t,"answer",e,i,a),Lt[t].connectionAccepted=!0,M(t,i,a),n.connectDataConnection&&(r("calling connectDataConnection(5002,5001)"),n.connectDataConnection(5002,5001))};lt&&(e.sdp=lt(e.sdp)),n.setLocalDescription(e,i,function(t){ot.showError(ot.errCodes.INTERNAL_ERR,"setLocalDescription: "+t)})}},o=new RTCSessionDescription(e);if(!o)throw"Could not create the RTCSessionDescription";r("sdp ||  "+JSON.stringify(o));var h=function(){a.cancelled||n.createAnswer(s,function(t){ot.showError(ot.errCodes.INTERNAL_ERR,"create-answer: "+t)},xt)};r("about to call setRemoteDescription in doAnswer");try{ct&&(o.sdp=ct(o.sdp)),n.setRemoteDescription(o,h,function(t){ot.showError(ot.errCodes.INTERNAL_ERR,"set-remote-description: "+t)})}catch(l){r("set remote description failed"),ot.showError(ot.errCodes.INTERNAL_ERR,"setRemoteDescription failed: "+l.message)}}function z(t,e,i){if(!i&&ht){var n=ot.getLocalStream();if(!n&&(ot.videoEnabled||ot.audioEnabled))return void ot.initMediaSource(function(){z(t,e)},function(t,e){ot.showError(ot.errCodes.MEDIA_ERR,ot.format(ot.getConstantString("localMediaError")))})}zt?ot.getFreshIceConfig(function(n){n?U(t,e,i):ot.showError(ot.errCodes.CALL_ERR,"Failed to get fresh ice config")}):U(t,e,i)}function H(t,e,i,n,a){Nt[t]=!0;var s,o=F(t,!0,i,a);if(!o)throw s="buildPeerConnection failed, call not completed",r(s),s;Lt[t].callSuccessCB=e,Lt[t].callFailureCB=i,Lt[t].wasAcceptedCB=n;var h=Lt[t],l=function(e){if(!h.cancelled){var n=function(){S(t,"offer",e,null,i)};lt&&(e.sdp=lt(e.sdp)),o.setLocalDescription(e,n,function(t){i(ot.errCodes.CALL_ERR,t)})}};setTimeout(function(){Lt[t]&&o.createOffer(l,function(t){i(ot.errCodes.CALL_ERR,JSON.stringify(t))},xt)},100)}function j(t){var e;return e=t.active===!0||t.ended===!1?!0:t.getTracks().reduce(function(t){return t.enabled})}function G(t){Yt[t]={candidates:[]}}function W(t){if(Nt[t]&&delete Nt[t],Ct[t]&&delete Ct[t],!Lt[t].cancelled&&Lt[t].pc)try{for(var e=Lt[t].pc.getRemoteStreams(),i=0;i<e.length;i++)j(e[i])&&(R(t,e[i]),s(e[i]));Lt[t].pc.close(),Lt[t].cancelled=!0,r("peer closed")}catch(n){r("peer "+t+" close failed:"+n)}finally{ot.onPeerClosed&&ot.onPeerClosed(t)}}function Y(t){r("Hanging up on "+t),G(t),Lt[t]&&(Lt[t].pc&&W(t),Lt[t]&&delete Lt[t],Ot(),ot.webSocket&&S(t,"hangup",null,function(){r("hangup succeeds")},function(t,e){r("hangup failed:"+e),ot.showError(t,e)}))}function X(t){r("Saw onRemote hangup event"),G(t),Lt[t]?(Lt[t].pc?W(t):ot.callCancelled&&ot.callCancelled(t,!0),Lt[t]&&delete Lt[t]):ot.callCancelled&&ot.callCancelled(t,!0)}function q(t){var e;for(e in Dt)if(Dt.hasOwnProperty(e)&&Dt[e][t])return!0;return!1}function $(t){var e;for(e in Lt)Lt.hasOwnProperty(e)&&"undefined"==typeof t[e]&&(q(e)||((Lt[e].pc||Lt[e].isInitiator)&&X(e),delete Ct[e],delete Nt[e],G(e)));for(e in Ct)Ct.hasOwnProperty(e)&&!q(e)&&(X(e),G(e),delete Ct[e],delete Nt[e]);for(e in Nt)Nt.hasOwnProperty(e)&&!q(e)&&(X(e),G(e),delete Nt[e])}function K(t,e,i){i||(i=100);var n=0;Xt[t]&&(clearTimeout(Xt[t].timer),n=Xt[t].counter),n>20?(delete Xt[t],e()):(Xt[t]={counter:n+1},Xt[t].timer=setTimeout(function(){delete Xt[t],e()},i))}function Z(t,e){var i,n=null,r={};for(i in e)e.hasOwnProperty(i)&&(i===ot.myEasyrtcid?n=e[i]:r[i]=e[i]);$(r),K("roomOccupants&"+t,function(){Mt&&Mt(t,r,n),ot.emitEvent("roomOccupants",{roomName:t,occupants:Dt})},100)}function J(t,e){var i={};e&&e(ot.ackMessage),t.targetEasyrtcid&&(i.targetEasyrtcid=t.targetEasyrtcid),t.targetRoom&&(i.targetRoom=t.targetRoom),t.targetGroup&&(i.targetGroup=t.targetGroup),t.senderEasyrtcid?ot.receivePeerDistribute(t.senderEasyrtcid,t,i):Pt?Pt(t.msgType,t.msgData,i):r("Unhandled server message "+JSON.stringify(t))}function Q(t){var e;0===t.indexOf("turn:")||0===t.indexOf("turns:")?(e=t.split(/[@:&]/g)[1],ot._turnServers[e]=!0):(0===t.indexOf("stun:")||0===t.indexOf("stuns:"))&&(e=t.split(/[@:&]/g)[1],ot._stunServers[e]=!0)}function tt(t){var e,i,n;for(Ft={iceServers:[]},ot._turnServers={},ot._stunServers={},t&&t.iceServers&&"undefined"!=typeof t.iceServers.length?Ft={iceServers:t.iceServers}:ot.showError(ot.errCodes.DEVELOPER_ERR,"iceConfig received from server didn't have an array called iceServers, ignoring it"),e=0;e<t.iceServers.length;e++)if(n=t.iceServers[e],n.urls&&n.urls.length)for(i=0;i<n.urls.length;i++)Q(n.urls[i]);else n.url&&Q(n.url)}function et(t){t&&(t.easyrtcsid&&(ot.easyrtcsid=t.easyrtcsid),t.field&&(vt=t.field))}function it(t){ot.roomData=t;var e,i,n,r,a,s;for(i in ot.roomData)if(ot.roomData.hasOwnProperty(i)){if("join"===t[i].roomStatus){ot.roomJoin[i]||(ot.roomJoin[i]=t[i]);var o=g();o!=={}&&ot.setRoomApiField(i,"mediaIds",o)}else if("leave"===t[i].roomStatus){ot.roomEntryListener&&ot.roomEntryListener(!1,i),delete ot.roomJoin[i],delete Dt[i];continue}if(t[i].clientList)Dt[i]=t[i].clientList;else if(t[i].clientListDelta){if(r=t[i].clientListDelta.updateClient)for(a in r)if(r.hasOwnProperty(a)){Dt[i]||(Dt[i]=[]),Dt[i][a]||(Dt[i][a]=r[a]);for(e in r[a])("apiField"===e||"presence"===e)&&(Dt[i][a][e]=r[a][e])}if(n=t[i].clientListDelta.removeClient,n&&Dt[i])for(s in n)n.hasOwnProperty(s)&&delete Dt[i][s]}ot.roomJoin[i]&&t[i].field&&(Ht.rooms[i]=t[i].field),"join"===t[i].roomStatus&&ot.roomEntryListener&&ot.roomEntryListener(!0,i),Z(i,Dt[i])}ot.emitEvent("roomOccupant",Dt)}function nt(t,e){function i(t){delete Nt[t],Yt[t]&&delete Yt[t],Lt[t]&&(Lt[t].wasAcceptedCB&&Lt[t].wasAcceptedCB(!1,t),delete Lt[t])}function a(t,e){if(delete Nt[t],Lt[t]){Lt[t].connectionAccepted=!0,Lt[t].wasAcceptedCB&&Lt[t].wasAcceptedCB(!0,t);var i=function(){},n=function(e,i){Lt[t]&&delete Lt[t],ot.showError(e,i)};M(t,i,n),o=Lt[t].pc;var a=new RTCSessionDescription(e);if(!a)throw"Could not create the RTCSessionDescription";r("about to call initiating setRemoteDescription");try{ct&&(a.sdp=ct(a.sdp)),o.setRemoteDescription(a,function(){o.connectDataConnection&&(r("calling connectDataConnection(5001,5002)"),o.connectDataConnection(5001,5002))},function(t){r("setRemoteDescription failed ",t)})}catch(s){r("setRemoteDescription failed ",s)}d(t)}}function s(t,e){Lt[t]&&Lt[t].pc?u(t,e):(Lt[t]||(Yt[t]={candidates:[]}),Yt[t].candidates.push(e))}var o,h=t.senderEasyrtcid,l=t.msgType,c=t.msgData;r("received message of type "+l),"undefined"==typeof Yt[h]&&G(h);var u=function(t,e){function i(){r("iceAddSuccess: "+JSON.stringify(a)),k(e.candidate)}function n(t){ot.showError(ot.errCodes.ICECANDIDATE_ERR,"bad ice candidate ("+t.name+"): "+JSON.stringify(a))}var a=null;(!ut||(e=ut(e,!0)))&&(a=new RTCIceCandidate({sdpMLineIndex:e.label,candidate:e.candidate}),o=Lt[t].pc,o.addIceCandidate(a,i,n))},d=function(t){var e;if(Yt[t]){for(e=0;e<Yt[t].candidates.length;e++)u(t,Yt[t].candidates[e]);delete Yt[t]}},f=function(t,e){var i=function(i,a){if(a)if("string"==typeof a)a=[a];else if(a.length===n)return void ot.showError(ot.errCodes.DEVELOPER_ERR,"accept callback passed invalid streamNames");if(r("offer accept="+i),delete Ct[t],i){if(!ot.supportsPeerConnections())return void ot.showError(ot.errCodes.CALL_ERR,ot.getConstantString("noWebrtcSupport"));z(t,e,a),d(t)}else S(t,"reject",null,null,null),G(t)};return Nt[t]&&t<ot.myEasyrtcid?(delete Nt[t],Yt[t]&&delete Yt[t],Lt[t]&&(Lt[t].wasAcceptedCB&&Lt[t].wasAcceptedCB(!0,t),delete Lt[t]),void i(!0)):(Ct[t]=e,void(ot.acceptCheck?ot.acceptCheck(t,i):i(!0)))};switch(l){case"sessionData":et(c.sessionData);break;case"roomData":it(c.roomData);break;case"iceConfig":tt(c.iceConfig);break;case"forwardToUrl":c.newWindow?window.open(c.forwardToUrl.url):window.location.href=c.forwardToUrl.url;break;case"offer":f(h,c);break;case"reject":i(h);break;case"answer":a(h,c);break;case"candidate":s(h,c);break;case"hangup":X(h),G(h);break;case"error":ot.showError(c.errorCode,c.errorText);break;default:return void ot.showError(ot.errCodes.DEVELOPER_ERR,"received unknown message type from server, msgType is "+l)}e&&e(ot.ackMessage)}function rt(t){var e=t.msgData;r("entered process token"),e.easyrtcid&&(ot.myEasyrtcid=e.easyrtcid),e.field&&(Ht.connection=e.field),e.iceConfig&&tt(e.iceConfig),e.sessionData&&et(e.sessionData),e.roomData&&it(e.roomData),e.application.field&&(Ht.application=e.application.field)}function at(t,e){var i,n,r,s=null;if(ot.cookieId&&document.cookie)for(i=document.cookie.split(/[; ]/g),n=ot.cookieId+"=",r=0;r<i.length;r++)0===i[r].indexOf(n)&&(s=i[r].substring(n.length));var o={apiVersion:ot.apiVersion,applicationName:ot.applicationName,setUserCfg:P(!0)};ot.roomJoin||(ot.roomJoin={}),ot.presenceShow&&(o.setPresence={show:ot.presenceShow,status:ot.presenceStatus}),ot.username&&(o.username=ot.username),ot.roomJoin&&!a(ot.roomJoin)&&(o.roomJoin=ot.roomJoin),s&&(o.easyrtcsid=s),St&&(o.credential=St),ot.webSocket.json.emit("easyrtcAuth",{msgType:"authenticate",msgData:o},function(i){var n;if("error"===i.msgType)e(i.msgData.errorCode,i.msgData.errorText),ot.roomJoin={};else{if(rt(i),ot._roomApiFields)for(n in ot._roomApiFields)ot._roomApiFields.hasOwnProperty(n)&&_(n);t&&t(ot.myEasyrtcid)}})}function st(t,e){function n(t,e){ot.webSocket.on(t,e),ot.websocketListeners.push({event:t,handler:e})}function a(i){ot.webSocketConnected=!0,ot.webSocket||ot.showError(ot.errCodes.CONNECT_ERR,ot.getConstantString("badsocket")),r("saw socket-server onconnect event"),ot.webSocketConnected?at(t,e):e(ot.errCodes.SIGNAL_ERR,ot.getConstantString("icf"))}var s;if(jt)ot.webSocket=jt;else if(ot.webSocket)for(s in ot.websocketListeners)ot.websocketListeners.hasOwnProperty(s)&&ot.webSocket.removeEventListener(ot.websocketListeners[s].event,ot.websocketListeners[s].handler);else try{if(ot.webSocket=i.connect(Tt,_t),!ot.webSocket)throw"io.connect failed"}catch(h){return ot.webSocket=0,void e(ot.errCodes.SYSTEM_ERROR,h.toString())}ot.websocketListeners=[],n("close",function(t){r("the web socket closed")}),n("error",function(t){function i(){ot.myEasyrtcid&&o(ot.webSocket)?ot.showError(ot.errCodes.SIGNAL_ERR,ot.getConstantString("miscSignalError")):e(ot.errCodes.CONNECT_ERR,ot.getConstantString("noServer"))}i()}),o(jt)?a(null):n("connect",a),n("easyrtcMsg",J),n("easyrtcCmd",nt),n("disconnect",function(){ot.webSocketConnected=!1,Ot=function(){},bt={},C(),ot.disconnectListener&&ot.disconnectListener()})}var ot=this,ht=!0,lt=null,ct=null,ut=null,dt=null,ft=null,_t={"connect timeout":1e4,"force new connection":!0};this.setSdpFilters=function(t,e){lt=t,ct=e},this.setPeerClosedListener=function(t){this.onPeerClosed=t},this.setPeerOpenListener=function(t){this.onPeerOpen=t},this.setPeerFailingListener=function(t,e){this.onPeerFailing=t,this.onPeerRecovered=e},this.setIceCandidateFilter=function(t){ut=t},this.setIceConnectionStateChangeListener=function(t){dt=t},this.setSignalingStateChangeListener=function(t){ft=t},this.setAutoInitUserMedia=function(t){ht=!!t},this.format=function(t,e,i,n){for(var r=arguments[0],a=1;a<arguments.length;a++){var s=new RegExp("\\{"+(a-1)+"\\}","gi");r=r.replace(s,arguments[a])}return r};var pt={audio:!1,video:!1};this.getConstantString=function(e){return t[e]?t[e]:(ot.showError(ot.errCodes.DEVELOPER_ERR,"Could not find key='"+e+"' in easyrtc_lang"),e)};var mt={roomOccupant:!0,roomOccupants:!0},gt={};this.addEventListener=function(t,e){if(h(t,"addEventListener"),"function"!=typeof e)throw ot.showError(ot.errCodes.DEVELOPER_ERR,"addEventListener called with a non-function for second argument"),"developer error";ot.removeEventListener(t,e),gt[t]||(gt[t]=[]),gt[t][gt[t].length]=e},this.removeEventListener=function(t,e){h(t,"removeEventListener");var i=gt[t],n=0;if(i)for(n=0;n<i.length;n++)i[n]===e&&(n<i.length-1&&(i[n]=i[i.length-1]),i.length=i.length-1)},this.emitEvent=function(t,e){h(t,"emitEvent");var i=gt[t],n=0;if(i)for(n=0;n<i.length;n++)i[n](t,e)},this.errCodes={BAD_NAME:"BAD_NAME",CALL_ERR:"CALL_ERR",DEVELOPER_ERR:"DEVELOPER_ERR",SYSTEM_ERR:"SYSTEM_ERR",CONNECT_ERR:"CONNECT_ERR",MEDIA_ERR:"MEDIA_ERR",MEDIA_WARNING:"MEDIA_WARNING",INTERNAL_ERR:"INTERNAL_ERR",PEER_GONE:"PEER_GONE",ALREADY_CONNECTED:"ALREADY_CONNECTED",BAD_CREDENTIAL:"BAD_CREDENTIAL",ICECANDIDATE_ERR:"ICECANDIDATE_ERR",NOVIABLEICE:"NOVIABLEICE",SIGNAL_ERR:"SIGNAL_ERR"},this.apiVersion="1.1.0",this.ackMessage={msgType:"ack"},this.usernameRegExp=/^(.){1,64}$/,this.cookieId="easyrtcsid";this.loggingOut=!1,this.disconnecting=!1;var yt={},vt=[],xt={};this.enableAudioReceive=function(t){e&&e.browserDetails&&("firefox"===e.browserDetails.browser||"edge"===e.browserDetails.browser)?xt.offerToReceiveAudio=t:(xt.mandatory=xt.mandatory||{},xt.mandatory.OfferToReceiveAudio=t)},this.enableVideoReceive=function(t){e&&e.browserDetails&&("firefox"===e.browserDetails.browser||"edge"===e.browserDetails.browser)?xt.offerToReceiveVideo=t:(xt.mandatory=xt.mandatory||{},xt.mandatory.OfferToReceiveVideo=t)},this.enableAudioReceive(!0),this.enableVideoReceive(!0),this.setAudioOutput=function(t,e){"undefined"!=typeof t.sinkId?t.setSinkId(e).then(function(){r("Success, audio output device attached: "+e+" to element with "+t.title+" as source.")})["catch"](function(t){var e=t;"SecurityError"===t.name&&(e="You need to use HTTPS for selecting audio output device: "+t),r(e)}):r("Browser does not support output device selection.")},this.getAudioSinkList=function(t){l(t,"audiooutput")},this.getAudioSourceList=function(t){l(t,"audioinput")},this.getVideoSourceList=function(t){l(t,"videoinput")};var wt="dc",bt={},Ct={},St=null;ot.audioEnabled=!0,ot.videoEnabled=!0,this.debugPrinter=null,this.myEasyrtcid="",this.nativeVideoHeight=0,this.maxP2PMessageLength=1e3,this.nativeVideoWidth=0,this.roomJoin={},this.isNameValid=function(t){return ot.usernameRegExp.test(t)},this.setCookieId=function(t){ot.cookieId=t},this._desiredVideoProperties={},this.setVideoSource=function(t){ot._desiredVideoProperties.videoSrcId=t,delete ot._desiredVideoProperties.screenCapture},this._desiredAudioProperties={},this.setAudioSource=function(t){ot._desiredAudioProperties.audioSrcId=t},this.setVideoDims=function(t,e,i){ot._desiredVideoProperties.width=t,ot._desiredVideoProperties.height=e,i!==n&&(ot._desiredVideoProperties.frameRate=i)},this.setScreenCapture=function(t){ot._desiredVideoProperties.screenCapture=t!==!1},ot.getUserMediaConstraints=function(){var t={};return ot._presetMediaConstraints?(t=ot._presetMediaConstraints,delete ot._presetMediaConstraints,t):ot._desiredVideoProperties.screenCapture?{video:{mandatory:{chromeMediaSource:"screen",maxWidth:screen.width,maxHeight:screen.height,minWidth:screen.width,minHeight:screen.height,minFrameRate:1,maxFrameRate:5},optional:[]},audio:!1}:(ot.videoEnabled?e&&e.browserDetails&&("firefox"===e.browserDetails.browser||"edge"===e.browserDetails.browser)?(t.video={},ot._desiredVideoProperties.width&&(t.video.width=ot._desiredVideoProperties.width),ot._desiredVideoProperties.height&&(t.video.height=ot._desiredVideoProperties.height),ot._desiredVideoProperties.frameRate&&(t.video.frameRate={minFrameRate:ot._desiredVideoProperties.frameRate,maxFrameRate:ot._desiredVideoProperties.frameRate}),ot._desiredVideoProperties.videoSrcId&&(t.video.deviceId=ot._desiredVideoProperties.videoSrcId)):(t.video={},ot._desiredVideoProperties.width&&(t.video.width={max:ot._desiredVideoProperties.width,min:ot._desiredVideoProperties.width,ideal:ot._desiredVideoProperties.width}),ot._desiredVideoProperties.height&&(t.video.height={max:ot._desiredVideoProperties.height,min:ot._desiredVideoProperties.height,ideal:ot._desiredVideoProperties.height}),ot._desiredVideoProperties.frameRate&&(t.video.frameRate={max:ot._desiredVideoProperties.frameRate,ideal:ot._desiredVideoProperties.frameRate}),ot._desiredVideoProperties.videoSrcId&&(t.video.deviceId=ot._desiredVideoProperties.videoSrcId),0===Object.keys(t.video).length&&(t.video=!0)):t.video=!1,ot.audioEnabled?e&&e.browserDetails&&"firefox"===e.browserDetails.browser?(t.audio={},ot._desiredAudioProperties.audioSrcId&&(t.audio.deviceId=ot._desiredAudioProperties.audioSrcId)):(t.audio={mandatory:{},optional:[]},ot._desiredAudioProperties.audioSrcId&&(t.audio.optional=t.audio.optional||[],t.audio.optional.push({deviceId:ot._desiredAudioProperties.audioSrcId}))):t.audio=!1,t)},this.setApplicationName=function(t){ot.applicationName=t},this.enableDebug=function(t){t?ot.debugPrinter=function(t,e){var i=(new Date).toISOString(),n=(new Error).stack,r="location unknown";if(n){var a=n.split("\n");r="",a.length>=5&&(r=a[4])}console.log("debug "+i+" : "+t+" ["+r+"]"),"undefined"!=typeof e&&console.log("debug "+i+" : ",e)}:ot.debugPrinter=null},this.supportsGetUserMedia=function(){return"undefined"!=typeof navigator.getUserMedia},this.supportsPeerConnections=function(){return"undefined"!=typeof RTCPeerConnection},this.supportsDataChannels=function(){var t=!1;if(ot.supportsPeerConnections())try{var e=new RTCPeerConnection({iceServers:[]},{});t="undefined"!=typeof e.createDataChannel,e.close()}catch(i){}return t},this.supportsStatistics=function(){var t=!1;if(ot.supportsPeerConnections())try{var e=new RTCPeerConnection({iceServers:[]},{});t="undefined"!=typeof e.getStats,e.close()}catch(i){}
return t},this.createRTCPeerConnection=function(t,e){if(ot.supportsPeerConnections())return new RTCPeerConnection(t,e);throw"Your browser doesn't support webRTC (RTCPeerConnection)"},this.getDatachannelConstraints=function(){return{reliable:e&&e.browserDetails&&"chrome"!==e.browserDetails.browser&&e.browserDetails.version<31}},pt={audio:!1,video:!1};var Et=!1,Tt=null,Mt=null,Rt=null,At=null,Dt={},It={msgTypes:{}},Pt=null,Ot=function(){},Lt={},Nt={};this.acceptCheck=function(t,e){e(!0)},this.streamAcceptor=function(t,e){},this.onStreamClosed=function(t){},this.callCancelled=function(t){},this.getPeerConnectionByUserId=function(t){return Lt&&Lt[t]?Lt[t].pc:null};var kt=[{googTransmitBitrate:"transmitBitRate",googActualEncBitrate:"encodeRate",googAvailableSendBandwidth:"availableSendRate"},{googCodecName:"audioCodec",googTypingNoiseState:"typingNoise",packetsSent:"audioPacketsSent",bytesSent:"audioBytesSent"},{googCodecName:"videoCodec",googFrameRateSent:"outFrameRate",packetsSent:"videoPacketsSent",bytesSent:"videoBytesSent"},{packetsLost:"videoPacketsLost",packetsReceived:"videoPacketsReceived",bytesReceived:"videoBytesReceived",googFrameRateOutput:"frameRateOut"},{packetsLost:"audioPacketsLost",packetsReceived:"audioPacketsReceived",bytesReceived:"audioBytesReceived",audioOutputLevel:"audioOutputLevel"},{googRemoteAddress:"remoteAddress",googActiveConnection:"activeConnection"},{audioInputLevel:"audioInputLevel"}],Bt={"outboundrtp_audio.bytesSent":"audioBytesSent","outboundrtp_video.bytesSent":"videoBytesSent","inboundrtp_video.bytesReceived":"videoBytesReceived","inboundrtp_audio.bytesReceived":"audioBytesReceived","outboundrtp_audio.packetsSent":"audioPacketsSent","outboundrtp_video.packetsSent":"videoPacketsSent","inboundrtp_video.packetsReceived":"videoPacketsReceived","inboundrtp_audio.packetsReceived":"audioPacketsReceived","inboundrtp_video.packetsLost":"videoPacketsLost","inboundrtp_audio.packetsLost":"audioPacketsLost",firefoxRemoteAddress:"remoteAddress"};e&&e.browserDetails&&"firefox"===e.browserDetails.browser?Bt:kt;this.getPeerStatistics=function(t,i,n){e&&e.browserDetails&&"firefox"===e.browserDetails.browser?u(t,i,n):d(t,i,n)};var Vt=null;this.setRoomApiField=function(t,e,i){if(ot._roomApiFields||(ot._roomApiFields={}),!e&&!i)return void delete ot._roomApiFields[t];if(ot._roomApiFields[t]||(ot._roomApiFields[t]={}),i!==n&&null!==i){if("object"===("undefined"==typeof i?"undefined":c(i)))try{JSON.stringify(i)}catch(r){return void ot.showError(ot.errCodes.DEVELOPER_ERR,"easyrtc.setRoomApiField passed bad object ")}ot._roomApiFields[t][e]={fieldName:e,fieldValue:i}}else delete ot._roomApiFields[t][e];ot.webSocketConnected&&_(t)},this.showError=function(t,e){ot.onError({errorCode:t,errorText:e})},this.onError=function(t){r("saw error "+t.errorText);var e,i=document.getElementById("easyrtcErrorDialog");if(!i){i=document.createElement("div"),i.id="easyrtcErrorDialog";var n=document.createElement("div");n.innerHTML="Error messages",n.className="easyrtcErrorDialog_title",i.appendChild(n),e=document.createElement("div"),e.id="easyrtcErrorDialog_body",i.appendChild(e);var a=document.createElement("button");a.appendChild(document.createTextNode("Okay")),a.className="easyrtcErrorDialog_okayButton",a.onclick=function(){e.innerHTML="",i.style.display="none"},i.appendChild(a),document.body.appendChild(i)}e=document.getElementById("easyrtcErrorDialog_body");var s=document.createElement("div");s.className="easyrtcErrorDialog_element",s.appendChild(document.createTextNode(t.errorText)),e.appendChild(s),i.style.display="block"},this.createObjectURL=function(t){var e;if(window.URL&&window.URL.createObjectURL)return window.URL.createObjectURL(t);if(window.webkitURL&&window.webkitURL.createObjectURL)return window.webkit.createObjectURL(t);throw e="Your browsers does not support URL.createObjectURL.",r("saw exception "+e),e},this.cleanId=function(t){var e={"&":"&amp;","<":"&lt;",">":"&gt;"};return t.replace(/[&<>]/g,function(t){return e[t]})},ot.setRoomEntryListener=function(t){ot.roomEntryListener=t},ot.setRoomOccupantListener=function(t){Mt=t},this.setDataChannelOpenListener=function(t){Rt=t},this.setDataChannelCloseListener=function(t){At=t},this.getConnectionCount=function(){var t,e=0;for(t in Lt)Lt.hasOwnProperty(t)&&ot.getConnectStatus(t)===ot.IS_CONNECTED&&e++;return e},this.setMaxP2PMessageLength=function(t){this.maxP2PMessageLength=t},this.enableAudio=function(t){ot.audioEnabled=t},this.enableVideo=function(t){ot.videoEnabled=t},this.enableDataChannels=function(t){Et=t},this.getLocalMediaIds=function(){return Object.keys(yt)},this.register3rdPartyLocalMediaStream=function(t,e){return y(t,e)},this.getNameOfRemoteStream=function(t,e){return"string"==typeof e?v(t,e):e.id?v(t,e.id):void 0},this.closeLocalMediaStream=function(t){return x(t)},this.closeLocalStream=this.closeLocalMediaStream,this.enableCamera=function(t,e){var i=m(e);i&&i.getVideoTracks&&p(t,i.getVideoTracks())},this.enableMicrophone=function(t,e){var i=m(e);i&&i.getAudioTracks&&p(t,i.getAudioTracks())},this.muteVideoObject=function(t,e){var i;if("string"==typeof t){if(i=document.getElementById(t),!i)throw"Unknown video object "+t}else{if(!t)throw"muteVideoObject passed a null";i=t}i.muted=!!e},ot.getLocalStreamAsUrl=function(t){var e=m(t);if(null===e)throw"Developer error: attempt to get a MediaStream without invoking easyrtc.initMediaSource successfully";return ot.createObjectURL(e)},this.getLocalStream=function(t){return m(t)||null},this.clearMediaStream=function(t){"undefined"!=typeof t.src?t.src="":"undefined"!=typeof t.srcObject?t.srcObject="":"undefined"!=typeof t.mozSrcObject&&(t.mozSrcObject=null)},this.setVideoObjectSrc=function(t,e){e&&""!==e?(t.autoplay=!0,"undefined"!=typeof t.src?t.src=ot.createObjectURL(e):"undefined"!=typeof t.srcObject?t.srcObject=e:"undefined"!=typeof t.mozSrcObject&&(t.mozSrcObject=ot.createObjectURL(e)),t.play()):ot.clearMediaStream(t)},this.buildLocalMediaStream=function(t,e,i){var n;if("string"!=typeof t)return ot.showError(ot.errCodes.DEVELOPER_ERR,"easyrtc.buildLocalMediaStream not supplied a stream name"),null;var r=null;for(var a in yt)if(yt.hasOwnProperty(a)&&(r=yt[a]))break;if(!r)for(a in Lt)if(Lt.hasOwnProperty(a)){var s=Lt[a].pc.getRemoteStreams();s&&s.length>0&&(r=s[0])}if(!r)return ot.showError(ot.errCodes.DEVELOPER_ERR,"Attempt to create a mediastream without one to clone from"),null;var o=r.clone(),h=o.getTracks();if(e)for(n=0;n<e.length;n++)o.addTrack(e[n].clone());if(i)for(n=0;n<i.length;n++)o.addTrack(i[n].clone());for(n=0;n<h.length;n++)o.removeTrack(h[n]);return y(o,t),o},this.loadStylesheet=function(){var t,e,i=document.getElementsByTagName("link");for(t in i)if(i.hasOwnProperty(t)&&(e=i[t],e.href&&e.href.match(/\/easyrtc.css/)))return;var n=document.createElement("link");n.setAttribute("rel","stylesheet"),n.setAttribute("type","text/css"),n.setAttribute("href","/easyrtc/easyrtc.css");var r=document.getElementsByTagName("head")[0],a=r.childNodes[0];r.insertBefore(n,a)},this.formatError=function(t){var e,i;if(null===t||"undefined"==typeof t)return"null";if("string"==typeof t)return t;if(t.type&&t.description)return t.type+" : "+t.description;if("object"!==("undefined"==typeof t?"undefined":c(t)))return"Strange case";try{return JSON.stringify(t)}catch(n){i="{";for(e in t)t.hasOwnProperty(e)&&"string"==typeof t[e]&&(i=i+e+"='"+t[e]+"' ");return i+="}"}},this.initMediaSource=function(t,e,i){function n(){return(new Date).getTime()}function a(t){var e=n();if(l+1e3>e){r("Trying getUserMedia a second time");try{navigator.getUserMedia(s,o,h)}catch(i){h(t)}}else h(t)}if(r("about to request local media"),i||(i="default"),pt={audio:ot.audioEnabled,video:ot.videoEnabled},e||(e=function(t,e){var i="easyrtc.initMediaSource: "+ot.formatError(e);r(i),ot.showError(ot.errCodes.MEDIA_ERR,i)}),!ot.supportsGetUserMedia())return void e(ot.errCodes.MEDIA_ERR,ot.getConstantString("noWebrtcSupport"));if(!t)return void ot.showError(ot.errCodes.DEVELOPER_ERR,"easyrtc.initMediaSource not supplied a successCallback");var s=ot.getUserMediaConstraints(),o=function(e){r("getUserMedia success callback entered"),r("successfully got local media"),e.streamName=i,y(e,i);var n,a,s,o;pt.video?(n=document.createElement("video"),n.muted=!0,a=30,s=function(){n.videoWidth>0||0>a?(ot.nativeVideoWidth=n.videoWidth,ot.nativeVideoHeight=n.videoHeight,!ot._desiredVideoProperties.height||ot.nativeVideoHeight===ot._desiredVideoProperties.height&&ot.nativeVideoWidth===ot._desiredVideoProperties.width||ot.showError(ot.errCodes.MEDIA_WARNING,ot.format(ot.getConstantString("resolutionWarning"),ot._desiredVideoProperties.width,ot._desiredVideoProperties.height,ot.nativeVideoWidth,ot.nativeVideoHeight)),ot.setVideoObjectSrc(n,null),n.removeNode?n.removeNode(!0):(o=document.createElement("div"),o.appendChild(n),o.removeChild(n)),Ot(),t&&t(e)):(a-=1,setTimeout(s,300))},ot.setVideoObjectSrc(n,e),s()):(Ot(),t&&t(e))},h=function(t){r("getusermedia failed"),r("failed to get local media");var n;n="string"==typeof t?t:t.name?t.name:"Unknown",e&&(r("invoking error callback",n),e(ot.errCodes.MEDIA_ERR,ot.format(ot.getConstantString("gumFailed"),n))),x(i),pt={audio:!1,video:!1},Ot()};if(!ot.audioEnabled&&!ot.videoEnabled)return void h(ot.getConstantString("requireAudioOrVideo"));var l;try{l=n(),navigator.getUserMedia(s,o,a)}catch(c){a(c)}},this.setAcceptChecker=function(t){ot.acceptCheck=t},this.setStreamAcceptor=function(t){ot.streamAcceptor=t},ot.setOnError=function(t){ot.onError=t},this.setCallCancelled=function(t){ot.callCancelled=t},this.setOnStreamClosed=function(t){ot.onStreamClosed=t},this.setPeerListener=function(t,e,i){e?(It.msgTypes[e]||(It.msgTypes[e]={sources:{}}),i?It.msgTypes[e].sources[i]={cb:t}:It.msgTypes[e].cb=t):It.cb=t},this.receivePeerDistribute=function(t,e,i){var n=e.msgType,a=e.msgData;if(!n)return void r("received peer message without msgType",e);if(It.msgTypes[n]){if(It.msgTypes[n].sources[t]&&It.msgTypes[n].sources[t].cb)return void It.msgTypes[n].sources[t].cb(t,n,a,i);if(It.msgTypes[n].cb)return void It.msgTypes[n].cb(t,n,a,i)}It.cb&&It.cb(t,n,a,i)},this.setServerListener=function(t){Pt=t},this.setSocketUrl=function(t,e){r("WebRTC signaling server URL set to "+t),Tt=t,e&&(_t=e)},this.setUsername=function(t){return ot.myEasyrtcid?(ot.showError(ot.errCodes.DEVELOPER_ERR,"easyrtc.setUsername called after authentication"),!1):ot.isNameValid(t)?(ot.username=t,!0):(ot.showError(ot.errCodes.BAD_NAME,ot.format(ot.getConstantString("badUserName"),t)),!1)},this.usernameToIds=function(t,e){var i,n,r=[];for(n in Dt)if(Dt.hasOwnProperty(n)&&(!e||n===e))for(i in Dt[n])Dt[n].hasOwnProperty(i)&&Dt[n][i].username===t&&r.push({easyrtcid:i,roomName:n});return r},this.getRoomApiField=function(t,e,i){return Dt[t]&&Dt[t][e]&&Dt[t][e].apiField&&Dt[t][e].apiField[i]?Dt[t][e].apiField[i].fieldValue:n},this.setCredential=function(t){try{return JSON.stringify(t),St=t,!0}catch(e){throw ot.showError(ot.errCodes.BAD_CREDENTIAL,"easyrtc.setCredential passed a non-JSON-able object"),"easyrtc.setCredential passed a non-JSON-able object"}},this.setDisconnectListener=function(t){ot.disconnectListener=t},this.idToName=function(t){var e;for(e in Dt)if(Dt.hasOwnProperty(e)&&Dt[e][t]&&Dt[e][t].username)return Dt[e][t].username;return t},this.webSocket=null;var Ft={},Ut=null,zt=!1;this.setUseFreshIceEachPeerConnection=function(t){zt=t},this.getServerIce=function(){return Ft},this.setIceUsedInCalls=function(t){t.iceServers?Ut=t:ot.showError(ot.errCodes.DEVELOPER_ERR,"Bad ice configuration passed to easyrtc.setIceUsedInCalls")},this.haveAudioTrack=function(t,e){return b(t,!0,e)},this.haveVideoTrack=function(t,e){return b(t,!1,e)},this.getRoomField=function(t,e){var i=ot.getRoomFields(t);return i&&i[e]?i[e].fieldValue:n};var Ht=null,jt=null,Gt=null;this.disconnect=function(){r("attempt to disconnect from WebRTC signalling server"),ot.disconnecting=!0,ot.hangupAll(),ot.loggingOut=!0,setTimeout(function(){if(ot.webSocket){try{ot.webSocket.disconnect()}catch(t){}Gt=ot.webSocket,ot.webSocket=0}ot.loggingOut=!1,ot.disconnecting=!1,Mt&&Mt(null,{},!1),ot.emitEvent("roomOccupant",{}),bt={}},250)};var Wt=0;this.sendDataP2P=function(t,e,i){var n=JSON.stringify({msgType:e,msgData:i});if(r("sending p2p message to "+t+" with data="+JSON.stringify(n)),Lt[t])if(Lt[t].dataChannelS)if(Lt[t].dataChannelReady)try{n.length>ot.maxP2PMessageLength?E(t,n):Lt[t].dataChannelS.send(n)}catch(a){throw r("sendDataP2P error: ",a),a}else ot.showError(ot.errCodes.DEVELOPER_ERR,"Attempt to use data channel to "+t+" before it's ready to send.");else ot.showError(ot.errCodes.DEVELOPER_ERR,"Attempt to send data peer to peer without establishing a data channel to "+t+" first.");else ot.showError(ot.errCodes.DEVELOPER_ERR,"Attempt to send data peer to peer without a connection to "+t+" first.")},this.sendDataWS=function(t,e,i,n){r("sending client message via websockets to "+t+" with data="+JSON.stringify(i)),n||(n=function(t){"error"===t.msgType&&ot.showError(t.msgData.errorCode,t.msgData.errorText)});var a={msgType:e,msgData:i};if(t&&("string"==typeof t?a.targetEasyrtcid=t:"object"===("undefined"==typeof t?"undefined":c(t))&&(t.targetEasyrtcid&&(a.targetEasyrtcid=t.targetEasyrtcid),t.targetRoom&&(a.targetRoom=t.targetRoom),t.targetGroup&&(a.targetGroup=t.targetGroup))),!ot.webSocket)throw r("websocket failed because no connection to server"),"Attempt to send message without a valid connection to the server.";ot.webSocket.json.emit("easyrtcMsg",a,n)},this.sendData=function(t,e,i,n){Lt[t]&&Lt[t].dataChannelReady?ot.sendDataP2P(t,e,i):ot.sendDataWS(t,e,i,n)},this.sendPeerMessage=function(t,e,i,n,a){function s(t){"error"===t.msgType?a&&a(t.msgData.errorCode,t.msgData.errorText):n&&n(t.msgType,t.msgData?t.msgData:null)}t||ot.showError(ot.errCodes.DEVELOPER_ERR,"destination was null in sendPeerMessage"),r("sending peer message "+JSON.stringify(i)),ot.sendDataWS(t,e,i,s)},this.sendServerMessage=function(t,e,i,n){function a(t){"error"===t.msgType?n&&n(t.msgData.errorCode,t.msgData.errorText):i&&i(t.msgType,t.msgData?t.msgData:null)}var s={msgType:t,msgData:e};r("sending server message "+JSON.stringify(s)),ot.sendDataWS(null,t,e,a)},this.getRoomList=function(t,e){S(null,"getRoomList",null,function(e,i){t(i.roomList)},function(t,i){e?e(t,i):ot.showError(t,i)})},this.NOT_CONNECTED="not connected",this.BECOMING_CONNECTED="connection in progress to us.",this.IS_CONNECTED="is connected",this.getConnectStatus=function(t){if(!Lt.hasOwnProperty(t))return ot.NOT_CONNECTED;var e=Lt[t];return!e.sharingAudio&&!e.sharingVideo||e.startedAV?e.sharingData&&!e.dataChannelReady?ot.BECOMING_CONNECTED:ot.IS_CONNECTED:ot.BECOMING_CONNECTED},this.call=function(t,e,i,n,a){if(a)if("string"==typeof a)a=[a];else if("undefined"==typeof a.length)return void ot.showError(ot.errCodes.DEVELOPER_ERR,"easyrtc.call passed bad streamNames");if(r("initiating peer to peer call to "+t+" audio="+ot.audioEnabled+" video="+ot.videoEnabled+" data="+Et),!ot.supportsPeerConnections())return void i(ot.errCodes.CALL_ERR,ot.getConstantString("noWebrtcSupport"));var s;if(!a&&ht){var o=ot.getLocalStream();if(!o&&(ot.audioEnabled||ot.videoEnabled))return void ot.initMediaSource(function(){ot.call(t,e,i,n)},i)}if(!ot.webSocket)throw s="Attempt to make a call prior to connecting to service",r(s),s;return Ct[t]?(n(!0,t),z(t,Ct[t],a),delete Ct[t],void ot.callCancelled(t,!1)):"undefined"!=typeof Nt[t]?(s="Call already pending acceptance",r(s),void i(ot.errCodes.ALREADY_CONNECTED,s)):void(zt?ot.getFreshIceConfig(function(r){r?H(t,e,i,n,a):i(ot.errCodes.CALL_ERR,"Attempt to get fresh ice configuration failed")}):H(t,e,i,n,a))};var Yt={};this.hangup=function(t){Y(t),Ot()},this.hangupAll=function(){var t=!1;for(var e in Lt)Lt.hasOwnProperty(e)&&(t=!0,Y(e));t&&Ot()},this.doesDataChannelWork=function(t){return Lt[t]?!!Lt[t].dataChannelReady:!1},this.getRemoteStream=function(t,e){if(Lt[t])return w(Lt[t],t,e);throw ot.showError(ot.errCodes.DEVELOPER_ERR,"attempt to get stream of uncalled party"),"Developer err: no such stream"},this.makeLocalStreamFromRemoteStream=function(t,e,i){var n;if(!Lt[t].pc)throw"Developer err: no such peer ";if(n=w(Lt[t],t,e),!n)throw"Developer err: no such stream";y(n,i)},this.addStreamToCall=function(t,e,i){e||(e="default");var n=m(e);if(n)if(Lt[t]&&Lt[t].pc){var a=Lt[t].pc;Lt[t].enableNegotiateListener=!0,a.addStream(n),i&&(Lt[t].streamsAddedAcks[e]=i)}else r("Can't add stream before a call has started.");else r("attempt to add nonexistent stream "+e)},this.setPeerListener(function(t,e,i){if(Lt[t]&&Lt[t].pc){var n=i.sdp,a=Lt[t].pc,s=function(e){var n=function(){function i(){r("sending answer succeeded")}function n(e,i){r("sending answer failed"),delete Lt[t],ot.showError(e,i)}r("sending answer"),S(t,"answer",e,i,n),Lt[t].connectionAccepted=!0,M(t,i,n)};lt&&(e.sdp=lt(e.sdp)),a.setLocalDescription(e,n,function(t){ot.showError(ot.errCodes.INTERNAL_ERR,"setLocalDescription: "+i)})},o=function(){a.createAnswer(s,function(t){ot.showError(ot.errCodes.INTERNAL_ERR,"create-answer: "+t)},xt),ot.sendPeerMessage(t,"__gotAddedMediaStream",{sdp:n})};r("about to call setRemoteDescription in doAnswer");try{ct&&(n.sdp=ct(n.sdp)),a.setRemoteDescription(new RTCSessionDescription(n),o,function(t){ot.showError(ot.errCodes.INTERNAL_ERR,"set-remote-description: "+t)})}catch(h){r("saw exception in setRemoteDescription",h),ot.showError(ot.errCodes.INTERNAL_ERR,"setRemoteDescription failed: "+h.message)}}else ot.showError(ot.errCodes.DEVELOPER_ERR,"Attempt to add additional stream before establishing the base call.")},"__addedMediaStream"),this.setPeerListener(function(t,e,i){if(Lt[t]&&Lt[t].pc){var n=i.sdp;ct&&(n.sdp=ct(n.sdp));var a=Lt[t].pc;a.setRemoteDescription(new RTCSessionDescription(n),function(){},function(t){ot.showError(ot.errCodes.INTERNAL_ERR,"set-remote-description: "+t)})}else r("setPeerListener failed: __gotAddedMediaStream Unknow easyrtcid "+t)},"__gotAddedMediaStream"),this.setPeerListener(function(t,e,i){if(Lt[t]&&Lt[t].pc){var n=w(Lt[t],t,i.streamName);n&&(A(t,n),s(n))}else r("setPeerListener failed: __closingMediaStream Unknow easyrtcid "+t)},"__closingMediaStream"),this.dumpPeerConnectionInfo=function(){var t;for(var e in Lt)if(Lt.hasOwnProperty(e)){var i=Lt[e].pc,n=i.getRemoteStreams(),a=[];for(t=0;t<n.length;t++)a.push(n[t].id);var s=i.getLocalStreams(),o=[];for(t=0;t<s.length;t++)o.push(s[t].id);r("For peer "+e),r("    "+JSON.stringify({local:o,remote:a}))}},this.isPeerInAnyRoom=function(t){return q(t)};var Xt={};this.updatePresence=function(t,e){ot.presenceShow=t,ot.presenceStatus=e,ot.webSocketConnected&&S(null,"setPresence",{setPresence:{show:ot.presenceShow,status:ot.presenceStatus}},null)},this.getSessionFields=function(){return vt},this.getSessionField=function(t){return vt[t]?vt[t].fieldValue:n},this.getRoomOccupantsAsArray=function(t){return Dt[t]?Object.keys(Dt[t]):null},this.getRoomOccupantsAsMap=function(t){return Dt[t]},this.isTurnServer=function(t){return!!ot._turnServers[t]},this.isStunServer=function(t){return!!ot._stunServers[t]},this.getFreshIceConfig=function(t){var e={msgType:"getIceConfig",msgData:{}};t||(t=function(){}),ot.webSocket.json.emit("easyrtcCmd",e,function(e){"iceConfig"===e.msgType?(tt(e.msgData.iceConfig),t(!0)):(ot.showError(e.msgData.errorCode,e.msgData.errorText),t(!1))})},this.joinRoom=function(t,e,i,n){if(ot.roomJoin[t])return void ot.showError(ot.errCodes.DEVELOPER_ERR,"Attempt to join room "+t+" which you are already in.");var r={roomName:t};if(e){try{JSON.stringify(e)}catch(a){throw ot.showError(ot.errCodes.DEVELOPER_ERR,"non-jsonable parameter to easyrtc.joinRoom"),"Developer error, see application error messages"}var s={};for(var o in e)e.hasOwnProperty(o)&&(s[o]=e[o]);r.roomParameter=s}var h,l,c,u={roomJoin:{}};ot.webSocket?(u.roomJoin[t]=r,l=function(e,n){h=n.roomData,ot.roomJoin[t]=r,i&&i(t),it(h)},c=function(e,i){n?n(e,i,t):ot.showError(e,ot.format(ot.getConstantString("unableToEnterRoom"),t,i))},S(null,"roomJoin",u,l,c)):ot.roomJoin[t]=r},this.leaveRoom=function(t,e,i){var n;ot.roomJoin[t]&&(ot.webSocket?(n={},n[t]={roomName:t},S(null,"roomLeave",{roomLeave:n},function(i,n){var r=n.roomData;it(r),e&&e(t)},function(e,n){i&&i(e,n,t)})):delete ot.roomJoin[t])},this.getRoomsJoined=function(){var t,e={};for(t in ot.roomJoin)ot.roomJoin.hasOwnProperty(t)&&(e[t]=!0);return e},this.getRoomFields=function(t){return Ht&&Ht.rooms&&Ht.rooms[t]?Ht.rooms[t]:n},this.getApplicationFields=function(){return Ht.application},this.getConnectionFields=function(){return Ht.connection},this.useThisSocketConnection=function(t){jt=t},this.connect=function(t,e,n){return i||ot.showError(ot.errCodes.DEVELOPER_ERR,"Your HTML has not included the socket.io.js library"),!jt&&ot.webSocket?void ot.showError(ot.errCodes.DEVELOPER_ERR,"Attempt to connect when already connected to socket server"):(Ft={},Gt=null,bt={},Yt={},ot.applicationName=t,Ht={rooms:{},application:{},connection:{}},r("attempt to connect to WebRTC signalling server with application name="+t),null===n&&(n=function(t,e){ot.showError(t,e)}),void st(e,n))}};return new r}),/*!
	  Script: easyrtc_app.js
	
	    Provides support file and data transfer support to easyrtc.
	
	  About: License
	
	    Copyright (c) 2016, Priologic Software Inc.
	    All rights reserved.
	
	    Redistribution and use in source and binary forms, with or without
	    modification, are permitted provided that the following conditions are met:
	
	        * Redistributions of source code must retain the above copyright notice,
	          this list of conditions and the following disclaimer.
	        * Redistributions in binary form must reproduce the above copyright
	          notice, this list of conditions and the following disclaimer in the
	          documentation and/or other materials provided with the distribution.
	
	    THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
	    AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
	    IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
	    ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE
	    LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
	    CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
	    SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
	    INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
	    CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
	    ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
	    POSSIBILITY OF SUCH DAMAGE.
	*/
function(i,s){r=[l],n=s,a="function"==typeof n?n.apply(e,r):n,!(void 0!==a&&(t.exports=a))}(void 0,function(t,e){"use strict";function i(i,r){function a(e,i){var n;if(e&&!document.getElementById(e))return t.showError(t.errCodes.DEVELOPER_ERR,"The monitor video id passed to easyApp was bad, saw "+e),!1;for(n in i)if(i.hasOwnProperty(n)){var r=i[n];if(!document.getElementById(r))return t.showError(t.errCodes.DEVELOPER_ERR,"The caller video id '"+r+"' passed to easyApp was bad."),!1}return!0}function s(t){return _[t.id]}function o(t,e){_[t.id]=e}function h(t){var i=s(t);return""===i||null===i||i===e}function l(t){return d[t]?document.getElementById(d[t]):null}function c(e,i){t.setVideoObjectSrc(e,i),e.style.visibility&&(e.style.visibility="visible")}function u(e){t.setVideoObjectSrc(e,""),e.style.visibility="hidden"}var d=r||[],f=r.length,_={},p=null,m=null;if(!a(i,d))throw"bad video element id";i&&(document.getElementById(i).muted="muted"),t.addEventListener("roomOccupants",function(e,i){var n;for(n=0;f>n;n++){var r=l(n);h(r)||t.isPeerInAnyRoom(s(r))||(m&&m(s(r),n),o(r,null))}}),t.setOnCall=function(t){p=t},t.setOnHangup=function(t){m=t},t.getIthCaller=function(t){if(0>t||t>=d.length)return null;var e=l(t);return s(e)},t.getSlotOfCaller=function(e){var i;for(i=0;f>i;i++)if(t.getIthCaller(i)===e)return i;return-1},t.setOnStreamClosed(function(t){var e;for(e=0;f>e;e++){var i=l(e);s(i)===t&&(u(i),o(i,""),m&&m(t,e))}}),t.setAcceptChecker(function(t,e){var i;for(i=0;f>i;i++){var n=l(i);if(h(n))return void e(!0)}e(!1)}),t.setStreamAcceptor(function(e,i){var n;t.debugPrinter&&t.debugPrinter("stream acceptor called");var r;for(n=0;f>n;n++)if(r=l(n),s(r)===e)return c(r,i),void(p&&p(e,n));for(n=0;f>n;n++)if(r=l(n),h(r))return o(r,e),p&&p(e,n),void c(r,i);r=l(0),r&&(t.hangup(s(r)),c(r,i),p&&p(e,0)),o(r,e)});var g,y,v,x;if(n)for(g=function(e){y=e.parentNode,o(e,""),v=document.createElement("div"),v.className="easyrtc_closeButton",v.onclick=function(){s(e)&&(t.hangup(s(e)),u(e),o(e,""))},y.appendChild(v)},x=0;f>x;x++)g(l(x));var w=null;if(t.videoEnabled&&null!==i){if(w=document.getElementById(i),!w)return void console.error("Programmer error: no object called "+i);w.muted="muted",w.defaultMuted=!0}}var n=!0;return t.dontAddCloseButtons=function(){n=!1},t.easyApp=function(e,n,r,a,s){function o(){c&&c(!0,""),a(t.myEasyrtcid)}function h(){function i(e,i){c?c(!1,i):s?s(t.errCodes.CONNECT_ERR,i):t.showError(t.errCodes.CONNECT_ERR,i)}l&&l(!0,null),null!==n&&t.setVideoObjectSrc(document.getElementById(n),t.getLocalStream()),t.connect(e,o,i)}var l=null,c=null;i(n,r),t.setGotMedia=function(t){l=t},t.setPeerClosedListener(function(e){setTimeout(function(){t.getSlotOfCaller(e)>=0&&t.isPeerInAnyRoom(e)&&t.call(e,function(){},function(){},function(){})},1e3)}),t.setGotConnection=function(t){c=t};var u=t.getLocalStream(null);u?h():t.initMediaSource(h,function(e,i){l?l(!1,i):s?s(t.errCodes.MEDIA_ERR,i):t.showError(t.errCodes.MEDIA_ERR,i)},null)},t})},,,function(t,e,i){(function(e){"use strict";/*!
	 * The buffer module from node.js, for the browser.
	 *
	 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
	 * @license  MIT
	 */
function n(t,e){if(t===e)return 0;for(var i=t.length,n=e.length,r=0,a=Math.min(i,n);a>r;++r)if(t[r]!==e[r]){i=t[r],n=e[r];break}return n>i?-1:i>n?1:0}function r(t){return e.Buffer&&"function"==typeof e.Buffer.isBuffer?e.Buffer.isBuffer(t):!(null==t||!t._isBuffer)}function a(t){return Object.prototype.toString.call(t)}function s(t){return r(t)?!1:"function"!=typeof e.ArrayBuffer?!1:"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(t):t?t instanceof DataView?!0:t.buffer&&t.buffer instanceof ArrayBuffer?!0:!1:!1}function o(t){if(x.isFunction(t)){if(C)return t.name;var e=t.toString(),i=e.match(E);return i&&i[1]}}function h(t,e){return"string"==typeof t?t.length<e?t:t.slice(0,e):t}function l(t){if(C||!x.isFunction(t))return x.inspect(t);var e=o(t),i=e?": "+e:"";return"[Function"+i+"]"}function c(t){return h(l(t.actual),128)+" "+t.operator+" "+h(l(t.expected),128)}function u(t,e,i,n,r){throw new S.AssertionError({message:i,actual:t,expected:e,operator:n,stackStartFunction:r})}function d(t,e){t||u(t,!0,e,"==",S.ok)}function f(t,e,i,o){if(t===e)return!0;if(r(t)&&r(e))return 0===n(t,e);if(x.isDate(t)&&x.isDate(e))return t.getTime()===e.getTime();if(x.isRegExp(t)&&x.isRegExp(e))return t.source===e.source&&t.global===e.global&&t.multiline===e.multiline&&t.lastIndex===e.lastIndex&&t.ignoreCase===e.ignoreCase;if(null!==t&&"object"==typeof t||null!==e&&"object"==typeof e){if(s(t)&&s(e)&&a(t)===a(e)&&!(t instanceof Float32Array||t instanceof Float64Array))return 0===n(new Uint8Array(t.buffer),new Uint8Array(e.buffer));if(r(t)!==r(e))return!1;o=o||{actual:[],expected:[]};var h=o.actual.indexOf(t);return-1!==h&&h===o.expected.indexOf(e)?!0:(o.actual.push(t),o.expected.push(e),p(t,e,i,o))}return i?t===e:t==e}function _(t){return"[object Arguments]"==Object.prototype.toString.call(t)}function p(t,e,i,n){if(null===t||void 0===t||null===e||void 0===e)return!1;if(x.isPrimitive(t)||x.isPrimitive(e))return t===e;if(i&&Object.getPrototypeOf(t)!==Object.getPrototypeOf(e))return!1;var r=_(t),a=_(e);if(r&&!a||!r&&a)return!1;if(r)return t=b.call(t),e=b.call(e),f(t,e,i);var s,o,h=T(t),l=T(e);if(h.length!==l.length)return!1;for(h.sort(),l.sort(),o=h.length-1;o>=0;o--)if(h[o]!==l[o])return!1;for(o=h.length-1;o>=0;o--)if(s=h[o],!f(t[s],e[s],i,n))return!1;return!0}function m(t,e,i){f(t,e,!0)&&u(t,e,i,"notDeepStrictEqual",m)}function g(t,e){if(!t||!e)return!1;if("[object RegExp]"==Object.prototype.toString.call(e))return e.test(t);try{if(t instanceof e)return!0}catch(i){}return Error.isPrototypeOf(e)?!1:e.call({},t)===!0}function y(t){var e;try{t()}catch(i){e=i}return e}function v(t,e,i,n){var r;if("function"!=typeof e)throw new TypeError('"block" argument must be a function');"string"==typeof i&&(n=i,i=null),r=y(e),n=(i&&i.name?" ("+i.name+").":".")+(n?" "+n:"."),t&&!r&&u(r,i,"Missing expected exception"+n);var a="string"==typeof n,s=!t&&x.isError(r),o=!t&&r&&!i;if((s&&a&&g(r,i)||o)&&u(r,i,"Got unwanted exception"+n),t&&r&&i&&!g(r,i)||!t&&r)throw r}var x=i(91),w=Object.prototype.hasOwnProperty,b=Array.prototype.slice,C=function(){return"foo"===function(){}.name}(),S=t.exports=d,E=/\s*function\s+([^\(\s]*)\s*/;S.AssertionError=function(t){this.name="AssertionError",this.actual=t.actual,this.expected=t.expected,this.operator=t.operator,t.message?(this.message=t.message,this.generatedMessage=!1):(this.message=c(this),this.generatedMessage=!0);var e=t.stackStartFunction||u;if(Error.captureStackTrace)Error.captureStackTrace(this,e);else{var i=new Error;if(i.stack){var n=i.stack,r=o(e),a=n.indexOf("\n"+r);if(a>=0){var s=n.indexOf("\n",a+1);n=n.substring(s+1)}this.stack=n}}},x.inherits(S.AssertionError,Error),S.fail=u,S.ok=d,S.equal=function(t,e,i){t!=e&&u(t,e,i,"==",S.equal)},S.notEqual=function(t,e,i){t==e&&u(t,e,i,"!=",S.notEqual)},S.deepEqual=function(t,e,i){f(t,e,!1)||u(t,e,i,"deepEqual",S.deepEqual)},S.deepStrictEqual=function(t,e,i){f(t,e,!0)||u(t,e,i,"deepStrictEqual",S.deepStrictEqual)},S.notDeepEqual=function(t,e,i){f(t,e,!1)&&u(t,e,i,"notDeepEqual",S.notDeepEqual)},S.notDeepStrictEqual=m,S.strictEqual=function(t,e,i){t!==e&&u(t,e,i,"===",S.strictEqual)},S.notStrictEqual=function(t,e,i){t===e&&u(t,e,i,"!==",S.notStrictEqual)},S["throws"]=function(t,e,i){v(!0,t,e,i)},S.doesNotThrow=function(t,e,i){v(!1,t,e,i)},S.ifError=function(t){if(t)throw t};var T=Object.keys||function(t){var e=[];for(var i in t)w.call(t,i)&&e.push(i);return e}}).call(e,function(){return this}())},,,function(t,e,i){function n(t,e){"object"==typeof t&&(e=t,t=void 0),e=e||{};var i,n=r(t),a=n.source,l=n.id,c=n.path,u=h[l]&&c in h[l].nsps,d=e.forceNew||e["force new connection"]||!1===e.multiplex||u;return d?(o("ignoring socket cache for %s",a),i=s(a,e)):(h[l]||(o("new io instance for %s",a),h[l]=s(a,e)),i=h[l]),n.query&&!e.query&&(e.query=n.query),i.socket(n.path,e)}var r=i(98),a=i(109),s=i(99),o=i(112)("socket.io-client");t.exports=e=n;var h=e.managers={};e.protocol=a.protocol,e.connect=n,e.Manager=i(99),e.Socket=i(100)},,,,,,function(t,e,i){(function(e){function n(t,i){var n=t;i=i||e.location,null==t&&(t=i.protocol+"//"+i.host),"string"==typeof t&&("/"===t.charAt(0)&&(t="/"===t.charAt(1)?i.protocol+t:i.host+t),/^(https?|wss?):\/\//.test(t)||(a("protocol-less url %s",t),t="undefined"!=typeof i?i.protocol+"//"+t:"https://"+t),a("parse %s",t),n=r(t)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";var s=-1!==n.host.indexOf(":"),o=s?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+o+":"+n.port,n.href=n.protocol+"://"+o+(i&&i.port===n.port?"":":"+n.port),n}var r=i(118),a=i(112)("socket.io-client:url");t.exports=n}).call(e,function(){return this}())},function(t,e,i){function n(t,e){if(!(this instanceof n))return new n(t,e);t&&"object"==typeof t&&(e=t,t=void 0),e=e||{},e.path=e.path||"/socket.io",this.nsps={},this.subs=[],this.opts=e,this.reconnection(e.reconnection!==!1),this.reconnectionAttempts(e.reconnectionAttempts||1/0),this.reconnectionDelay(e.reconnectionDelay||1e3),this.reconnectionDelayMax(e.reconnectionDelayMax||5e3),this.randomizationFactor(e.randomizationFactor||.5),this.backoff=new d({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==e.timeout?2e4:e.timeout),this.readyState="closed",this.uri=t,this.connecting=[],this.lastPing=null,this.encoding=!1,this.packetBuffer=[];var i=e.parser||o;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this.autoConnect=e.autoConnect!==!1,this.autoConnect&&this.open()}var r=i(124),a=i(100),s=i(126),o=i(109),h=i(110),l=i(127),c=i(112)("socket.io-client:manager"),u=i(125),d=i(128),f=Object.prototype.hasOwnProperty;t.exports=n,n.prototype.emitAll=function(){this.emit.apply(this,arguments);for(var t in this.nsps)f.call(this.nsps,t)&&this.nsps[t].emit.apply(this.nsps[t],arguments)},n.prototype.updateSocketIds=function(){for(var t in this.nsps)f.call(this.nsps,t)&&(this.nsps[t].id=this.generateId(t))},n.prototype.generateId=function(t){return("/"===t?"":t+"#")+this.engine.id},s(n.prototype),n.prototype.reconnection=function(t){return arguments.length?(this._reconnection=!!t,this):this._reconnection},n.prototype.reconnectionAttempts=function(t){return arguments.length?(this._reconnectionAttempts=t,this):this._reconnectionAttempts},n.prototype.reconnectionDelay=function(t){return arguments.length?(this._reconnectionDelay=t,this.backoff&&this.backoff.setMin(t),this):this._reconnectionDelay},n.prototype.randomizationFactor=function(t){return arguments.length?(this._randomizationFactor=t,this.backoff&&this.backoff.setJitter(t),this):this._randomizationFactor},n.prototype.reconnectionDelayMax=function(t){return arguments.length?(this._reconnectionDelayMax=t,this.backoff&&this.backoff.setMax(t),this):this._reconnectionDelayMax},n.prototype.timeout=function(t){return arguments.length?(this._timeout=t,this):this._timeout},n.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},n.prototype.open=n.prototype.connect=function(t,e){if(c("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;c("opening %s",this.uri),this.engine=r(this.uri,this.opts);var i=this.engine,n=this;this.readyState="opening",this.skipReconnect=!1;var a=h(i,"open",function(){n.onopen(),t&&t()}),s=h(i,"error",function(e){if(c("connect_error"),n.cleanup(),n.readyState="closed",n.emitAll("connect_error",e),t){var i=new Error("Connection error");i.data=e,t(i)}else n.maybeReconnectOnOpen()});if(!1!==this._timeout){var o=this._timeout;c("connect attempt will timeout after %d",o);var l=setTimeout(function(){c("connect attempt timed out after %d",o),a.destroy(),i.close(),i.emit("error","timeout"),n.emitAll("connect_timeout",o)},o);this.subs.push({destroy:function(){clearTimeout(l)}})}return this.subs.push(a),this.subs.push(s),this},n.prototype.onopen=function(){c("open"),this.cleanup(),this.readyState="open",this.emit("open");var t=this.engine;this.subs.push(h(t,"data",l(this,"ondata"))),this.subs.push(h(t,"ping",l(this,"onping"))),this.subs.push(h(t,"pong",l(this,"onpong"))),this.subs.push(h(t,"error",l(this,"onerror"))),this.subs.push(h(t,"close",l(this,"onclose"))),this.subs.push(h(this.decoder,"decoded",l(this,"ondecoded")))},n.prototype.onping=function(){this.lastPing=new Date,this.emitAll("ping")},n.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)},n.prototype.ondata=function(t){this.decoder.add(t)},n.prototype.ondecoded=function(t){this.emit("packet",t)},n.prototype.onerror=function(t){c("error",t),this.emitAll("error",t)},n.prototype.socket=function(t,e){function i(){~u(r.connecting,n)||r.connecting.push(n)}var n=this.nsps[t];if(!n){n=new a(this,t,e),this.nsps[t]=n;var r=this;n.on("connecting",i),n.on("connect",function(){n.id=r.generateId(t)}),this.autoConnect&&i()}return n},n.prototype.destroy=function(t){var e=u(this.connecting,t);~e&&this.connecting.splice(e,1),this.connecting.length||this.close()},n.prototype.packet=function(t){c("writing packet %j",t);var e=this;t.query&&0===t.type&&(t.nsp+="?"+t.query),e.encoding?e.packetBuffer.push(t):(e.encoding=!0,this.encoder.encode(t,function(i){for(var n=0;n<i.length;n++)e.engine.write(i[n],t.options);e.encoding=!1,e.processPacketQueue()}))},n.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var t=this.packetBuffer.shift();this.packet(t)}},n.prototype.cleanup=function(){c("cleanup");for(var t=this.subs.length,e=0;t>e;e++){var i=this.subs.shift();i.destroy()}this.packetBuffer=[],this.encoding=!1,this.lastPing=null,this.decoder.destroy()},n.prototype.close=n.prototype.disconnect=function(){c("disconnect"),this.skipReconnect=!0,this.reconnecting=!1,"opening"===this.readyState&&this.cleanup(),this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},n.prototype.onclose=function(t){c("onclose"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",t),this._reconnection&&!this.skipReconnect&&this.reconnect()},n.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var t=this;if(this.backoff.attempts>=this._reconnectionAttempts)c("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var e=this.backoff.duration();c("will wait %dms before reconnect attempt",e),this.reconnecting=!0;var i=setTimeout(function(){t.skipReconnect||(c("attempting reconnect"),t.emitAll("reconnect_attempt",t.backoff.attempts),t.emitAll("reconnecting",t.backoff.attempts),t.skipReconnect||t.open(function(e){e?(c("reconnect attempt error"),t.reconnecting=!1,t.reconnect(),t.emitAll("reconnect_error",e.data)):(c("reconnect success"),t.onreconnect())}))},e);this.subs.push({destroy:function(){clearTimeout(i)}})}},n.prototype.onreconnect=function(){var t=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",t)}},function(t,e,i){function n(t,e,i){this.io=t,this.nsp=e,this.json=this,this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,i&&i.query&&(this.query=i.query),this.io.autoConnect&&this.open()}var r=i(109),a=i(126),s=i(129),o=i(110),h=i(127),l=i(112)("socket.io-client:socket"),c=i(130);t.exports=e=n;var u={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},d=a.prototype.emit;a(n.prototype),n.prototype.subEvents=function(){if(!this.subs){var t=this.io;this.subs=[o(t,"open",h(this,"onopen")),o(t,"packet",h(this,"onpacket")),o(t,"close",h(this,"onclose"))]}},n.prototype.open=n.prototype.connect=function(){return this.connected?this:(this.subEvents(),this.io.open(),"open"===this.io.readyState&&this.onopen(),this.emit("connecting"),this)},n.prototype.send=function(){var t=s(arguments);return t.unshift("message"),this.emit.apply(this,t),this},n.prototype.emit=function(t){if(u.hasOwnProperty(t))return d.apply(this,arguments),this;var e=s(arguments),i={type:r.EVENT,data:e};return i.options={},i.options.compress=!this.flags||!1!==this.flags.compress,"function"==typeof e[e.length-1]&&(l("emitting packet with ack id %d",this.ids),this.acks[this.ids]=e.pop(),i.id=this.ids++),this.connected?this.packet(i):this.sendBuffer.push(i),delete this.flags,this},n.prototype.packet=function(t){t.nsp=this.nsp,this.io.packet(t)},n.prototype.onopen=function(){if(l("transport is open - connecting"),"/"!==this.nsp)if(this.query){var t="object"==typeof this.query?c.encode(this.query):this.query;l("sending connect packet with query %s",t),this.packet({type:r.CONNECT,query:t})}else this.packet({type:r.CONNECT})},n.prototype.onclose=function(t){l("close (%s)",t),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",t)},n.prototype.onpacket=function(t){if(t.nsp===this.nsp)switch(t.type){case r.CONNECT:this.onconnect();break;case r.EVENT:this.onevent(t);break;case r.BINARY_EVENT:this.onevent(t);break;case r.ACK:this.onack(t);break;case r.BINARY_ACK:this.onack(t);break;case r.DISCONNECT:this.ondisconnect();break;case r.ERROR:this.emit("error",t.data)}},n.prototype.onevent=function(t){var e=t.data||[];l("emitting event %j",e),null!=t.id&&(l("attaching ack callback to event"),e.push(this.ack(t.id))),this.connected?d.apply(this,e):this.receiveBuffer.push(e)},n.prototype.ack=function(t){var e=this,i=!1;return function(){if(!i){i=!0;var n=s(arguments);l("sending ack %j",n),e.packet({type:r.ACK,id:t,data:n})}}},n.prototype.onack=function(t){var e=this.acks[t.id];"function"==typeof e?(l("calling ack %s with %j",t.id,t.data),e.apply(this,t.data),delete this.acks[t.id]):l("bad ack %s",t.id)},n.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},n.prototype.emitBuffered=function(){var t;for(t=0;t<this.receiveBuffer.length;t++)d.apply(this,this.receiveBuffer[t]);for(this.receiveBuffer=[],t=0;t<this.sendBuffer.length;t++)this.packet(this.sendBuffer[t]);this.sendBuffer=[]},n.prototype.ondisconnect=function(){l("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},n.prototype.destroy=function(){if(this.subs){for(var t=0;t<this.subs.length;t++)this.subs[t].destroy();this.subs=null}this.io.destroy(this)},n.prototype.close=n.prototype.disconnect=function(){return this.connected&&(l("performing disconnect (%s)",this.nsp),this.packet({type:r.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this},n.prototype.compress=function(t){return this.flags=this.flags||{},this.flags.compress=t,this}},,,,,,,,,function(t,e,i){function n(){}function r(t){var i=""+t.type;return(e.BINARY_EVENT===t.type||e.BINARY_ACK===t.type)&&(i+=t.attachments+"-"),t.nsp&&"/"!==t.nsp&&(i+=t.nsp+","),null!=t.id&&(i+=t.id),null!=t.data&&(i+=JSON.stringify(t.data)),u("encoded %j as %s",t,i),i}function a(t,e){function i(t){var i=_.deconstructPacket(t),n=r(i.packet),a=i.buffers;a.unshift(n),e(a)}_.removeBlobs(t,i)}function s(){this.reconstructor=null}function o(t){var i=0,n={type:Number(t.charAt(0))};if(null==e.types[n.type])return c();if(e.BINARY_EVENT===n.type||e.BINARY_ACK===n.type){for(var r="";"-"!==t.charAt(++i)&&(r+=t.charAt(i),i!=t.length););if(r!=Number(r)||"-"!==t.charAt(i))throw new Error("Illegal attachments");n.attachments=Number(r)}if("/"===t.charAt(i+1))for(n.nsp="";++i;){var a=t.charAt(i);if(","===a)break;if(n.nsp+=a,i===t.length)break}else n.nsp="/";var s=t.charAt(i+1);if(""!==s&&Number(s)==s){for(n.id="";++i;){var a=t.charAt(i);if(null==a||Number(a)!=a){--i;break}if(n.id+=t.charAt(i),i===t.length)break}n.id=Number(n.id)}return t.charAt(++i)&&(n=h(n,t.substr(i))),u("decoded %s as %j",t,n),n}function h(t,e){try{t.data=JSON.parse(e)}catch(i){return c()}return t}function l(t){this.reconPack=t,this.buffers=[]}function c(){return{type:e.ERROR,data:"parser error"}}var u=i(112)("socket.io-parser"),d=i(126),f=i(137),_=i(131),p=i(132);e.protocol=4,e.types=["CONNECT","DISCONNECT","EVENT","ACK","ERROR","BINARY_EVENT","BINARY_ACK"],e.CONNECT=0,e.DISCONNECT=1,e.EVENT=2,e.ACK=3,e.ERROR=4,e.BINARY_EVENT=5,e.BINARY_ACK=6,e.Encoder=n,e.Decoder=s,n.prototype.encode=function(t,i){if(t.type!==e.EVENT&&t.type!==e.ACK||!f(t.data)||(t.type=t.type===e.EVENT?e.BINARY_EVENT:e.BINARY_ACK),u("encoding packet %j",t),e.BINARY_EVENT===t.type||e.BINARY_ACK===t.type)a(t,i);else{var n=r(t);i([n])}},d(s.prototype),s.prototype.add=function(t){var i;if("string"==typeof t)i=o(t),e.BINARY_EVENT===i.type||e.BINARY_ACK===i.type?(this.reconstructor=new l(i),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",i)):this.emit("decoded",i);else{if(!p(t)&&!t.base64)throw new Error("Unknown type: "+t);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");i=this.reconstructor.takeBinaryData(t),i&&(this.reconstructor=null,this.emit("decoded",i))}},s.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()},l.prototype.takeBinaryData=function(t){if(this.buffers.push(t),this.buffers.length===this.reconPack.attachments){var e=_.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),e}return null},l.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]}},function(t,e,i){function n(t,e,i){return t.on(e,i),{destroy:function(){t.removeListener(e,i)}}}t.exports=n},,function(t,e,i){(function(n){function r(){return"undefined"!=typeof window&&window.process&&"renderer"===window.process.type?!0:"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function a(t){var i=this.useColors;if(t[0]=(i?"%c":"")+this.namespace+(i?" %c":" ")+t[0]+(i?"%c ":" ")+"+"+e.humanize(this.diff),i){var n="color: "+this.color;t.splice(1,0,n,"color: inherit");var r=0,a=0;t[0].replace(/%[a-zA-Z%]/g,function(t){"%%"!==t&&(r++,"%c"===t&&(a=r))}),t.splice(a,0,n)}}function s(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function o(t){try{null==t?e.storage.removeItem("debug"):e.storage.debug=t}catch(i){}}function h(){var t;try{t=e.storage.debug}catch(i){}return!t&&"undefined"!=typeof n&&"env"in n&&(t=n.env.DEBUG),t}function l(){try{return window.localStorage}catch(t){}}e=t.exports=i(133),e.log=s,e.formatArgs=a,e.save=o,e.load=h,e.useColors=r,e.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:l(),e.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],e.formatters.j=function(t){try{return JSON.stringify(t)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},e.enable(h())}).call(e,i(76))},,,,,,function(t,e,i){var n=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,r=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];t.exports=function(t){var e=t,i=t.indexOf("["),a=t.indexOf("]");-1!=i&&-1!=a&&(t=t.substring(0,i)+t.substring(i,a).replace(/:/g,";")+t.substring(a,t.length));for(var s=n.exec(t||""),o={},h=14;h--;)o[r[h]]=s[h]||"";return-1!=i&&-1!=a&&(o.source=e,o.host=o.host.substring(1,o.host.length-1).replace(/;/g,":"),o.authority=o.authority.replace("[","").replace("]","").replace(/;/g,":"),o.ipv6uri=!0),o}},,,,,,function(t,e,i){t.exports=i(138)},function(t,e,i){var n=[].indexOf;t.exports=function(t,e){if(n)return t.indexOf(e);for(var i=0;i<t.length;++i)if(t[i]===e)return i;return-1}},function(t,e,i){function n(t){return t?r(t):void 0}function r(t){for(var e in n.prototype)t[e]=n.prototype[e];return t}t.exports=n,n.prototype.on=n.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this},n.prototype.once=function(t,e){function i(){this.off(t,i),e.apply(this,arguments)}return i.fn=e,this.on(t,i),this},n.prototype.off=n.prototype.removeListener=n.prototype.removeAllListeners=n.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var i=this._callbacks["$"+t];if(!i)return this;if(1==arguments.length)return delete this._callbacks["$"+t],this;for(var n,r=0;r<i.length;r++)if(n=i[r],n===e||n.fn===e){i.splice(r,1);break}return this},n.prototype.emit=function(t){this._callbacks=this._callbacks||{};var e=[].slice.call(arguments,1),i=this._callbacks["$"+t];if(i){i=i.slice(0);for(var n=0,r=i.length;r>n;++n)i[n].apply(this,e)}return this},n.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]},n.prototype.hasListeners=function(t){return!!this.listeners(t).length}},function(t,e,i){var n=[].slice;t.exports=function(t,e){if("string"==typeof e&&(e=t[e]),"function"!=typeof e)throw new Error("bind() requires a function");var i=n.call(arguments,2);return function(){return e.apply(t,i.concat(n.call(arguments)))}}},function(t,e,i){function n(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}t.exports=n,n.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),i=Math.floor(e*this.jitter*t);t=0==(1&Math.floor(10*e))?t-i:t+i}return 0|Math.min(t,this.max)},n.prototype.reset=function(){this.attempts=0},n.prototype.setMin=function(t){this.ms=t},n.prototype.setMax=function(t){this.max=t},n.prototype.setJitter=function(t){this.jitter=t}},function(t,e,i){function n(t,e){var i=[];e=e||0;for(var n=e||0;n<t.length;n++)i[n-e]=t[n];return i}t.exports=n},function(t,e,i){e.encode=function(t){var e="";for(var i in t)t.hasOwnProperty(i)&&(e.length&&(e+="&"),e+=encodeURIComponent(i)+"="+encodeURIComponent(t[i]));return e},e.decode=function(t){for(var e={},i=t.split("&"),n=0,r=i.length;r>n;n++){var a=i[n].split("=");e[decodeURIComponent(a[0])]=decodeURIComponent(a[1])}return e}},function(t,e,i){(function(t){function n(t,e){if(!t)return t;if(s(t)){var i={_placeholder:!0,num:e.length};return e.push(t),i}if(a(t)){for(var r=new Array(t.length),o=0;o<t.length;o++)r[o]=n(t[o],e);return r}if("object"==typeof t&&!(t instanceof Date)){var r={};for(var h in t)r[h]=n(t[h],e);return r}return t}function r(t,e){if(!t)return t;if(t&&t._placeholder)return e[t.num];if(a(t))for(var i=0;i<t.length;i++)t[i]=r(t[i],e);else if("object"==typeof t)for(var n in t)t[n]=r(t[n],e);return t}var a=i(141),s=i(132),o=Object.prototype.toString,h="function"==typeof t.Blob||"[object BlobConstructor]"===o.call(t.Blob),l="function"==typeof t.File||"[object FileConstructor]"===o.call(t.File);e.deconstructPacket=function(t){var e=[],i=t.data,r=t;return r.data=n(i,e),r.attachments=e.length,{packet:r,buffers:e}},e.reconstructPacket=function(t,e){return t.data=r(t.data,e),t.attachments=void 0,t},e.removeBlobs=function(t,e){function i(t,o,c){if(!t)return t;if(h&&t instanceof Blob||l&&t instanceof File){n++;var u=new FileReader;u.onload=function(){c?c[o]=this.result:r=this.result,--n||e(r)},u.readAsArrayBuffer(t)}else if(a(t))for(var d=0;d<t.length;d++)i(t[d],d,t);else if("object"==typeof t&&!s(t))for(var f in t)i(t[f],f,t)}var n=0,r=t;i(r),n||e(r)}}).call(e,function(){return this}())},function(t,e,i){(function(e){function i(t){return e.Buffer&&e.Buffer.isBuffer(t)||e.ArrayBuffer&&t instanceof ArrayBuffer}t.exports=i}).call(e,function(){return this}())},function(t,e,i){function n(t){var i,n=0;for(i in t)n=(n<<5)-n+t.charCodeAt(i),n|=0;return e.colors[Math.abs(n)%e.colors.length]}function r(t){function i(){if(i.enabled){var t=i,n=+new Date,r=n-(l||n);t.diff=r,t.prev=l,t.curr=n,l=n;for(var a=new Array(arguments.length),s=0;s<a.length;s++)a[s]=arguments[s];a[0]=e.coerce(a[0]),"string"!=typeof a[0]&&a.unshift("%O");var o=0;a[0]=a[0].replace(/%([a-zA-Z%])/g,function(i,n){if("%%"===i)return i;o++;var r=e.formatters[n];if("function"==typeof r){var s=a[o];i=r.call(t,s),a.splice(o,1),o--}return i}),e.formatArgs.call(t,a);var h=i.log||e.log||console.log.bind(console);h.apply(t,a)}}return i.namespace=t,i.enabled=e.enabled(t),i.useColors=e.useColors(),i.color=n(t),"function"==typeof e.init&&e.init(i),i}function a(t){e.save(t),e.names=[],e.skips=[];for(var i=("string"==typeof t?t:"").split(/[\s,]+/),n=i.length,r=0;n>r;r++)i[r]&&(t=i[r].replace(/\*/g,".*?"),"-"===t[0]?e.skips.push(new RegExp("^"+t.substr(1)+"$")):e.names.push(new RegExp("^"+t+"$")))}function s(){e.enable("")}function o(t){var i,n;for(i=0,n=e.skips.length;n>i;i++)if(e.skips[i].test(t))return!1;for(i=0,n=e.names.length;n>i;i++)if(e.names[i].test(t))return!0;return!1}function h(t){return t instanceof Error?t.stack||t.message:t}e=t.exports=r.debug=r["default"]=r,e.coerce=h,e.disable=s,e.enable=a,e.enabled=o,e.humanize=i(149),e.names=[],e.skips=[],e.formatters={};var l},,,,function(t,e,i){(function(e){function n(t){if(!t||"object"!=typeof t)return!1;if(r(t)){for(var i=0,a=t.length;a>i;i++)if(n(t[i]))return!0;return!1}if("function"==typeof e.Buffer&&e.Buffer.isBuffer&&e.Buffer.isBuffer(t)||"function"==typeof e.ArrayBuffer&&t instanceof ArrayBuffer||s&&t instanceof Blob||o&&t instanceof File)return!0;if(t.toJSON&&"function"==typeof t.toJSON&&1===arguments.length)return n(t.toJSON(),!0);for(var h in t)if(Object.prototype.hasOwnProperty.call(t,h)&&n(t[h]))return!0;return!1}var r=i(141),a=Object.prototype.toString,s="function"==typeof e.Blob||"[object BlobConstructor]"===a.call(e.Blob),o="function"==typeof e.File||"[object FileConstructor]"===a.call(e.File);t.exports=n}).call(e,function(){return this}())},function(t,e,i){t.exports=i(148),t.exports.parser=i(156)},,,function(t,e,i){var n={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==n.call(t)}},,,,,,,function(t,e,i){(function(e){function n(t,i){if(!(this instanceof n))return new n(t,i);i=i||{},t&&"object"==typeof t&&(i=t,t=null),t?(t=c(t),i.hostname=t.host,i.secure="https"===t.protocol||"wss"===t.protocol,i.port=t.port,t.query&&(i.query=t.query)):i.host&&(i.hostname=c(i.host).host),this.secure=null!=i.secure?i.secure:e.location&&"https:"===location.protocol,i.hostname&&!i.port&&(i.port=this.secure?"443":"80"),this.agent=i.agent||!1,this.hostname=i.hostname||(e.location?location.hostname:"localhost"),this.port=i.port||(e.location&&location.port?location.port:this.secure?443:80),this.query=i.query||{},"string"==typeof this.query&&(this.query=d.decode(this.query)),this.upgrade=!1!==i.upgrade,this.path=(i.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!i.forceJSONP,this.jsonp=!1!==i.jsonp,this.forceBase64=!!i.forceBase64,this.enablesXDR=!!i.enablesXDR,this.timestampParam=i.timestampParam||"t",this.timestampRequests=i.timestampRequests,this.transports=i.transports||["polling","websocket"],this.transportOptions=i.transportOptions||{},this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.policyPort=i.policyPort||843,this.rememberUpgrade=i.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=i.onlyBinaryUpgrades,this.perMessageDeflate=!1!==i.perMessageDeflate?i.perMessageDeflate||{}:!1,!0===this.perMessageDeflate&&(this.perMessageDeflate={}),this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024),this.pfx=i.pfx||null,this.key=i.key||null,this.passphrase=i.passphrase||null,this.cert=i.cert||null,this.ca=i.ca||null,this.ciphers=i.ciphers||null,this.rejectUnauthorized=void 0===i.rejectUnauthorized?!0:i.rejectUnauthorized,this.forceNode=!!i.forceNode;var r="object"==typeof e&&e;r.global===r&&(i.extraHeaders&&Object.keys(i.extraHeaders).length>0&&(this.extraHeaders=i.extraHeaders),i.localAddress&&(this.localAddress=i.localAddress)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingIntervalTimer=null,this.pingTimeoutTimer=null,this.open()}function r(t){var e={};for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e}var a=i(155),s=i(126),o=i(112)("engine.io-client:socket"),h=i(125),l=i(156),c=i(118),u=i(157),d=i(130);t.exports=n,n.priorWebsocketSuccess=!1,s(n.prototype),n.protocol=l.protocol,n.Socket=n,n.Transport=i(154),n.transports=i(155),n.parser=i(156),n.prototype.createTransport=function(t){o('creating transport "%s"',t);var e=r(this.query);e.EIO=l.protocol,e.transport=t;var i=this.transportOptions[t]||{};this.id&&(e.sid=this.id);var n=new a[t]({query:e,socket:this,agent:i.agent||this.agent,hostname:i.hostname||this.hostname,port:i.port||this.port,secure:i.secure||this.secure,path:i.path||this.path,forceJSONP:i.forceJSONP||this.forceJSONP,jsonp:i.jsonp||this.jsonp,forceBase64:i.forceBase64||this.forceBase64,enablesXDR:i.enablesXDR||this.enablesXDR,timestampRequests:i.timestampRequests||this.timestampRequests,timestampParam:i.timestampParam||this.timestampParam,policyPort:i.policyPort||this.policyPort,pfx:i.pfx||this.pfx,key:i.key||this.key,passphrase:i.passphrase||this.passphrase,cert:i.cert||this.cert,ca:i.ca||this.ca,ciphers:i.ciphers||this.ciphers,rejectUnauthorized:i.rejectUnauthorized||this.rejectUnauthorized,perMessageDeflate:i.perMessageDeflate||this.perMessageDeflate,extraHeaders:i.extraHeaders||this.extraHeaders,forceNode:i.forceNode||this.forceNode,localAddress:i.localAddress||this.localAddress,requestTimeout:i.requestTimeout||this.requestTimeout,protocols:i.protocols||void 0});return n},n.prototype.open=function(){var t;if(this.rememberUpgrade&&n.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))t="websocket";else{if(0===this.transports.length){var e=this;return void setTimeout(function(){e.emit("error","No transports available")},0)}t=this.transports[0]}this.readyState="opening";try{t=this.createTransport(t)}catch(i){return this.transports.shift(),void this.open()}t.open(),this.setTransport(t)},n.prototype.setTransport=function(t){o("setting transport %s",t.name);var e=this;this.transport&&(o("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=t,t.on("drain",function(){e.onDrain()}).on("packet",function(t){e.onPacket(t)}).on("error",function(t){e.onError(t)}).on("close",function(){e.onClose("transport close")})},n.prototype.probe=function(t){function e(){if(d.onlyBinaryUpgrades){var e=!this.supportsBinary&&d.transport.supportsBinary;u=u||e}u||(o('probe transport "%s" opened',t),c.send([{type:"ping",data:"probe"}]),c.once("packet",function(e){if(!u)if("pong"===e.type&&"probe"===e.data){
if(o('probe transport "%s" pong',t),d.upgrading=!0,d.emit("upgrading",c),!c)return;n.priorWebsocketSuccess="websocket"===c.name,o('pausing current transport "%s"',d.transport.name),d.transport.pause(function(){u||"closed"!==d.readyState&&(o("changing transport and sending upgrade packet"),l(),d.setTransport(c),c.send([{type:"upgrade"}]),d.emit("upgrade",c),c=null,d.upgrading=!1,d.flush())})}else{o('probe transport "%s" failed',t);var i=new Error("probe error");i.transport=c.name,d.emit("upgradeError",i)}}))}function i(){u||(u=!0,l(),c.close(),c=null)}function r(e){var n=new Error("probe error: "+e);n.transport=c.name,i(),o('probe transport "%s" failed because of error: %s',t,e),d.emit("upgradeError",n)}function a(){r("transport closed")}function s(){r("socket closed")}function h(t){c&&t.name!==c.name&&(o('"%s" works - aborting "%s"',t.name,c.name),i())}function l(){c.removeListener("open",e),c.removeListener("error",r),c.removeListener("close",a),d.removeListener("close",s),d.removeListener("upgrading",h)}o('probing transport "%s"',t);var c=this.createTransport(t,{probe:1}),u=!1,d=this;n.priorWebsocketSuccess=!1,c.once("open",e),c.once("error",r),c.once("close",a),this.once("close",s),this.once("upgrading",h),c.open()},n.prototype.onOpen=function(){if(o("socket open"),this.readyState="open",n.priorWebsocketSuccess="websocket"===this.transport.name,this.emit("open"),this.flush(),"open"===this.readyState&&this.upgrade&&this.transport.pause){o("starting upgrade probes");for(var t=0,e=this.upgrades.length;e>t;t++)this.probe(this.upgrades[t])}},n.prototype.onPacket=function(t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(o('socket receive: type "%s", data "%s"',t.type,t.data),this.emit("packet",t),this.emit("heartbeat"),t.type){case"open":this.onHandshake(u(t.data));break;case"pong":this.setPing(),this.emit("pong");break;case"error":var e=new Error("server error");e.code=t.data,this.onError(e);break;case"message":this.emit("data",t.data),this.emit("message",t.data)}else o('packet received with socket readyState "%s"',this.readyState)},n.prototype.onHandshake=function(t){this.emit("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this.upgrades=this.filterUpgrades(t.upgrades),this.pingInterval=t.pingInterval,this.pingTimeout=t.pingTimeout,this.onOpen(),"closed"!==this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},n.prototype.onHeartbeat=function(t){clearTimeout(this.pingTimeoutTimer);var e=this;e.pingTimeoutTimer=setTimeout(function(){"closed"!==e.readyState&&e.onClose("ping timeout")},t||e.pingInterval+e.pingTimeout)},n.prototype.setPing=function(){var t=this;clearTimeout(t.pingIntervalTimer),t.pingIntervalTimer=setTimeout(function(){o("writing ping packet - expecting pong within %sms",t.pingTimeout),t.ping(),t.onHeartbeat(t.pingTimeout)},t.pingInterval)},n.prototype.ping=function(){var t=this;this.sendPacket("ping",function(){t.emit("ping")})},n.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emit("drain"):this.flush()},n.prototype.flush=function(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(o("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},n.prototype.write=n.prototype.send=function(t,e,i){return this.sendPacket("message",t,e,i),this},n.prototype.sendPacket=function(t,e,i,n){if("function"==typeof e&&(n=e,e=void 0),"function"==typeof i&&(n=i,i=null),"closing"!==this.readyState&&"closed"!==this.readyState){i=i||{},i.compress=!1!==i.compress;var r={type:t,data:e,options:i};this.emit("packetCreate",r),this.writeBuffer.push(r),n&&this.once("flush",n),this.flush()}},n.prototype.close=function(){function t(){n.onClose("forced close"),o("socket closing - telling transport to close"),n.transport.close()}function e(){n.removeListener("upgrade",e),n.removeListener("upgradeError",e),t()}function i(){n.once("upgrade",e),n.once("upgradeError",e)}if("opening"===this.readyState||"open"===this.readyState){this.readyState="closing";var n=this;this.writeBuffer.length?this.once("drain",function(){this.upgrading?i():t()}):this.upgrading?i():t()}return this},n.prototype.onError=function(t){o("socket error %j",t),n.priorWebsocketSuccess=!1,this.emit("error",t),this.onClose("transport error",t)},n.prototype.onClose=function(t,e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){o('socket close with reason: "%s"',t);var i=this;clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",t,e),i.writeBuffer=[],i.prevBufferLen=0}},n.prototype.filterUpgrades=function(t){for(var e=[],i=0,n=t.length;n>i;i++)~h(this.transports,t[i])&&e.push(t[i]);return e}}).call(e,function(){return this}())},function(t,e,i){function n(t){if(t=String(t),!(t.length>100)){var e=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(t);if(e){var i=parseFloat(e[1]),n=(e[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return i*u;case"days":case"day":case"d":return i*c;case"hours":case"hour":case"hrs":case"hr":case"h":return i*l;case"minutes":case"minute":case"mins":case"min":case"m":return i*h;case"seconds":case"second":case"secs":case"sec":case"s":return i*o;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return i;default:return void 0}}}}function r(t){return t>=c?Math.round(t/c)+"d":t>=l?Math.round(t/l)+"h":t>=h?Math.round(t/h)+"m":t>=o?Math.round(t/o)+"s":t+"ms"}function a(t){return s(t,c,"day")||s(t,l,"hour")||s(t,h,"minute")||s(t,o,"second")||t+" ms"}function s(t,e,i){return e>t?void 0:1.5*e>t?Math.floor(t/e)+" "+i:Math.ceil(t/e)+" "+i+"s"}var o=1e3,h=60*o,l=60*h,c=24*l,u=365.25*c;t.exports=function(t,e){e=e||{};var i=typeof t;if("string"===i&&t.length>0)return n(t);if("number"===i&&isNaN(t)===!1)return e["long"]?a(t):r(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))}},,,,,function(t,e,i){function n(t){this.path=t.path,this.hostname=t.hostname,this.port=t.port,this.secure=t.secure,this.query=t.query,this.timestampParam=t.timestampParam,this.timestampRequests=t.timestampRequests,this.readyState="",this.agent=t.agent||!1,this.socket=t.socket,this.enablesXDR=t.enablesXDR,this.pfx=t.pfx,this.key=t.key,this.passphrase=t.passphrase,this.cert=t.cert,this.ca=t.ca,this.ciphers=t.ciphers,this.rejectUnauthorized=t.rejectUnauthorized,this.forceNode=t.forceNode,this.extraHeaders=t.extraHeaders,this.localAddress=t.localAddress}var r=i(156),a=i(126);t.exports=n,a(n.prototype),n.prototype.onError=function(t,e){var i=new Error(t);return i.type="TransportError",i.description=e,this.emit("error",i),this},n.prototype.open=function(){return("closed"===this.readyState||""===this.readyState)&&(this.readyState="opening",this.doOpen()),this},n.prototype.close=function(){return("opening"===this.readyState||"open"===this.readyState)&&(this.doClose(),this.onClose()),this},n.prototype.send=function(t){if("open"!==this.readyState)throw new Error("Transport not open");this.write(t)},n.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},n.prototype.onData=function(t){var e=r.decodePacket(t,this.socket.binaryType);this.onPacket(e)},n.prototype.onPacket=function(t){this.emit("packet",t)},n.prototype.onClose=function(){this.readyState="closed",this.emit("close")}},function(t,e,i){(function(t){function n(e){var i,n=!1,o=!1,h=!1!==e.jsonp;if(t.location){var l="https:"===location.protocol,c=location.port;c||(c=l?443:80),n=e.hostname!==location.hostname||c!==e.port,o=e.secure!==l}if(e.xdomain=n,e.xscheme=o,i=new r(e),"open"in i&&!e.forceJSONP)return new a(e);if(!h)throw new Error("JSONP disabled");return new s(e)}var r=i(158),a=i(159),s=i(160),o=i(161);e.polling=n,e.websocket=o}).call(e,function(){return this}())},function(t,e,i){(function(t){function n(t,i){var n="b"+e.packets[t.type]+t.data.data;return i(n)}function r(t,i,n){if(!i)return e.encodeBase64Packet(t,n);var r=t.data,a=new Uint8Array(r),s=new Uint8Array(1+r.byteLength);s[0]=y[t.type];for(var o=0;o<a.length;o++)s[o+1]=a[o];return n(s.buffer)}function a(t,i,n){if(!i)return e.encodeBase64Packet(t,n);var r=new FileReader;return r.onload=function(){t.data=r.result,e.encodePacket(t,i,!0,n)},r.readAsArrayBuffer(t.data)}function s(t,i,n){if(!i)return e.encodeBase64Packet(t,n);if(g)return a(t,i,n);var r=new Uint8Array(1);r[0]=y[t.type];var s=new w([r.buffer,t.data]);return n(s)}function o(t){try{t=_.decode(t,{strict:!1})}catch(e){return!1}return t}function h(t,e,i){for(var n=new Array(t.length),r=f(t.length,i),a=function(t,i,r){e(i,function(e,i){n[t]=i,r(e,n)})},s=0;s<t.length;s++)a(s,t[s],r)}var l,c=i(162),u=i(167),d=i(166),f=i(169),_=i(163);t&&t.ArrayBuffer&&(l=i(170));var p="undefined"!=typeof navigator&&/Android/i.test(navigator.userAgent),m="undefined"!=typeof navigator&&/PhantomJS/i.test(navigator.userAgent),g=p||m;e.protocol=3;var y=e.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},v=c(y),x={type:"error",data:"parser error"},w=i(168);e.encodePacket=function(e,i,a,o){"function"==typeof i&&(o=i,i=!1),"function"==typeof a&&(o=a,a=null);var h=void 0===e.data?void 0:e.data.buffer||e.data;if(t.ArrayBuffer&&h instanceof ArrayBuffer)return r(e,i,o);if(w&&h instanceof t.Blob)return s(e,i,o);if(h&&h.base64)return n(e,o);var l=y[e.type];return void 0!==e.data&&(l+=a?_.encode(String(e.data),{strict:!1}):String(e.data)),o(""+l)},e.encodeBase64Packet=function(i,n){var r="b"+e.packets[i.type];if(w&&i.data instanceof t.Blob){var a=new FileReader;return a.onload=function(){var t=a.result.split(",")[1];n(r+t)},a.readAsDataURL(i.data)}var s;try{s=String.fromCharCode.apply(null,new Uint8Array(i.data))}catch(o){for(var h=new Uint8Array(i.data),l=new Array(h.length),c=0;c<h.length;c++)l[c]=h[c];s=String.fromCharCode.apply(null,l)}return r+=t.btoa(s),n(r)},e.decodePacket=function(t,i,n){if(void 0===t)return x;if("string"==typeof t){if("b"===t.charAt(0))return e.decodeBase64Packet(t.substr(1),i);if(n&&(t=o(t),t===!1))return x;var r=t.charAt(0);return Number(r)==r&&v[r]?t.length>1?{type:v[r],data:t.substring(1)}:{type:v[r]}:x}var a=new Uint8Array(t),r=a[0],s=d(t,1);return w&&"blob"===i&&(s=new w([s])),{type:v[r],data:s}},e.decodeBase64Packet=function(t,e){var i=v[t.charAt(0)];if(!l)return{type:i,data:{base64:!0,data:t.substr(1)}};var n=l.decode(t.substr(1));return"blob"===e&&w&&(n=new w([n])),{type:i,data:n}},e.encodePayload=function(t,i,n){function r(t){return t.length+":"+t}function a(t,n){e.encodePacket(t,s?i:!1,!1,function(t){n(null,r(t))})}"function"==typeof i&&(n=i,i=null);var s=u(t);return i&&s?w&&!g?e.encodePayloadAsBlob(t,n):e.encodePayloadAsArrayBuffer(t,n):t.length?void h(t,a,function(t,e){return n(e.join(""))}):n("0:")},e.decodePayload=function(t,i,n){if("string"!=typeof t)return e.decodePayloadAsBinary(t,i,n);"function"==typeof i&&(n=i,i=null);var r;if(""===t)return n(x,0,1);for(var a,s,o="",h=0,l=t.length;l>h;h++){var c=t.charAt(h);if(":"===c){if(""===o||o!=(a=Number(o)))return n(x,0,1);if(s=t.substr(h+1,a),o!=s.length)return n(x,0,1);if(s.length){if(r=e.decodePacket(s,i,!1),x.type===r.type&&x.data===r.data)return n(x,0,1);var u=n(r,h+a,l);if(!1===u)return}h+=a,o=""}else o+=c}return""!==o?n(x,0,1):void 0},e.encodePayloadAsArrayBuffer=function(t,i){function n(t,i){e.encodePacket(t,!0,!0,function(t){return i(null,t)})}return t.length?void h(t,n,function(t,e){var n=e.reduce(function(t,e){var i;return i="string"==typeof e?e.length:e.byteLength,t+i.toString().length+i+2},0),r=new Uint8Array(n),a=0;return e.forEach(function(t){var e="string"==typeof t,i=t;if(e){for(var n=new Uint8Array(t.length),s=0;s<t.length;s++)n[s]=t.charCodeAt(s);i=n.buffer}e?r[a++]=0:r[a++]=1;for(var o=i.byteLength.toString(),s=0;s<o.length;s++)r[a++]=parseInt(o[s]);r[a++]=255;for(var n=new Uint8Array(i),s=0;s<n.length;s++)r[a++]=n[s]}),i(r.buffer)}):i(new ArrayBuffer(0))},e.encodePayloadAsBlob=function(t,i){function n(t,i){e.encodePacket(t,!0,!0,function(t){var e=new Uint8Array(1);if(e[0]=1,"string"==typeof t){for(var n=new Uint8Array(t.length),r=0;r<t.length;r++)n[r]=t.charCodeAt(r);t=n.buffer,e[0]=0}for(var a=t instanceof ArrayBuffer?t.byteLength:t.size,s=a.toString(),o=new Uint8Array(s.length+1),r=0;r<s.length;r++)o[r]=parseInt(s[r]);if(o[s.length]=255,w){var h=new w([e.buffer,o.buffer,t]);i(null,h)}})}h(t,n,function(t,e){return i(new w(e))})},e.decodePayloadAsBinary=function(t,i,n){"function"==typeof i&&(n=i,i=null);for(var r=t,a=[];r.byteLength>0;){for(var s=new Uint8Array(r),o=0===s[0],h="",l=1;255!==s[l];l++){if(h.length>310)return n(x,0,1);h+=s[l]}r=d(r,2+h.length),h=parseInt(h);var c=d(r,0,h);if(o)try{c=String.fromCharCode.apply(null,new Uint8Array(c))}catch(u){var f=new Uint8Array(c);c="";for(var l=0;l<f.length;l++)c+=String.fromCharCode(f[l])}a.push(c),r=d(r,h)}var _=a.length;a.forEach(function(t,r){n(e.decodePacket(t,i,!0),r,_)})}}).call(e,function(){return this}())},function(t,e,i){(function(e){var i=/^[\],:{}\s]*$/,n=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,r=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,a=/(?:^|:|,)(?:\s*\[)+/g,s=/^\s+/,o=/\s+$/;t.exports=function(t){return"string"==typeof t&&t?(t=t.replace(s,"").replace(o,""),e.JSON&&JSON.parse?JSON.parse(t):i.test(t.replace(n,"@").replace(r,"]").replace(a,""))?new Function("return "+t)():void 0):null}}).call(e,function(){return this}())},function(t,e,i){(function(e){var n=i(171);t.exports=function(t){var i=t.xdomain,r=t.xscheme,a=t.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!i||n))return new XMLHttpRequest}catch(s){}try{if("undefined"!=typeof XDomainRequest&&!r&&a)return new XDomainRequest}catch(s){}if(!i)try{return new(e[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(s){}}}).call(e,function(){return this}())},function(t,e,i){(function(e){function n(){}function r(t){if(h.call(this,t),this.requestTimeout=t.requestTimeout,this.extraHeaders=t.extraHeaders,e.location){var i="https:"===location.protocol,n=location.port;n||(n=i?443:80),this.xd=t.hostname!==e.location.hostname||n!==t.port,this.xs=t.secure!==i}}function a(t){this.method=t.method||"GET",this.uri=t.uri,this.xd=!!t.xd,this.xs=!!t.xs,this.async=!1!==t.async,this.data=void 0!==t.data?t.data:null,this.agent=t.agent,this.isBinary=t.isBinary,this.supportsBinary=t.supportsBinary,this.enablesXDR=t.enablesXDR,this.requestTimeout=t.requestTimeout,this.pfx=t.pfx,this.key=t.key,this.passphrase=t.passphrase,this.cert=t.cert,this.ca=t.ca,this.ciphers=t.ciphers,this.rejectUnauthorized=t.rejectUnauthorized,this.extraHeaders=t.extraHeaders,this.create()}function s(){for(var t in a.requests)a.requests.hasOwnProperty(t)&&a.requests[t].abort()}var o=i(158),h=i(165),l=i(126),c=i(172),u=i(112)("engine.io-client:polling-xhr");t.exports=r,t.exports.Request=a,c(r,h),r.prototype.supportsBinary=!0,r.prototype.request=function(t){return t=t||{},t.uri=this.uri(),t.xd=this.xd,t.xs=this.xs,t.agent=this.agent||!1,t.supportsBinary=this.supportsBinary,t.enablesXDR=this.enablesXDR,t.pfx=this.pfx,t.key=this.key,t.passphrase=this.passphrase,t.cert=this.cert,t.ca=this.ca,t.ciphers=this.ciphers,t.rejectUnauthorized=this.rejectUnauthorized,t.requestTimeout=this.requestTimeout,t.extraHeaders=this.extraHeaders,new a(t)},r.prototype.doWrite=function(t,e){var i="string"!=typeof t&&void 0!==t,n=this.request({method:"POST",data:t,isBinary:i}),r=this;n.on("success",e),n.on("error",function(t){r.onError("xhr post error",t)}),this.sendXhr=n},r.prototype.doPoll=function(){u("xhr poll");var t=this.request(),e=this;t.on("data",function(t){e.onData(t)}),t.on("error",function(t){e.onError("xhr poll error",t)}),this.pollXhr=t},l(a.prototype),a.prototype.create=function(){var t={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};t.pfx=this.pfx,t.key=this.key,t.passphrase=this.passphrase,t.cert=this.cert,t.ca=this.ca,t.ciphers=this.ciphers,t.rejectUnauthorized=this.rejectUnauthorized;var i=this.xhr=new o(t),n=this;try{u("xhr open %s: %s",this.method,this.uri),i.open(this.method,this.uri,this.async);try{if(this.extraHeaders){i.setDisableHeaderCheck&&i.setDisableHeaderCheck(!0);for(var r in this.extraHeaders)this.extraHeaders.hasOwnProperty(r)&&i.setRequestHeader(r,this.extraHeaders[r])}}catch(s){}if("POST"===this.method)try{this.isBinary?i.setRequestHeader("Content-type","application/octet-stream"):i.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(s){}try{i.setRequestHeader("Accept","*/*")}catch(s){}"withCredentials"in i&&(i.withCredentials=!0),this.requestTimeout&&(i.timeout=this.requestTimeout),this.hasXDR()?(i.onload=function(){n.onLoad()},i.onerror=function(){n.onError(i.responseText)}):i.onreadystatechange=function(){if(2===i.readyState){var t;try{t=i.getResponseHeader("Content-Type")}catch(e){}"application/octet-stream"===t&&(i.responseType="arraybuffer")}4===i.readyState&&(200===i.status||1223===i.status?n.onLoad():setTimeout(function(){n.onError(i.status)},0))},u("xhr data %s",this.data),i.send(this.data)}catch(s){return void setTimeout(function(){n.onError(s)},0)}e.document&&(this.index=a.requestsCount++,a.requests[this.index]=this)},a.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},a.prototype.onData=function(t){this.emit("data",t),this.onSuccess()},a.prototype.onError=function(t){this.emit("error",t),this.cleanup(!0)},a.prototype.cleanup=function(t){if("undefined"!=typeof this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=n:this.xhr.onreadystatechange=n,t)try{this.xhr.abort()}catch(i){}e.document&&delete a.requests[this.index],this.xhr=null}},a.prototype.onLoad=function(){var t;try{var e;try{e=this.xhr.getResponseHeader("Content-Type")}catch(i){}t="application/octet-stream"===e?this.xhr.response||this.xhr.responseText:this.xhr.responseText}catch(i){this.onError(i)}null!=t&&this.onData(t)},a.prototype.hasXDR=function(){return"undefined"!=typeof e.XDomainRequest&&!this.xs&&this.enablesXDR},a.prototype.abort=function(){this.cleanup()},a.requestsCount=0,a.requests={},e.document&&(e.attachEvent?e.attachEvent("onunload",s):e.addEventListener&&e.addEventListener("beforeunload",s,!1))}).call(e,function(){return this}())},function(t,e,i){(function(e){function n(){}function r(t){a.call(this,t),this.query=this.query||{},o||(e.___eio||(e.___eio=[]),o=e.___eio),this.index=o.length;var i=this;o.push(function(t){i.onData(t)}),this.query.j=this.index,e.document&&e.addEventListener&&e.addEventListener("beforeunload",function(){i.script&&(i.script.onerror=n)},!1)}var a=i(165),s=i(172);t.exports=r;var o,h=/\n/g,l=/\\n/g;s(r,a),r.prototype.supportsBinary=!1,r.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),a.prototype.doClose.call(this)},r.prototype.doPoll=function(){var t=this,e=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),e.async=!0,e.src=this.uri(),e.onerror=function(e){t.onError("jsonp poll error",e)};var i=document.getElementsByTagName("script")[0];i?i.parentNode.insertBefore(e,i):(document.head||document.body).appendChild(e),this.script=e;var n="undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent);n&&setTimeout(function(){var t=document.createElement("iframe");document.body.appendChild(t),document.body.removeChild(t)},100)},r.prototype.doWrite=function(t,e){function i(){n(),e()}function n(){if(r.iframe)try{r.form.removeChild(r.iframe)}catch(t){r.onError("jsonp polling iframe removal error",t)}try{var e='<iframe src="javascript:0" name="'+r.iframeId+'">';a=document.createElement(e)}catch(t){a=document.createElement("iframe"),a.name=r.iframeId,a.src="javascript:0"}a.id=r.iframeId,r.form.appendChild(a),r.iframe=a}var r=this;if(!this.form){var a,s=document.createElement("form"),o=document.createElement("textarea"),c=this.iframeId="eio_iframe_"+this.index;s.className="socketio",s.style.position="absolute",s.style.top="-1000px",s.style.left="-1000px",s.target=c,s.method="POST",s.setAttribute("accept-charset","utf-8"),o.name="d",s.appendChild(o),document.body.appendChild(s),this.form=s,this.area=o}this.form.action=this.uri(),n(),t=t.replace(l,"\\\n"),this.area.value=t.replace(h,"\\n");try{this.form.submit()}catch(u){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"===r.iframe.readyState&&i()}:this.iframe.onload=i}}).call(e,function(){return this}())},function(t,e,i){(function(e){function n(t){var e=t&&t.forceBase64;e&&(this.supportsBinary=!1),this.perMessageDeflate=t.perMessageDeflate,this.usingBrowserWebSocket=u&&!t.forceNode,this.protocols=t.protocols,this.usingBrowserWebSocket||(f=r),a.call(this,t)}var r,a=i(154),s=i(156),o=i(130),h=i(172),l=i(173),c=i(112)("engine.io-client:websocket"),u=e.WebSocket||e.MozWebSocket;if("undefined"==typeof window)try{r=i(164)}catch(d){}var f=u;f||"undefined"!=typeof window||(f=r),t.exports=n,h(n,a),n.prototype.name="websocket",n.prototype.supportsBinary=!0,n.prototype.doOpen=function(){if(this.check()){var t=this.uri(),e=this.protocols,i={agent:this.agent,perMessageDeflate:this.perMessageDeflate};i.pfx=this.pfx,i.key=this.key,i.passphrase=this.passphrase,i.cert=this.cert,i.ca=this.ca,i.ciphers=this.ciphers,i.rejectUnauthorized=this.rejectUnauthorized,this.extraHeaders&&(i.headers=this.extraHeaders),this.localAddress&&(i.localAddress=this.localAddress);try{this.ws=this.usingBrowserWebSocket?e?new f(t,e):new f(t):new f(t,e,i)}catch(n){return this.emit("error",n)}void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="nodebuffer"):this.ws.binaryType="arraybuffer",this.addEventListeners()}},n.prototype.addEventListeners=function(){var t=this;this.ws.onopen=function(){t.onOpen()},this.ws.onclose=function(){t.onClose()},this.ws.onmessage=function(e){t.onData(e.data)},this.ws.onerror=function(e){t.onError("websocket error",e)}},n.prototype.write=function(t){function i(){n.emit("flush"),setTimeout(function(){n.writable=!0,n.emit("drain")},0)}var n=this;this.writable=!1;for(var r=t.length,a=0,o=r;o>a;a++)!function(t){s.encodePacket(t,n.supportsBinary,function(a){if(!n.usingBrowserWebSocket){var s={};if(t.options&&(s.compress=t.options.compress),n.perMessageDeflate){var o="string"==typeof a?e.Buffer.byteLength(a):a.length;o<n.perMessageDeflate.threshold&&(s.compress=!1)}}try{n.usingBrowserWebSocket?n.ws.send(a):n.ws.send(a,s)}catch(h){c("websocket closed before onclose event")}--r||i()})}(t[a])},n.prototype.onClose=function(){a.prototype.onClose.call(this)},n.prototype.doClose=function(){"undefined"!=typeof this.ws&&this.ws.close()},n.prototype.uri=function(){var t=this.query||{},e=this.secure?"wss":"ws",i="";this.port&&("wss"===e&&443!==Number(this.port)||"ws"===e&&80!==Number(this.port))&&(i=":"+this.port),this.timestampRequests&&(t[this.timestampParam]=l()),this.supportsBinary||(t.b64=1),t=o.encode(t),t.length&&(t="?"+t);var n=-1!==this.hostname.indexOf(":");return e+"://"+(n?"["+this.hostname+"]":this.hostname)+i+this.path+t},n.prototype.check=function(){return!(!f||"__initialize"in f&&this.name===n.prototype.name)}}).call(e,function(){return this}())},function(t,e,i){t.exports=Object.keys||function(t){var e=[],i=Object.prototype.hasOwnProperty;for(var n in t)i.call(t,n)&&e.push(n);return e}},function(t,e,i){var n;(function(t,r){!function(a){function s(t){for(var e,i,n=[],r=0,a=t.length;a>r;)e=t.charCodeAt(r++),e>=55296&&56319>=e&&a>r?(i=t.charCodeAt(r++),56320==(64512&i)?n.push(((1023&e)<<10)+(1023&i)+65536):(n.push(e),r--)):n.push(e);return n}function o(t){for(var e,i=t.length,n=-1,r="";++n<i;)e=t[n],e>65535&&(e-=65536,r+=x(e>>>10&1023|55296),e=56320|1023&e),r+=x(e);return r}function h(t,e){if(t>=55296&&57343>=t){if(e)throw Error("Lone surrogate U+"+t.toString(16).toUpperCase()+" is not a scalar value");return!1}return!0}function l(t,e){return x(t>>e&63|128)}function c(t,e){if(0==(4294967168&t))return x(t);var i="";return 0==(4294965248&t)?i=x(t>>6&31|192):0==(4294901760&t)?(h(t,e)||(t=65533),i=x(t>>12&15|224),i+=l(t,6)):0==(4292870144&t)&&(i=x(t>>18&7|240),i+=l(t,12),i+=l(t,6)),i+=x(63&t|128)}function u(t,e){e=e||{};for(var i,n=!1!==e.strict,r=s(t),a=r.length,o=-1,h="";++o<a;)i=r[o],h+=c(i,n);return h}function d(){if(v>=y)throw Error("Invalid byte index");var t=255&g[v];if(v++,128==(192&t))return 63&t;throw Error("Invalid continuation byte")}function f(t){var e,i,n,r,a;if(v>y)throw Error("Invalid byte index");if(v==y)return!1;if(e=255&g[v],v++,0==(128&e))return e;if(192==(224&e)){if(i=d(),a=(31&e)<<6|i,a>=128)return a;throw Error("Invalid continuation byte")}if(224==(240&e)){if(i=d(),n=d(),a=(15&e)<<12|i<<6|n,a>=2048)return h(a,t)?a:65533;throw Error("Invalid continuation byte")}if(240==(248&e)&&(i=d(),n=d(),r=d(),a=(7&e)<<18|i<<12|n<<6|r,a>=65536&&1114111>=a))return a;throw Error("Invalid UTF-8 detected")}function _(t,e){e=e||{};var i=!1!==e.strict;g=s(t),y=g.length,v=0;for(var n,r=[];(n=f(i))!==!1;)r.push(n);return o(r)}var p="object"==typeof e&&e,m=("object"==typeof t&&t&&t.exports==p&&t,"object"==typeof r&&r);(m.global===m||m.window===m)&&(a=m);var g,y,v,x=String.fromCharCode,w={version:"2.1.2",encode:u,decode:_};n=function(){return w}.call(e,i,e,t),!(void 0!==n&&(t.exports=n))}(this)}).call(e,i(84)(t),function(){return this}())},function(t,e,i){},function(t,e,i){function n(t){var e=t&&t.forceBase64;(!c||e)&&(this.supportsBinary=!1),r.call(this,t)}var r=i(154),a=i(130),s=i(156),o=i(172),h=i(173),l=i(112)("engine.io-client:polling");t.exports=n;var c=function(){var t=i(158),e=new t({xdomain:!1});return null!=e.responseType}();o(n,r),n.prototype.name="polling",n.prototype.doOpen=function(){this.poll()},n.prototype.pause=function(t){function e(){l("paused"),i.readyState="paused",t()}var i=this;if(this.readyState="pausing",this.polling||!this.writable){var n=0;this.polling&&(l("we are currently polling - waiting to pause"),n++,this.once("pollComplete",function(){l("pre-pause polling complete"),--n||e()})),this.writable||(l("we are currently writing - waiting to pause"),n++,this.once("drain",function(){l("pre-pause writing complete"),--n||e()}))}else e()},n.prototype.poll=function(){l("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},n.prototype.onData=function(t){var e=this;l("polling got data %s",t);var i=function(t,i,n){return"opening"===e.readyState&&e.onOpen(),"close"===t.type?(e.onClose(),!1):void e.onPacket(t)};s.decodePayload(t,this.socket.binaryType,i),"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState?this.poll():l('ignoring poll - transport state "%s"',this.readyState))},n.prototype.doClose=function(){function t(){l("writing close packet"),e.write([{type:"close"}])}var e=this;"open"===this.readyState?(l("transport open - closing"),t()):(l("transport not open - deferring close"),this.once("open",t))},n.prototype.write=function(t){var e=this;this.writable=!1;var i=function(){e.writable=!0,e.emit("drain")};s.encodePayload(t,this.supportsBinary,function(t){e.doWrite(t,i)})},n.prototype.uri=function(){var t=this.query||{},e=this.secure?"https":"http",i="";!1!==this.timestampRequests&&(t[this.timestampParam]=h()),this.supportsBinary||t.sid||(t.b64=1),t=a.encode(t),this.port&&("https"===e&&443!==Number(this.port)||"http"===e&&80!==Number(this.port))&&(i=":"+this.port),t.length&&(t="?"+t);var n=-1!==this.hostname.indexOf(":");return e+"://"+(n?"["+this.hostname+"]":this.hostname)+i+this.path+t}},function(t,e,i){t.exports=function(t,e,i){var n=t.byteLength;if(e=e||0,i=i||n,t.slice)return t.slice(e,i);if(0>e&&(e+=n),0>i&&(i+=n),i>n&&(i=n),e>=n||e>=i||0===n)return new ArrayBuffer(0);for(var r=new Uint8Array(t),a=new Uint8Array(i-e),s=e,o=0;i>s;s++,o++)a[o]=r[s];return a.buffer}},function(t,e,i){(function(e){function n(t){if(!t||"object"!=typeof t)return!1;if(r(t)){for(var i=0,a=t.length;a>i;i++)if(n(t[i]))return!0;return!1}if("function"==typeof e.Buffer&&e.Buffer.isBuffer&&e.Buffer.isBuffer(t)||"function"==typeof e.ArrayBuffer&&t instanceof ArrayBuffer||s&&t instanceof Blob||o&&t instanceof File)return!0;if(t.toJSON&&"function"==typeof t.toJSON&&1===arguments.length)return n(t.toJSON(),!0);for(var h in t)if(Object.prototype.hasOwnProperty.call(t,h)&&n(t[h]))return!0;return!1}var r=i(174),a=Object.prototype.toString,s="function"==typeof e.Blob||"[object BlobConstructor]"===a.call(e.Blob),o="function"==typeof e.File||"[object FileConstructor]"===a.call(e.File);t.exports=n}).call(e,function(){return this}())},function(t,e,i){(function(e){function i(t){for(var e=0;e<t.length;e++){var i=t[e];if(i.buffer instanceof ArrayBuffer){var n=i.buffer;if(i.byteLength!==n.byteLength){var r=new Uint8Array(i.byteLength);r.set(new Uint8Array(n,i.byteOffset,i.byteLength)),n=r.buffer}t[e]=n}}}function n(t,e){e=e||{};var n=new a;i(t);for(var r=0;r<t.length;r++)n.append(t[r]);return e.type?n.getBlob(e.type):n.getBlob()}function r(t,e){return i(t),new Blob(t,e||{})}var a=e.BlobBuilder||e.WebKitBlobBuilder||e.MSBlobBuilder||e.MozBlobBuilder,s=function(){try{var t=new Blob(["hi"]);return 2===t.size}catch(e){return!1}}(),o=s&&function(){try{var t=new Blob([new Uint8Array([1,2])]);return 2===t.size}catch(e){return!1}}(),h=a&&a.prototype.append&&a.prototype.getBlob;t.exports=function(){return s?o?e.Blob:r:h?n:void 0}()}).call(e,function(){return this}())},function(t,e,i){function n(t,e,i){function n(t,r){if(n.count<=0)throw new Error("after called too many times");--n.count,t?(a=!0,e(t),e=i):0!==n.count||a||e(null,r)}var a=!1;return i=i||r,n.count=t,0===t?e():n}function r(){}t.exports=n},function(t,e,i){!function(){"use strict";for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=new Uint8Array(256),n=0;n<t.length;n++)i[t.charCodeAt(n)]=n;e.encode=function(e){var i,n=new Uint8Array(e),r=n.length,a="";for(i=0;r>i;i+=3)a+=t[n[i]>>2],a+=t[(3&n[i])<<4|n[i+1]>>4],a+=t[(15&n[i+1])<<2|n[i+2]>>6],a+=t[63&n[i+2]];return r%3===2?a=a.substring(0,a.length-1)+"=":r%3===1&&(a=a.substring(0,a.length-2)+"=="),a},e.decode=function(t){var e,n,r,a,s,o=.75*t.length,h=t.length,l=0;"="===t[t.length-1]&&(o--,"="===t[t.length-2]&&o--);var c=new ArrayBuffer(o),u=new Uint8Array(c);for(e=0;h>e;e+=4)n=i[t.charCodeAt(e)],r=i[t.charCodeAt(e+1)],a=i[t.charCodeAt(e+2)],s=i[t.charCodeAt(e+3)],u[l++]=n<<2|r>>4,u[l++]=(15&r)<<4|a>>2,u[l++]=(3&a)<<6|63&s;return c}}()},function(t,e,i){try{t.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(n){t.exports=!1}},function(t,e,i){t.exports=function(t,e){var i=function(){};i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t}},function(t,e,i){"use strict";function n(t){var e="";do e=o[t%h]+e,t=Math.floor(t/h);while(t>0);return e}function r(t){var e=0;for(u=0;u<t.length;u++)e=e*h+l[t.charAt(u)];return e}function a(){var t=n(+new Date);return t!==s?(c=0,s=t):t+"."+n(c++)}for(var s,o="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),h=64,l={},c=0,u=0;h>u;u++)l[o[u]]=u;a.encode=n,a.decode=r,t.exports=a},function(t,e,i){var n={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==n.call(t)}}]));